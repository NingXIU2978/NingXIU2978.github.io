<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQl学习笔记(总) | NINGXIU's 学习博客</title><meta name="author" content="NINGXIU"><meta name="copyright" content="NINGXIU"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="数据库（DataBase）：数据库(简称DB)是长期储存在计算机内、有组织的、可共享的大量数据的集合。 数据库中存储的基本对象是数据(Data)数据库的基本特点：永久存储、有组织、可共享 数据库管理系统（DataBase Management System）：DBMS，位于用户与操作系统之间的一层数据管理软件。（是系统软件，是数据库系统的核心） 主要功能：  数据定义功能 数据组织、存储和管理 数">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQl学习笔记(总)">
<meta property="og:url" content="https://ningxiu2978.github.io/2025/09/18/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E6%80%BB)/index.html">
<meta property="og:site_name" content="NINGXIU&#39;s 学习博客">
<meta property="og:description" content="数据库（DataBase）：数据库(简称DB)是长期储存在计算机内、有组织的、可共享的大量数据的集合。 数据库中存储的基本对象是数据(Data)数据库的基本特点：永久存储、有组织、可共享 数据库管理系统（DataBase Management System）：DBMS，位于用户与操作系统之间的一层数据管理软件。（是系统软件，是数据库系统的核心） 主要功能：  数据定义功能 数据组织、存储和管理 数">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ningxiu2978.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2025-09-18T13:14:54.830Z">
<meta property="article:modified_time" content="2025-09-18T13:16:32.797Z">
<meta property="article:author" content="NINGXIU">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ningxiu2978.github.io/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MySQl学习笔记(总)",
  "url": "https://ningxiu2978.github.io/2025/09/18/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E6%80%BB)/",
  "image": "https://ningxiu2978.github.io/img/avatar.jpg",
  "datePublished": "2025-09-18T13:14:54.830Z",
  "dateModified": "2025-09-18T13:16:32.797Z",
  "author": [
    {
      "@type": "Person",
      "name": "NINGXIU",
      "url": "https://ningxiu2978.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://ningxiu2978.github.io/2025/09/18/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E6%80%BB)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":true,"top_n_per_article":-1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQl学习笔记(总)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(https://pic1.imgdb.cn/item/65578a9fc458853aef80544a.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-solid fa-images"></i><span> 相册</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">NINGXIU's 学习博客</span></a><a class="nav-page-title" href="/"><span class="site-name">MySQl学习笔记(总)</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-solid fa-images"></i><span> 相册</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MySQl学习笔记(总)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-18T13:14:54.830Z" title="发表于 2025-09-18 21:14:54">2025-09-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-18T13:16:32.797Z" title="更新于 2025-09-18 21:16:32">2025-09-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL/">MySQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">32.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>121分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h3 id="数据库（DataBase）："><a href="#数据库（DataBase）：" class="headerlink" title="数据库（DataBase）："></a>数据库（DataBase）：</h3><p>数据库(简称<strong>DB</strong>)是长期储存在计算机内、有组织的、可共享的大量数据的集合。</p>
<p>数据库中存储的基本对象是数据(Data)<br>数据库的基本特点：<strong>永久存储、有组织、可共享</strong></p>
<h4 id="数据库管理系统（DataBase-Management-System）："><a href="#数据库管理系统（DataBase-Management-System）：" class="headerlink" title="数据库管理系统（DataBase Management System）："></a>数据库管理系统（DataBase Management System）：</h4><p><strong>DBMS</strong>，位于用户与操作系统之间的一层数据管理软件。（是系统软件，是数据库系统的核心）</p>
<p>主要功能：</p>
<ul>
<li>数据定义功能</li>
<li>数据组织、存储和管理</li>
<li>数据操纵功能（插入、删除、修改和查询）</li>
<li>数据库的事务管理和运行管理</li>
<li>数据库的建立和维护功能(实用程序)</li>
<li>其它功能（异构数据库之间的互访等）</li>
</ul>
<h4 id="数据库系统（DataBase-System）"><a href="#数据库系统（DataBase-System）" class="headerlink" title="数据库系统（DataBase System）"></a>数据库系统（DataBase System）</h4><ul>
<li>数据库系统（<strong>DBS</strong>）： 计算机系统中引入数据库后的系统构成</li>
<li>数据库系统的构成：由数据库、数据库管理系统、应用系统、应用开发工具、用户、应用程序员、数据库管理员（Database Administrator，DBA）等组成 。</li>
</ul>
<h3 id="数据库分类："><a href="#数据库分类：" class="headerlink" title="数据库分类："></a>数据库分类：</h3><ul>
<li><p><strong>关系型数据库(RDBMS)</strong>：关系型数据库，是建立在关系模型基础上，由多张相互连接的<strong>二维表</strong>组成的数据库。</p>
<ul>
<li><p>特点：</p>
<p>使用表存储数据，格式统一(行列），便于维护</p>
<p>使用SQL语句操作，标准统一，使用方便</p>
<p>数据存储在磁盘中，安全</p>
</li>
<li><p>常见的关系型数据库：<strong>mysql、oracle、db2、sql server</strong></p>
</li>
<li><p>应用场景：医疗系统、教育系统、商业系统</p>
</li>
</ul>
</li>
<li><p><strong>非关系型数据库(NoSQL)</strong>：Not-Only SQL ，泛指非关系型数据库，是对关系型数据库的补充。</p>
<ul>
<li><p>特点：<strong>KEY:VALUE 存储</strong>，数据结构灵活、伸缩性强</p>
</li>
<li><p>常见的非关系型数据库：<strong>Redis、MongoDB</strong></p>
</li>
<li><p>应用场景：新闻文本信息-MongoDB、电商抢购促销-Redis、微博热点信息-Redis</p>
</li>
</ul>
</li>
</ul>
<h3 id="SQL简述："><a href="#SQL简述：" class="headerlink" title="SQL简述："></a>SQL简述：</h3><p>Structure Query Language(<strong>结构化查询语言</strong>)简称SQL</p>
<h4 id="SQL的优点："><a href="#SQL的优点：" class="headerlink" title="SQL的优点："></a>SQL的优点：</h4><p>1、简单易学，具有很强的操作性<br>2、绝大多数重要的数据库管理系统均支持SQL<br>3、高度非过程化；用SQL操作数据库时大部分的工作由DBMS自动完成</p>
<h4 id="SQL的分类："><a href="#SQL的分类：" class="headerlink" title="SQL的分类："></a>SQL的分类：</h4><p>1、<strong>DDL</strong>(Data Definition Language) 数据定义语言，用来操作<strong>数据库、表、列</strong>等； 常用语句：<code>CREATE、 ALTER、DROP</code><br>2、<strong>DML</strong>(Data Manipulation Language) 数据操作语言，用来操作数据库中<strong>表里的数据</strong>；常用语句：<code>INSERT、 UPDATE、 DELETE</code></p>
<p>3、<strong>DQL</strong>(Data Query Language) 数据查询语言，用来查询数据 常用语句：<code>SELECT</code></p>
<p>4、<strong>DCL</strong>(Data Control Language) 数据控制语言，用来操作<strong>访问权限和安全级别</strong>； 常用语句：<code>GRANT</code>(授权)、<code>revoke</code>(回收)、<code>commit</code>(提交)、<code>roolback</code>(回滚)</p>
<h3 id="数据库的数据类型"><a href="#数据库的数据类型" class="headerlink" title="数据库的数据类型"></a>数据库的数据类型</h3><p>使用MySQL数据库存储数据时，不同的数据类型决定了 MySQL存储数据方式的不同。为此，MySQL数据库提供了多种数据类型，其中包括整数类型、浮点数类型、定点 数类型、日期和时间类型、字符串类型、二进制…等等数据类型。</p>
<p>在 MySQL 中，数据类型决定了字段可以存储的数据种类以及存储方式。合理选择数据类型对于优化数据库性能和节省存储空间至关重要。以下是 MySQL 中主要的数据类型分类及详细介绍：</p>
<h4 id="1、数值类型"><a href="#1、数值类型" class="headerlink" title="1、数值类型"></a>1、数值类型</h4><p><strong>1.1 整数类型</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>存储字节</th>
<th>无符号范围（Unsigned）</th>
<th>有符号范围（Signed）</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td><code>TINYINT</code></td>
<td>1 字节</td>
<td>0 到 255</td>
<td>-128 到 127</td>
<td>适合**存储状态值，**如 0&#x2F;1 表示开关</td>
</tr>
<tr>
<td><code>SMALLINT</code></td>
<td>2 字节</td>
<td>0 到 65,535</td>
<td>-32,768 到 32,767</td>
<td></td>
</tr>
<tr>
<td><code>MEDIUMINT</code></td>
<td>3 字节</td>
<td>0 到 16,777,215</td>
<td>-8,388,608 到 8,388,607</td>
<td></td>
</tr>
<tr>
<td><code>INT</code></td>
<td>4 字节</td>
<td>0 到 4,294,967,295</td>
<td>-2,147,483,648 到 2,147,483,647</td>
<td>常用整数，适合<strong>用户id、数量</strong>等</td>
</tr>
<tr>
<td><code>BIGINT</code></td>
<td>8 字节</td>
<td>0 到 18,446,744,073,709,551,615</td>
<td>-9,223,372,036,854,775,808 到 9,223,372,036,854,775,807</td>
<td>适合存储<strong>大数值</strong>，如<strong>订单号</strong></td>
</tr>
</tbody></table>
<p><strong>特点</strong>：</p>
<ul>
<li>使用 <code>UNSIGNED</code> 关键字可取消负数范围，使正数范围扩大一倍。</li>
<li>示例：<code>age TINYINT UNSIGNED</code>（适合存储 0-120 的年龄）。</li>
</ul>
<p><strong>1.2 浮点类型</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>存储字节</th>
<th>精度</th>
<th>范围（近似）</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td><code>FLOAT</code></td>
<td>4 字节</td>
<td>单精度（7 位小数）</td>
<td>±3.402823466E+38</td>
<td>适合不需要极高精度的小数，例如<strong>产品评分</strong></td>
</tr>
<tr>
<td><code>DOUBLE</code></td>
<td>8 字节</td>
<td>双精度（15 位小数）</td>
<td>±1.7976931348623157E+308</td>
<td>用于更精确的计算，如<strong>科学数据</strong></td>
</tr>
<tr>
<td><code>DECIMAL(M,D)</code></td>
<td>可变</td>
<td>精确小数（M &#x3D; 总位数，D &#x3D; 小数位数）</td>
<td>取决于 M 和 D 的设置</td>
<td>用于<strong>财务计算，如金额</strong></td>
</tr>
</tbody></table>
<p><strong>特点</strong>：</p>
<ul>
<li><p><code>FLOAT</code> 和 <code>DOUBLE</code> 适用于科学计算，但存在精度损失。</p>
</li>
<li><p><code>DECIMAL</code> 用于财务计算（如金额），确保精确性。</p>
</li>
<li><p>示例：<code>price DECIMAL(10, 2)</code>（存储 99999999.99 以内的金额）。</p>
</li>
</ul>
<h4 id="2、日期和时间类型"><a href="#2、日期和时间类型" class="headerlink" title="2、日期和时间类型"></a>2、日期和时间类型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>存储字节</th>
<th>格式</th>
<th>范围</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td><code>DATE</code></td>
<td>3 字节</td>
<td><code>YYYY-MM-DD</code></td>
<td>1000-01-01 到 9999-12-31</td>
<td>存储日期，如<strong>生日</strong></td>
</tr>
<tr>
<td><code>TIME</code></td>
<td>3 字节</td>
<td><code>HH:MM:SS</code></td>
<td>-838:59:59 到 838:59:59</td>
<td>存储时间</td>
</tr>
<tr>
<td><code>DATETIME</code></td>
<td>8 字节</td>
<td><code>YYYY-MM-DD HH:MM:SS</code></td>
<td>1000-01-01 00:00:00 到 9999-12-31 23:59:59</td>
<td>存储日期和时间，如<strong>订单创建时间</strong></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td>4 字节</td>
<td><code>YYYY-MM-DD HH:MM:SS</code></td>
<td>1970-01-01 00:00:01 UTC 到 2038-01-19 03:14:07 UTC</td>
<td>存储日期和时间，范围小，受时区影响，常用于<strong>记录最后修改时间</strong></td>
</tr>
<tr>
<td><code>YEAR</code></td>
<td>1 字节</td>
<td><code>YYYY</code> 或 <code>YY</code></td>
<td>1901 到 2155</td>
<td>存储年</td>
</tr>
</tbody></table>
<p><strong>特点</strong>：</p>
<ul>
<li><p><code>TIMESTAMP</code> 会自动转换为当前时区，且支持 <code>ON UPDATE CURRENT_TIMESTAMP</code> 自动更新。</p>
</li>
<li><p>示例：</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"></span><br><span class="line">updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br></pre></td></tr></table></figure>



<h4 id="3、字符串类型"><a href="#3、字符串类型" class="headerlink" title="3、字符串类型"></a>3、字符串类型</h4><p><strong>3.1 固定长度字符串</strong></p>
<ul>
<li><p><code>CHAR(M)</code>：固定长度字符串，<code>M</code> 为字符数（1-255），不足 <code>M</code> 时用空格填充。</p>
</li>
<li><p><strong>特点</strong>：适合长度固定的数据（如<strong>密码哈希、身份证号、性别</strong>），访问速度快。</p>
</li>
</ul>
<p><strong>3.2 可变长度字符串</strong></p>
<ul>
<li><p><code>VARCHAR(M)</code>：可变长度字符串，<code>M</code> 为最大字符数（1-65,535），实际占用空间为字符串长度 + 1&#x2F;2 字节。</p>
</li>
<li><p><strong>特点</strong>：适合长度不固定的数据（如<strong>用户名、文章摘要</strong>），节省空间。</p>
</li>
</ul>
<p><strong>3.3 文本类型</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>最大长度</th>
<th>存储需求</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td><code>TINYTEXT</code></td>
<td>255 字符</td>
<td>L + 1 字节（L &#x3D; 实际长度）</td>
<td></td>
</tr>
<tr>
<td><code>TEXT</code></td>
<td>65,535 字符</td>
<td>L + 2 字节</td>
<td>适合文章内容等大段文本</td>
</tr>
<tr>
<td><code>MEDIUMTEXT</code></td>
<td>16,777,215 字符</td>
<td>L + 3 字节</td>
<td></td>
</tr>
<tr>
<td><code>LONGTEXT</code></td>
<td>4,294,967,295 字符</td>
<td>L + 4 字节</td>
<td></td>
</tr>
</tbody></table>
<p><strong>特点</strong>：</p>
<ul>
<li>用于存储大文本（如文章内容、评论），不能有默认值。</li>
</ul>
<p><strong>3.4 枚举和集合</strong></p>
<ul>
<li><p><code>ENUM(&#39;value1&#39;, &#39;value2&#39;, ...)</code>：从预定义值中选择单个值。</p>
</li>
<li><p><code>SET(&#39;value1&#39;, &#39;value2&#39;, ...)</code>：从预定义值中选择 0 个或多个值。</p>
</li>
<li><p><strong>示例</strong>：</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gender ENUM(<span class="string">&#x27;Male&#x27;</span>, <span class="string">&#x27;Female&#x27;</span>, <span class="string">&#x27;Other&#x27;</span>),</span><br><span class="line"></span><br><span class="line">hobbies <span class="keyword">SET</span>(<span class="string">&#x27;Reading&#x27;</span>, <span class="string">&#x27;Music&#x27;</span>, <span class="string">&#x27;Sports&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="4、二进制类型"><a href="#4、二进制类型" class="headerlink" title="4、二进制类型"></a>4、二进制类型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>最大长度</th>
<th>存储需求</th>
</tr>
</thead>
<tbody><tr>
<td><code>TINYBLOB</code></td>
<td>255 字节</td>
<td>L + 1 字节</td>
</tr>
<tr>
<td><code>BLOB</code></td>
<td>65,535 字节</td>
<td>L + 2 字节</td>
</tr>
<tr>
<td><code>MEDIUMBLOB</code></td>
<td>16,777,215 字节</td>
<td>L + 3 字节</td>
</tr>
<tr>
<td><code>LONGBLOB</code></td>
<td>4,294,967,295 字节</td>
<td>L + 4 字节</td>
</tr>
<tr>
<td><code>VARBINARY(M)</code></td>
<td>可变长度，最大 <code>M</code> 字节</td>
<td>实际长度 + 1&#x2F;2 字节</td>
</tr>
</tbody></table>
<p><strong>特点</strong>：</p>
<ul>
<li>用于存储<strong>二进制数据</strong>（如图片、文件），但通常建议存储文件路径而非直接存储二进制数据。</li>
</ul>
<h4 id="5、JSON-类型"><a href="#5、JSON-类型" class="headerlink" title="5、JSON 类型"></a>5、JSON 类型</h4><ul>
<li><p><code>JSON</code>：存储 JSON 格式数据（对象或数组）。</p>
</li>
<li><p><strong>特点</strong>：</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 支持 JSON 路径表达式查询（如 `-&gt;` 和 `-&gt;&gt;` 操作符）。</span></span><br><span class="line"><span class="comment">-- 示例：</span></span><br><span class="line">user_info JSON,</span><br><span class="line"><span class="comment">-- 存储 &#123;&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30, &quot;hobbies&quot;: [&quot;Reading&quot;, &quot;Music&quot;]&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="6、空间数据类型"><a href="#6、空间数据类型" class="headerlink" title="6、空间数据类型"></a>6、空间数据类型</h4><ul>
<li><strong><code>GEOMETRY</code></strong>：存储几何对象（点、线、多边形等）。</li>
<li><strong><code>POINT</code></strong>、<strong><code>LINESTRING</code></strong>、<strong><code>POLYGON</code></strong> 等：特定几何类型。</li>
<li>特点：用于地理信息系统（GIS）应用，支持空间索引和函数。</li>
</ul>
<h4 id="7、选择数据类型的原则"><a href="#7、选择数据类型的原则" class="headerlink" title="7、选择数据类型的原则"></a><strong>7、选择数据类型的原则</strong></h4><ol>
<li><strong>最小化原则</strong>：选择能满足需求的最小数据类型（如年龄用 <code>TINYINT</code> 而非 <code>INT</code>）。</li>
<li><strong>精度优先</strong>：财务数据用 <code>DECIMAL</code>，避免浮点误差。</li>
<li><strong>避免 <code>TEXT/BLOB</code></strong>：除非必要，否则用 <code>VARCHAR</code> 代替，以提高查询性能。</li>
<li><strong>一致性</strong>：关联字段使用相同的数据类型（如外键与主键）。</li>
</ol>
<h3 id="数据库、数据表的基本操作"><a href="#数据库、数据表的基本操作" class="headerlink" title="数据库、数据表的基本操作"></a>数据库、数据表的基本操作</h3><h4 id="DDL-操作"><a href="#DDL-操作" class="headerlink" title="DDL 操作"></a><strong>DDL 操作</strong></h4><p><strong>DDL： 数据定义语言，操作数据库、数据库表</strong> </p>
<p>关键字：<code>create、alter、drop</code></p>
<h5 id="1、DDL-操作数据库"><a href="#1、DDL-操作数据库" class="headerlink" title="1、DDL 操作数据库"></a>1、DDL 操作数据库</h5><h6 id="1-1-查询数据库"><a href="#1-1-查询数据库" class="headerlink" title="1.1 查询数据库"></a>1.1 查询数据库</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br></pre></td></tr></table></figure>

<h6 id="1-2-创建数据库"><a href="#1-2-创建数据库" class="headerlink" title="1.2 创建数据库"></a>1.2 创建数据库</h6><p><strong>IF NOT EXISTS</strong> 表示如果数据库不存在就创建</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test1;</span><br></pre></td></tr></table></figure>

<h6 id="1-3-删除数据库"><a href="#1-3-删除数据库" class="headerlink" title="1.3 删除数据库"></a>1.3 删除数据库</h6><p><code>DROP</code> 表示删除的意思</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> test1;</span><br></pre></td></tr></table></figure>

<h6 id="1-4-使用数据库"><a href="#1-4-使用数据库" class="headerlink" title="1.4 使用数据库"></a>1.4 使用数据库</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE sc0701;</span><br></pre></td></tr></table></figure>

<h5 id="2、DDL操作表"><a href="#2、DDL操作表" class="headerlink" title="2、DDL操作表"></a>2、DDL操作表</h5><h6 id="2-1-创建表-create"><a href="#2-1-创建表-create" class="headerlink" title="2.1 创建表 create"></a>2.1 创建表 <code>create</code></h6><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] 表名(</span><br><span class="line"> 字段<span class="number">1</span>  数据类型 [comment 字段注释],</span><br><span class="line"> 字段<span class="number">2</span>  数据类型 [comment 字段注释],</span><br><span class="line"> ...</span><br><span class="line"> 字段n 数据类型 [comment 字段注释]</span><br><span class="line">)[comment  表注释];</span><br></pre></td></tr></table></figure>

<p>注意：<br>（1）中括号 […]  表示可选参数<br>（2）<strong>最后一个字段的定义，末尾不能有逗号</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `teacher`(</span><br><span class="line"> tno <span class="type">INT</span> COMMENT <span class="string">&#x27;教师编号&#x27;</span>,</span><br><span class="line"> tname <span class="type">VARCHAR</span>(<span class="number">255</span>) COMMENT <span class="string">&#x27;教师名称&#x27;</span>,</span><br><span class="line"> gender <span class="type">CHAR</span>(<span class="number">2</span>),</span><br><span class="line"> birthday <span class="type">DATE</span> COMMENT <span class="string">&#x27;教师的生日&#x27;</span></span><br><span class="line">) COMMENT <span class="string">&#x27;教师表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>练习<br><code>UNSIGNED</code> <strong>关键字的作用是去负数范围</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> emp(</span><br><span class="line">  id <span class="type">INT</span> COMMENT <span class="string">&#x27;员工编号&#x27;</span>,</span><br><span class="line">	eno <span class="type">VARCHAR</span>(<span class="number">10</span>) COMMENT <span class="string">&#x27;员工工号&#x27;</span>,</span><br><span class="line">	ename  <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">	gender  <span class="type">CHAR</span>(<span class="number">2</span>),</span><br><span class="line">	age TINYINT UNSIGNED,</span><br><span class="line">	inno <span class="type">CHAR</span>(<span class="number">18</span>),</span><br><span class="line">	hirday <span class="type">date</span></span><br><span class="line">)COMMENT <span class="string">&#x27;员工表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h6 id="2-2-修改表-alter"><a href="#2-2-修改表-alter" class="headerlink" title="2.2 修改表 alter"></a>2.2 修改表 <code>alter</code></h6><p>（1）给表<strong>添加字段</strong>，语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">add</span> 字段名 类型(长度) [comment 注释][约束];</span><br></pre></td></tr></table></figure>

<p>给学生表添加一个 昵称(nickname) 字段， varchar(20)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> student <span class="keyword">ADD</span> `nickname` <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;学生昵称&#x27;</span>;</span><br></pre></td></tr></table></figure>


<p>（2）<strong>修改表字段的数据类型</strong>，语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 modify 字段名 新的数据类型(长度);</span><br></pre></td></tr></table></figure>

<p>扩展语法：<strong>修改字段名和字段类型</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 change 旧字段名 新字段名 新的数据类型(长度);</span><br></pre></td></tr></table></figure>

<p>修改 学生表 name 字段的数据类型为 char</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> student MODIFY `name` <span class="type">char</span>(<span class="number">15</span>);</span><br></pre></td></tr></table></figure>

<p>练习：修改学生表， 将 name 字段修改为 username，并且数据类型为 varchar(20)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> student CHANGE `name` `username` <span class="type">VARCHAR</span>(<span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<p>（3）<strong>删除字段</strong>，语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">drop</span> 字段名; </span><br></pre></td></tr></table></figure>

<p>删除学生表的 nickname 字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> student <span class="keyword">DROP</span> nickname;</span><br></pre></td></tr></table></figure>

<p>（4）修改表名称，语法：<br><strong>alter table 表名 rename to 新表名;</strong></p>
<p>将 emp 表 名称修改为 employee 表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> emp RENAME <span class="keyword">TO</span> employee;</span><br></pre></td></tr></table></figure>

<h6 id="2-3-删除表："><a href="#2-3-删除表：" class="headerlink" title="2.3 删除表："></a>2.3 <strong>删除表</strong>：</h6><ul>
<li><p><code>drop</code>（删除表结构）</p>
</li>
<li><p><code>truncate</code>（截断表数据）</p>
</li>
<li><p><code>delete</code> （删除表数据）</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> teacher;  </span><br><span class="line"><span class="comment">-- 清空了表里面的数据，自增的主键列 tno的记录还在</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> teacher; 	</span><br><span class="line"><span class="comment">-- 清空了表里面的数据，自增的主键列 tno的记录也被清除了，从新开始记录</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> teacher; <span class="comment">-- 删除表结构</span></span><br></pre></td></tr></table></figure>





<h4 id="DML-操作"><a href="#DML-操作" class="headerlink" title="DML 操作"></a><strong>DML 操作</strong></h4><p><strong>DML：数据操作语言</strong>，用来对数据库表中的数据（记录）进行增删改操作。</p>
<h5 id="1、添加数据：insert"><a href="#1、添加数据：insert" class="headerlink" title="1、添加数据：insert"></a>1、添加数据：<code>insert</code></h5><h6 id="1-1-给指定的字段添加数据，语法："><a href="#1-1-给指定的字段添加数据，语法：" class="headerlink" title="1.1 给指定的字段添加数据，语法："></a>1.1 给指定的字段添加数据，语法：</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名(字段<span class="number">1</span>, 字段<span class="number">2</span> ...) <span class="keyword">values</span> (值<span class="number">1</span>, 值<span class="number">2</span> ...);</span><br></pre></td></tr></table></figure>

<p>注意：插入数据时，指定的字段顺序和值的顺序一一对应</p>
<p>给 teacher 表 tname 字段、gender 字段添加数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> teacher(tname, gender) <span class="keyword">VALUES</span>(<span class="string">&#x27;tom&#x27;</span>, <span class="string">&#x27;男&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h6 id="1-2-给所有字段添加数据，语法："><a href="#1-2-给所有字段添加数据，语法：" class="headerlink" title="1.2 给所有字段添加数据，语法："></a>1.2 给所有字段添加数据，语法：</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名 <span class="keyword">values</span> (值<span class="number">1</span>, 值<span class="number">2</span> ...);</span><br></pre></td></tr></table></figure>

<p>注意：<br>（1）没有指定字段时，值的顺序要和数据库表中的字段顺序一致<br>（2）插入日期类型的数据时，可以使用日期格式的字符串插入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> teacher <span class="keyword">VALUES</span> (<span class="keyword">null</span>, <span class="string">&#x27;jack&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2025-07-28&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h6 id="1-3-批量添加数据"><a href="#1-3-批量添加数据" class="headerlink" title="1.3 批量添加数据"></a>1.3 批量添加数据</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名(字段<span class="number">1</span>, 字段<span class="number">2</span> ...) </span><br><span class="line">  <span class="keyword">values</span> (值<span class="number">1</span>, 值<span class="number">2</span> ...), (值<span class="number">1</span>, 值<span class="number">2</span> ...), (值<span class="number">1</span>, 值<span class="number">2</span> ...)... ;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名 </span><br><span class="line">  <span class="keyword">values</span> (值<span class="number">1</span>, 值<span class="number">2</span> ...), (值<span class="number">1</span>, 值<span class="number">2</span> ...), (值<span class="number">1</span>, 值<span class="number">2</span> ...)...;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> teacher </span><br><span class="line">  <span class="keyword">VALUES</span> </span><br><span class="line">  (<span class="keyword">null</span>, <span class="string">&#x27;rose1&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2025-07-28&#x27;</span>),</span><br><span class="line">  (<span class="keyword">null</span>, <span class="string">&#x27;rose2&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2025-07-28&#x27;</span>),</span><br><span class="line">  (<span class="keyword">null</span>, <span class="string">&#x27;rose3&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2025-07-28&#x27;</span>),</span><br><span class="line">  (<span class="keyword">null</span>, <span class="string">&#x27;rose4&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2025-07-28&#x27;</span>);</span><br></pre></td></tr></table></figure>





<h5 id="2、更新数据：update"><a href="#2、更新数据：update" class="headerlink" title="2、更新数据：update"></a>2、<strong>更新数据：<code>update</code></strong></h5><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段名<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>, 字段名<span class="number">2</span><span class="operator">=</span>值<span class="number">2</span>, ... [<span class="keyword">where</span> 条件]</span><br></pre></td></tr></table></figure>

<p>注意：<br>（1）修改语句的条件 可以有，也可以没有<br>（2）如果没有条件，修改的是整张表中的该字段的所有数据</p>
<p>修改teacher 表中的 tno &#x3D; 1 的数据行，将 tname 修改为 alex</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> teacher <span class="keyword">SET</span> tname<span class="operator">=</span><span class="string">&#x27;alex&#x27;</span> <span class="keyword">WHERE</span> tno<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> teacher <span class="keyword">SET</span> tname<span class="operator">=</span><span class="string">&#x27;jock&#x27;</span>;  </span><br><span class="line"><span class="comment">--  整个表的 tname 字段都会修改为 jock</span></span><br></pre></td></tr></table></figure>



<h5 id="3、删除数据：delete"><a href="#3、删除数据：delete" class="headerlink" title="3、删除数据：delete"></a>3、<strong>删除数据</strong>：<code>delete</code></h5><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件];</span><br></pre></td></tr></table></figure>

<p>注意：<br>（1）删除语句可以有条件，也可以没有条件<br>（2）如果没有条件，会删除整张表中的数据</p>
<p>删除教师表中 tno&#x3D;3 的教师信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> tno<span class="operator">=</span><span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> teacher;</span><br></pre></td></tr></table></figure>



<h3 id="DQL数据查询语言（基础）"><a href="#DQL数据查询语言（基础）" class="headerlink" title="DQL数据查询语言（基础）"></a><strong>DQL数据查询语言（基础）</strong></h3><ul>
<li><code>*</code> 表示所有（通配符）<br><code>&#123;&#125;</code>表示必选项<br><code>[]</code>表示可选项<br><code>|</code> 表示 或者 的意思</li>
</ul>
<h4 id="基础查询语句语法（编写顺序：）："><a href="#基础查询语句语法（编写顺序：）：" class="headerlink" title="基础查询语句语法（编写顺序：）："></a><strong>基础查询语句语法（编写顺序：）：</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123; <span class="operator">*</span> <span class="operator">|</span>字段名&#125;			<span class="comment">--5</span></span><br><span class="line">  <span class="keyword">from</span> 表名 [<span class="keyword">AS</span> 表名]			<span class="comment">-- 1</span></span><br><span class="line">  [<span class="keyword">where</span> ...]  <span class="comment">--条件查询		-- 2</span></span><br><span class="line">  [<span class="keyword">group</span> <span class="keyword">by</span> ...] <span class="comment">--分组查询		-- 3</span></span><br><span class="line">  [<span class="keyword">having</span> ...]  <span class="comment">--分组条件		--4</span></span><br><span class="line">  [<span class="keyword">order</span> <span class="keyword">by</span> ...]  <span class="comment">--排序查询	--6</span></span><br><span class="line">  [limit ...] <span class="comment">--分页查询		--7</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<h6 id="1-1-匹配所有记录，当数据量特别大的时候，会检索所有数据，不推荐使用"><a href="#1-1-匹配所有记录，当数据量特别大的时候，会检索所有数据，不推荐使用" class="headerlink" title="1.1  * 匹配所有记录，当数据量特别大的时候，会检索所有数据，不推荐使用"></a>1.1  <code>*</code> 匹配所有记录，当数据量特别大的时候，会检索所有数据，不推荐使用</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h6 id="1-2根据指定-一列或者多列-查询"><a href="#1-2根据指定-一列或者多列-查询" class="headerlink" title="1.2根据指定 一列或者多列 查询,"></a>1.2根据指定 一列或者多列 查询,</h6><p>多个字段之间使用<strong>逗号</strong>分隔</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tname <span class="keyword">FROM</span> c_teacher;</span><br><span class="line"><span class="keyword">SELECT</span> tno,tname,gender <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h4 id="2、AS-设置别名"><a href="#2、AS-设置别名" class="headerlink" title="2、AS 设置别名"></a>2、AS 设置别名</h4><p><code>as</code>子句作用：<br>（1）可以给表和字段取别名<br>（2）也可以给计算结果取别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno <span class="keyword">AS</span> <span class="string">&#x27;教师编号&#x27;</span>,tname <span class="keyword">AS</span> <span class="string">&#x27;教师名称&#x27;</span>,</span><br><span class="line">gender <span class="keyword">AS</span> &quot;教师性别&quot;</span><br><span class="line">  <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<p>取别名时，<code>as</code>关键字可以省略不写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno <span class="string">&#x27;教师编号&#x27;</span>,tname <span class="string">&#x27;教师名称&#x27;</span>,</span><br><span class="line">gender &quot;教师性别&quot;</span><br><span class="line">  <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h6 id="2-2-给计算结果取别名"><a href="#2-2-给计算结果取别名" class="headerlink" title="2.2 给计算结果取别名"></a>2.2 给计算结果取别名</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(sal) <span class="string">&#x27;月总工资&#x27;</span> <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h4 id="3、distinct-去重"><a href="#3、distinct-去重" class="headerlink" title="3、distinct 去重"></a>3、<strong><code>distinct</code> 去重</strong></h4><p><code>distinct</code>关键字的作用：去除查询返回结果中重复的记录（<strong>重复的记录只返回一条</strong>）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> gender <span class="keyword">FROM</span> c_teacher;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> gender <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h4 id="4、运算"><a href="#4、运算" class="headerlink" title="4、运算"></a>4、运算</h4><p>sql支持四则运算</p>
<p>查询每个老师的编号，姓名，月薪，年薪（计算）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname,sal <span class="string">&#x27;月薪&#x27;</span>,sal<span class="operator">*</span><span class="number">12</span> <span class="string">&#x27;年薪&#x27;</span></span><br><span class="line">  <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h4 id="5、连接函数"><a href="#5、连接函数" class="headerlink" title="5、连接函数"></a>5、连接函数</h4><p><code>concat</code>(str1,str2, …) <strong>连接字符串和字段</strong></p>
<p>格式：<br>编号是1，姓名为：赵辉，性别：男</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">CONCAT(<span class="string">&#x27;编号：&#x27;</span>,tno,<span class="string">&#x27;，姓名为：&#x27;</span>,tname,<span class="string">&#x27;，性别：&#x27;</span>,gender)</span><br><span class="line"><span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h4 id="6、where-条件查询"><a href="#6、where-条件查询" class="headerlink" title="6、where 条件查询"></a>6、<code>where</code> 条件查询</h4><p>(1) <code>where</code>条件语句：作用是用于检索表中符合条件的记录<br>(2)检索的条件可以由一个或者多个逻辑表达式组成，表达式的结果一般为真或假<br>(3)检索条件的组成：逻辑操作符	和	比较操作符<br>比较操作符：&#x3D; &gt; &lt; ≥ &lt;&#x3D; !&#x3D;</p>
<p>逻辑操作符：and  or not</p>
<p>特殊的比较操作符：</p>
<p><code>between</code>	例如：a between b, 表示范围在a~b之间，就返回真 **[a,b] **<br><code>is null</code>	例如：a is null, 表示 a 不是 null,则返回真<br><code>is not null</code>	例如：a is not null, 表示 a 不是 null,则返回真<br><code>like</code>	例如：a like b,<strong>模糊匹配</strong>，表示 a 匹配 b,则返回真<br><code>in</code>	例如：a in (a, bb, cc),表示 a 等于 (aa, bb, cc)中的一个，就返回真</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询：教师表中 名字为 赵辉 的老师所有信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tname<span class="operator">=</span><span class="string">&#x27;赵辉&#x27;</span>;</span><br><span class="line"><span class="comment">-- 练：查询所有男老师的编号、姓名 和 性别</span></span><br><span class="line"><span class="keyword">SELECT</span> tno,tname,gender <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> gender<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>;</span><br><span class="line"><span class="comment">-- 练：查询所有薪水大于 20000 的教师 编号、姓名 和 薪水</span></span><br><span class="line"><span class="keyword">SELECT</span> tno,tname,sal <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> sal<span class="operator">&gt;</span><span class="number">20000</span>;</span><br><span class="line"><span class="comment">-- 练：查询所有不是 4 号部门的老师编号、姓名 和 部门编号</span></span><br><span class="line"><span class="keyword">SELECT</span> tno,tname,dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno<span class="operator">!=</span><span class="number">4</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno,tname,dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno<span class="operator">&lt;&gt;</span><span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：在 SQL中，<strong>NULL值</strong>与任何值的<strong>比较</strong>（包括!&#x3D;)都会返回<strong>UNKNOWN</strong>, 因此使用dno !&#x3D;4 过滤时, dno为INULL的记录不会被选中。</p>
<p>如果需要查询出 null 的记录，需要修改条件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- dno 不等于  或者 dno 是 null 的记录都会被筛选出来</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno<span class="operator">!=</span><span class="number">4</span> <span class="keyword">or</span> dno <span class="keyword">is</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h5 id="6-2-逻辑操作符-and-or"><a href="#6-2-逻辑操作符-and-or" class="headerlink" title="6.2 逻辑操作符 and or"></a>6.2 逻辑操作符 <code>and or</code></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 练：查询 薪水在 10000~20000 之间的老师编号、姓名、薪水信息</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, sal <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> sal <span class="keyword">BETWEEN</span> <span class="number">10000</span> <span class="keyword">AND</span> <span class="number">20000</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, sal <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> sal<span class="operator">&gt;=</span><span class="number">10000</span> <span class="keyword">AND</span> sal<span class="operator">&lt;=</span><span class="number">20000</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, sal <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> sal<span class="operator">&gt;=</span><span class="number">10000</span> <span class="operator">&amp;&amp;</span> sal<span class="operator">&lt;=</span><span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询2号部门 和 3号部门的所有老师编号、姓名、部门编号信息</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno<span class="operator">=</span><span class="number">2</span> <span class="keyword">OR</span> dno<span class="operator">=</span><span class="number">3</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno<span class="operator">=</span><span class="number">2</span> <span class="operator">||</span> dno<span class="operator">=</span><span class="number">3</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno <span class="keyword">IN</span> (<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询薪水在5000以下和25000以上的老师师编号、姓名、薪水信息</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, sal <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> sal<span class="operator">&lt;</span><span class="number">5000</span> <span class="keyword">OR</span> sal<span class="operator">&gt;</span><span class="number">25000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询不是 2号 和 5号 部门的老师编号、姓名、部门编号信息</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno<span class="operator">!=</span><span class="number">2</span> <span class="keyword">AND</span> dno<span class="operator">!=</span><span class="number">5</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno<span class="operator">&lt;&gt;</span><span class="number">2</span> <span class="keyword">AND</span> dno<span class="operator">&lt;&gt;</span><span class="number">5</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有没有部门的教师编号、姓名、部门编号信息</span></span><br><span class="line"><span class="keyword">SELECT</span> tno,tname, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h5 id="6-3-like模糊查询"><a href="#6-3-like模糊查询" class="headerlink" title="6.3 like模糊查询"></a>6.3 <code>like</code>模糊查询</h5><p>模糊查询匹配符号：<br>符号 <code>_</code> 表示精准匹配1个字符；<br>符号 <code>%</code> 表示模糊匹配0~n个字符；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询教师表中 姓陈的老师编号、姓名信息</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tname <span class="keyword">LIKE</span> <span class="string">&#x27;陈_&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tname <span class="keyword">LIKE</span> <span class="string">&#x27;陈%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询名字是 辉 字结尾的老师编号、姓名信息</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tname <span class="keyword">LIKE</span> <span class="string">&#x27;_辉&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tname <span class="keyword">LIKE</span> <span class="string">&#x27;%辉&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询名字中包含 建 字的老师编号、姓名信息</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tname <span class="keyword">LIKE</span> <span class="string">&#x27;%建%&#x27;</span>;  <span class="comment">-- 任意位置</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tname <span class="keyword">LIKE</span> <span class="string">&#x27;_建_&#x27;</span>;  <span class="comment">-- 在中间位置</span></span><br></pre></td></tr></table></figure>



<h4 id="7、聚合函数"><a href="#7、聚合函数" class="headerlink" title="7、聚合函数"></a>7、聚合函数</h4><p><strong>注意事项：</strong><br>(1)聚合函数在<strong>查询时</strong>会<strong>忽略null值</strong><br>(2)sum和avg只能用于<strong>数字类型</strong>的计算<br>(3)avg统计的是<strong>有数据</strong>的记录之和除以有记录的数量<br>例如：6个人有奖金，平均值计算的是6个人的奖金和 &#x2F; 6</p>
<h5 id="7-1统计记录数-count"><a href="#7-1统计记录数-count" class="headerlink" title="7.1统计记录数 count()"></a>7.1统计记录数 <code>count()</code></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询教师表中有多少条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> c_teacher;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(tname) <span class="keyword">FROM</span> c_teacher;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(dno) <span class="keyword">FROM</span> c_teacher; <span class="comment">-- null 值不参与运算</span></span><br></pre></td></tr></table></figure>

<h5 id="7-2-求最大值、最小值、求和、求平均值"><a href="#7-2-求最大值、最小值、求和、求平均值" class="headerlink" title="7.2 求	最大值、最小值、求和、求平均值"></a>7.2 求	最大值、最小值、求和、求平均值</h5><p><code>max()</code> ，<code>min()</code> ，<code>sum()</code> ，<code>avg()</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询教师表中的最高工资、最低工资、工资总和、平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	<span class="built_in">MAX</span>(sal) <span class="string">&#x27;最高工资&#x27;</span>, </span><br><span class="line">	<span class="built_in">MIN</span>(sal) <span class="string">&#x27;最低工资&#x27;</span>, </span><br><span class="line">	<span class="built_in">SUM</span>(sal) <span class="string">&#x27;工资总和&#x27;</span>,</span><br><span class="line">	<span class="built_in">AVG</span>(sal) <span class="string">&#x27;平均工资&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> c_teacher;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 统计奖金平均值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">avg</span>(comm) <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h4 id="8、分组查询-group-by"><a href="#8、分组查询-group-by" class="headerlink" title="8、分组查询 group by"></a>8、分组查询 <code>group by</code></h4><p>分组查询：将相同的数据分为一组<br><strong>【注意事项】</strong><br>(1) <code>group by</code> 一般和<strong>聚合函数</strong>一起使用，单独使用没有意义<br>(2) <code>select</code> 关键字后面只能放 <strong>分组的列</strong>，也就是说该字段必须是 <code>group by</code> 后面的字段 或者 5个聚合函数<br>(3)当一个sql语句中有 <strong>表的某个列 + 聚合函数</strong>时，必须使用<code>group by</code>子句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno; <span class="comment">--报错，select后面只能跟分组的列</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> dno <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno;	<span class="comment">--单独使用没有意义</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> dno<span class="string">&#x27;部门&#x27;</span>,<span class="built_in">COUNT</span>(dno)<span class="string">&#x27;人数&#x27;</span> <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno;	</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> dno, <span class="built_in">COUNT</span>(dno) <span class="keyword">FROM</span> c_teacher; <span class="comment">--列+聚合函数，必须使用group by子句</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--根据部门分组，统计每个部门的人数</span></span><br><span class="line"><span class="keyword">SELECT</span> dno, <span class="built_in">COUNT</span>(dno) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno; <span class="comment">-- 查询字段+聚合函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询有的男老师的工资总和 和 女老师的工资总和</span></span><br><span class="line"><span class="keyword">SELECT</span> gender, <span class="built_in">SUM</span>(sal) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> gender;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询每个部门的平均工资</span></span><br><span class="line"><span class="comment">-- TRUNCATE(m, n)  数值 m 保留 n 位小数</span></span><br><span class="line"><span class="keyword">SELECT</span> dno, <span class="keyword">TRUNCATE</span>(<span class="built_in">avg</span>(sal), <span class="number">2</span>) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询不同岗位的记录数、工资和、平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> job, <span class="built_in">COUNT</span>(job), <span class="built_in">SUM</span>(sal), <span class="built_in">avg</span>(sal) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> job;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 提升：根据多个字段分组，</span></span><br><span class="line"><span class="comment">-- 查询每个部门中不同岗位的记录数、工资和、平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> dno, job, <span class="built_in">COUNT</span>(job), <span class="built_in">SUM</span>(sal), <span class="built_in">avg</span>(sal) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno, job;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> dno, job, <span class="built_in">COUNT</span>(job), <span class="built_in">SUM</span>(sal), <span class="built_in">avg</span>(sal) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno, job <span class="keyword">ORDER</span> <span class="keyword">BY</span> dno <span class="keyword">DESC</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询所有男老师的工资总和、人数</span></span><br><span class="line"><span class="comment">--不能使用where筛选条件</span></span><br><span class="line"><span class="keyword">SELECT</span> gender,<span class="built_in">COUNT</span>(gender),<span class="built_in">SUM</span>(sal) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> gender <span class="keyword">WHERE</span> gender<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>; <span class="comment">--报错 </span></span><br><span class="line"><span class="comment">-- 分组后的筛选条件使用 having 关键字</span></span><br><span class="line"><span class="keyword">SELECT</span> gender,<span class="built_in">COUNT</span>(gender),<span class="built_in">SUM</span>(sal) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> gender <span class="keyword">HAVING</span> gender<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="【面试题】-having-和-where-的区别"><a href="#【面试题】-having-和-where-的区别" class="headerlink" title="【面试题】 having 和 where 的区别:"></a>【面试题】 <strong>having 和 where 的区别:</strong></h5><p>(1) having 和 where 都是用来做<strong>条件筛选</strong>的<br>(2)不同的是:<br>	where 是对<strong>所有的记录</strong>进行筛选， having 是对<strong>分组后</strong>的记录进行筛选；<br>	where 不能放在 group by 子句后面<br>	having 是固定和 group by 一起使用，放在 group by 后面，作用相当于 where<br>	where 后面不能使用聚合函数, having 可以</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询平均工资高于 16000 的部门编号、最低工资和平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> dno, <span class="built_in">MIN</span>(sal), <span class="built_in">AVG</span>(sal) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno <span class="keyword">HAVING</span> <span class="built_in">avg</span>(sal)<span class="operator">&gt;=</span><span class="number">16000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> <span class="built_in">AVG</span>(sal)<span class="operator">&gt;=</span><span class="number">16000</span>;  <span class="comment">-- 报错  where 后面不能使用 聚合函数</span></span><br></pre></td></tr></table></figure>



<h4 id="9、排序-order-by"><a href="#9、排序-order-by" class="headerlink" title="9、排序 order by"></a>9、排序 <code>order by</code></h4><p><code>order by</code> 是将查询结果按照一个或者多个字段进行排序</p>
<ul>
<li><code>desc</code> 降序</li>
<li><code>asc</code>  升序（<strong>默认值</strong>）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有老师信息，按照编号降序排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_teacher <span class="keyword">ORDER</span> <span class="keyword">BY</span> tno <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询教师编号、姓名、工资和部门编号，按照部门编号降序、按照工资升序排序</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, sal, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">ORDER</span> <span class="keyword">BY</span> dno <span class="keyword">DESC</span>, sal <span class="keyword">ASC</span>;</span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, sal, dno <span class="keyword">FROM</span> c_teacher <span class="keyword">ORDER</span> <span class="keyword">BY</span> dno <span class="keyword">DESC</span>, sal;  <span class="comment">-- 升序 asc 关键字可以省略</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询所有教师的编号、姓名、工资，按照工资降序排序</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询教师表中岗位是 讲师 和 研发的教师信息，按照工资降序排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> job <span class="keyword">in</span> (<span class="string">&#x27;讲师&#x27;</span>, <span class="string">&#x27;研发&#x27;</span>) <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal <span class="keyword">DESC</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询女老师中姓李的老师编号、姓名、性别、岗位、薪水信息，按照薪水降序排序</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname,  gender, job, sal</span><br><span class="line"><span class="keyword">FROM</span> c_teacher</span><br><span class="line"><span class="keyword">WHERE</span> gender<span class="operator">=</span><span class="string">&#x27;女&#x27;</span> <span class="keyword">AND</span> tname <span class="keyword">like</span> <span class="string">&#x27;李%&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sal <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>



<h4 id="10、limit分页查询"><a href="#10、limit分页查询" class="headerlink" title="10、limit分页查询"></a>10、<code>limit</code>分页查询</h4><p><code>limit</code> <strong>起始索引，查询的记录数</strong><br>索引值从0开始<br>起始索引：<strong>(页码-1) * 查询记录数</strong><br>如果查询的是 第一页 的数据，起始索引可以省略</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询教师表， 每页显示5条记录， 查第1页数据</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher LIMIT <span class="number">0</span>, <span class="number">5</span>;   <span class="comment">-- 第1页</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher LIMIT <span class="number">5</span>;     <span class="comment">-- 第1页 起始索引可以省略</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher LIMIT <span class="number">5</span>, <span class="number">5</span>;   <span class="comment">-- 第2页</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher LIMIT <span class="number">10</span>, <span class="number">5</span>;  <span class="comment">-- 第3页  起始索引 (3-1)*5</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher LIMIT <span class="number">15</span>, <span class="number">5</span>;  <span class="comment">-- 第3页  起始索引 (4-1)*5</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname <span class="keyword">FROM</span> c_teacher LIMIT <span class="number">45</span>, <span class="number">5</span>;  <span class="comment">-- 第10页 起始索引 (10 - 1) * 5</span></span><br></pre></td></tr></table></figure>

<h6 id="新语法：mysql-8-0-语法"><a href="#新语法：mysql-8-0-语法" class="headerlink" title="新语法：mysql 8.0+ 语法"></a><strong>新语法：mysql 8.0+ 语法</strong></h6><p><strong><code>limit</code> 查询记录数 <code>offset</code> 起始索引</strong> </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname <span class="keyword">FROM</span> c_teacher LIMIT <span class="number">5</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;	<span class="comment">--第1页</span></span><br><span class="line"><span class="keyword">SELECT</span> tno,tname <span class="keyword">FROM</span> c_teacher LIMIT <span class="number">5</span> <span class="keyword">OFFSET</span> <span class="number">10</span>;	<span class="comment">--第3页</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询教师表中工资最高的3个老师编号、姓名、工资</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, sal <span class="keyword">FROM</span> c_teacher <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal <span class="keyword">DESC</span> LIMIT <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练：查询教师表中工资排名 6~10 的老师编号、姓名、工资</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, sal <span class="keyword">FROM</span> c_teacher <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal <span class="keyword">DESC</span> LIMIT <span class="number">5</span> <span class="keyword">OFFSET</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h4 id="基础查询小结："><a href="#基础查询小结：" class="headerlink" title="基础查询小结："></a><strong>基础查询小结：</strong></h4><p>（1）快速体验 基础查询语句语法<br>（2）取别名：as<br>（3）去重：distinct<br>（4）四则运算<br>（5）where 条件查询</p>
<ul>
<li><p>比较运算</p>
<p>逻辑运算</p>
<p>like 模糊查询<br>（6）连接函数<br>（7）聚合函数</p>
<p>5个聚合函数<br>（8）group by 分组 having<br>（9）order by 排序<br>（10）limit  分页</p>
</li>
</ul>
<p><strong>0730</strong></p>
<h3 id="DCL数据控制语言"><a href="#DCL数据控制语言" class="headerlink" title="DCL数据控制语言"></a><strong>DCL数据控制语言</strong></h3><p>DCL 主要做两件事情：</p>
<p>(1)<strong>用户管理</strong>：创建、修改、删除数据库用户</p>
<p>(2)<strong>权限管理</strong>：<strong>授予</strong>(<code>grant</code>)、<strong>回收</strong>(<code>revoke</code>)用户对数据库对象(库、表、列)的操作权限</p>
<h4 id="1、用户管理"><a href="#1、用户管理" class="headerlink" title="1、用户管理"></a><strong>1、用户管理</strong></h4><h5 id="1-1-创建用户"><a href="#1-1-创建用户" class="headerlink" title="1.1 创建用户"></a>1.1 创建用户</h5><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机&#x27;</span>	identified <span class="keyword">by</span> <span class="string">&#x27;密码&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><em>主机：是指限定用户可连接ip</em></p>
<p>创建一个只能登录本机 mysql 数据库的用户，密码为123456</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="1-2-修改用户密码"><a href="#1-2-修改用户密码" class="headerlink" title="1.2 修改用户密码"></a>1.2 修改用户密码</h5><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;新密码&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h5 id="1-3-删除用户"><a href="#1-3-删除用户" class="headerlink" title="1.3 删除用户"></a>1.3 删除用户</h5><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h4 id="2、权限管理"><a href="#2、权限管理" class="headerlink" title="2、权限管理"></a><strong>2、权限管理</strong></h4><p>(1)增删改查数据的权限：<code>select、insert、update、delete</code></p>
<p>(2)表操作权限：<code>create、drop、alter</code></p>
<p>(3)其它权限：<code>index</code>（索引权限）、<code>all</code>(所有权限)、<code>grant option</code>(给其它用户授权的权限)</p>
<p>查看当前登陆的用户所有的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> GRANTS;</span><br></pre></td></tr></table></figure>

<p>查看指定用户的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="2-1-授权"><a href="#2-1-授权" class="headerlink" title="2.1 授权"></a>2.1 授权</h5><p>给用户授予指定数据库下的指定表查询的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> test.c_teacher <span class="keyword">TO</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>添加其他权限</p>
<p>指定库下的所有表授予查询权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> test.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>更新的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> test.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h5 id="2-2-回收权限"><a href="#2-2-回收权限" class="headerlink" title="2.2 回收权限"></a>2.2 回收权限</h5><p>回收指定的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> test.c_teacher <span class="keyword">FROM</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> test.c_teacher <span class="keyword">FROM</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>回收所有的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> test.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;tom&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br></pre></td></tr></table></figure>





<h3 id="常用的函数"><a href="#常用的函数" class="headerlink" title="常用的函数"></a><strong>常用的函数</strong></h3><p>sql语言中提供了很多内置函数</p>
<h4 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h4><p><strong>1.null 处理函数</strong><br><strong>2.聚合函数</strong><br><strong>3.数学函数</strong><br><strong>4.字符串函数</strong><br><strong>5.日期和时间函数</strong><br><strong>6.流程控制函数</strong></p>
<h4 id="1-null-值处理函数"><a href="#1-null-值处理函数" class="headerlink" title="1. null 值处理函数"></a>1. null 值处理函数</h4><p><code>COALESCE(字段名，value)</code><br>字段名的值不为null，返回该字段的值<br>字段名的值为null，返回value值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查询教师表中老师的姓名和奖金</span><br><span class="line"><span class="keyword">SELECT</span> tname,comm <span class="keyword">FROM</span> c_teacher;</span><br><span class="line"></span><br><span class="line">查询教师表中老师的姓名和奖金，奖金为<span class="keyword">null</span>显示<span class="number">0</span></span><br><span class="line"><span class="keyword">SELECT</span> tname,<span class="built_in">COALESCE</span>(comm,<span class="number">0</span>) <span class="string">&#x27;奖金&#x27;</span> <span class="keyword">FROM</span> c_teacher;</span><br><span class="line"></span><br><span class="line">查询老师的月薪</span><br><span class="line">注意：任意值和<span class="keyword">null</span>进行运算，结果都是<span class="keyword">null</span></span><br><span class="line"><span class="keyword">SELECT</span> tname,sal<span class="operator">+</span>comm <span class="keyword">AS</span> <span class="string">&#x27;月薪&#x27;</span> <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<p>将null值处理后再进行计算</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tname,sal<span class="operator">+</span><span class="built_in">COALESCE</span>(comm,<span class="number">0</span>) <span class="keyword">AS</span> <span class="string">&#x27;月薪&#x27;</span> <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>



<h4 id="2-聚合函数"><a href="#2-聚合函数" class="headerlink" title="2. 聚合函数"></a>2. 聚合函数</h4><h5 id="2-1-常用的5个聚合函数：count-max-min-sum-avg"><a href="#2-1-常用的5个聚合函数：count-max-min-sum-avg" class="headerlink" title="2.1 常用的5个聚合函数：count,max,min,sum,avg"></a>2.1 常用的5个聚合函数：<code>count,max,min,sum,avg</code></h5><h5 id="2-2-group-concat"><a href="#2-2-group-concat" class="headerlink" title="2.2 group _concat()"></a>2.2 <code>group _concat()</code></h5><p><code>group _concat()</code>是 <strong>mysql</strong> 的<strong>特有</strong>聚合函数</p>
<p>(1)用于将分组内的指定字段值连接成一个字符串返回</p>
<p>(2)通常与 group by 配合使用</p>
<p>(3)如果没有使用group by, 会将整张表当成一个分组</p>
<p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">group</span> _concat([<span class="keyword">distinct</span>] 要链接的字段 [<span class="keyword">order</span> <span class="keyword">by</span>] [separator<span class="string">&#x27;分隔符&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>默认分隔符逗号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dno <span class="keyword">AS</span><span class="string">&#x27;部门&#x27;</span>,GROUP_CONCAT(tname)</span><br><span class="line"><span class="keyword">FROM</span> c_teacher</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dno ;</span><br></pre></td></tr></table></figure>

<p>去重</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dno <span class="keyword">AS</span><span class="string">&#x27;部门&#x27;</span>,GROUP_CONCAT(<span class="keyword">DISTINCT</span> tname)</span><br><span class="line"><span class="keyword">FROM</span> c_teacher</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dno ;</span><br></pre></td></tr></table></figure>

<p>指定分隔符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dno <span class="keyword">AS</span><span class="string">&#x27;部门&#x27;</span>,GROUP_CONCAT(tname SEPARATOR <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"><span class="keyword">FROM</span> c_teacher</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dno ;</span><br></pre></td></tr></table></figure>

<p>指定字段排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dno <span class="keyword">AS</span><span class="string">&#x27;部门&#x27;</span>,GROUP_CONCAT(tname <span class="keyword">ORDER</span> <span class="keyword">BY</span> tname SEPARATOR <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"><span class="keyword">FROM</span> c_teacher</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dno ;</span><br></pre></td></tr></table></figure>

<p>注意：不适用 group by 分组，会全表拼接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> GROUP_CONCAT(tname) <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>



<h4 id="3、数学函数"><a href="#3、数学函数" class="headerlink" title="3、数学函数"></a>3、数学函数</h4><h5 id="3-1-PI-返回pi值"><a href="#3-1-PI-返回pi值" class="headerlink" title="3.1 PI() 返回pi值"></a>3.1 <code>PI()</code> 返回pi值</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> PI();	<span class="comment">-- 3.141593</span></span><br></pre></td></tr></table></figure>



<h5 id="3-2-向上取整ceil-ceiling"><a href="#3-2-向上取整ceil-ceiling" class="headerlink" title="3.2 向上取整	ceil()    ceiling()"></a><strong>3.2 向上取整	<code>ceil()</code>    <code>ceiling()</code></strong></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">1.1</span>);   <span class="comment">--2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">-1.9</span>);  <span class="comment">--1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEILING</span>(<span class="number">-1.9</span>);   <span class="comment">--1</span></span><br></pre></td></tr></table></figure>



<h5 id="3-3-向下取整floor"><a href="#3-3-向下取整floor" class="headerlink" title="3.3 向下取整	floor()"></a><strong>3.3 向下取整	<code>floor()</code></strong></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">1.9</span>);  <span class="comment">--1</span></span><br></pre></td></tr></table></figure>



<h5 id="3-4-返回最大值greatest"><a href="#3-4-返回最大值greatest" class="headerlink" title="3.4 返回最大值	greatest()"></a>3.4 返回最大值	<code>greatest()</code></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> GREATEST(<span class="number">1</span>,<span class="number">6</span>,<span class="number">89</span>,<span class="number">75</span>,<span class="number">23</span>,<span class="number">56</span>);</span><br></pre></td></tr></table></figure>



<h5 id="3-5-返回最小值least"><a href="#3-5-返回最小值least" class="headerlink" title="3.5 返回最小值	least()"></a>3.5 返回最小值	<code>least()</code></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LEAST(<span class="number">1</span>,<span class="number">6</span>,<span class="number">89</span>,<span class="number">75</span>,<span class="number">23</span>,<span class="number">56</span>);</span><br></pre></td></tr></table></figure>



<h5 id="3-6-取模（取余）"><a href="#3-6-取模（取余）" class="headerlink" title="3.6 取模（取余）"></a>3.6 取模（取余）</h5><h5 id="MOD-x-y-返回-x-y-的余数"><a href="#MOD-x-y-返回-x-y-的余数" class="headerlink" title="MOD(x, y)   返回 x &#x2F; y 的余数"></a><code>MOD(x, y)</code>   返回 x &#x2F; y 的余数</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">5</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>



<h5 id="3-7-四舍五入round"><a href="#3-7-四舍五入round" class="headerlink" title="3.7 四舍五入	round()"></a>3.7 四舍五入	<code>round()</code></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">-1.5</span>);  <span class="comment">-- -2</span></span><br></pre></td></tr></table></figure>



<h5 id="3-8-随机数rand-返回-0-1-随机数"><a href="#3-8-随机数rand-返回-0-1-随机数" class="headerlink" title="3.8 随机数	rand()  返回 [0,1) 随机数"></a>3.8 随机数	<code>rand()</code>  返回 [0,1) 随机数</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> RAND();</span><br></pre></td></tr></table></figure>

<p>[0,10]之间的随机整数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(RAND()<span class="operator">*</span><span class="number">11</span>)</span><br></pre></td></tr></table></figure>

<p><strong>公式：</strong></p>
<p><strong>RAND() * (max_val - min_val + 1) + min_val</strong></p>
<h5 id="3-9-截断数字"><a href="#3-9-截断数字" class="headerlink" title="3.9 截断数字"></a><strong>3.9 截断数字</strong></h5><p><code>TRUNCATE(x,d)</code> 将数字x 保留 d 位小数位返回</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">3.141593</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>不处理的结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dno,<span class="built_in">avg</span>(sal) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno;</span><br></pre></td></tr></table></figure>

<p>将查询结果数据处理，保留两位小数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dno,<span class="keyword">TRUNCATE</span>(<span class="built_in">avg</span>(sal),<span class="number">2</span>) <span class="keyword">as</span> <span class="string">&#x27;平均薪资&#x27;</span> <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno;</span><br></pre></td></tr></table></figure>



<h4 id="4、字符串函数"><a href="#4、字符串函数" class="headerlink" title="4、字符串函数"></a>4、字符串函数</h4><h5 id="4-1-ASCII-返回字符的-ASCII-码"><a href="#4-1-ASCII-返回字符的-ASCII-码" class="headerlink" title="4.1 ASCII() 返回字符的 ASCII 码"></a>4.1 <code>ASCII()</code> 返回字符的 ASCII 码</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ASCII(<span class="string">&#x27;A&#x27;</span>);  <span class="comment">--65</span></span><br><span class="line"><span class="keyword">SELECT</span> ASCII(<span class="string">&#x27;a&#x27;</span>);  <span class="comment">--97</span></span><br><span class="line"><span class="keyword">SELECT</span> ASCII(<span class="string">&#x27;中&#x27;</span>);  <span class="comment">--228</span></span><br><span class="line"><span class="keyword">SELECT</span> ASCII(<span class="string">&#x27;国&#x27;</span>);  <span class="comment">--229</span></span><br></pre></td></tr></table></figure>



<h5 id="4-2-字符串拼接"><a href="#4-2-字符串拼接" class="headerlink" title="4.2 字符串拼接"></a><strong>4.2 字符串拼接</strong></h5><p><code>concat(str1,str2, ...)</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;Hello&#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;World !&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>拼接教师编号和姓名，格式：编号-姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(tno,<span class="string">&#x27;-&#x27;</span>,tname) <span class="string">&#x27;基本信息&#x27;</span> <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h5 id="4-3插入替换"><a href="#4-3插入替换" class="headerlink" title="4.3插入替换"></a>4.3插入替换</h5><p><code>insert(str, start, length, &#39;newStr&#39;)</code><br>操作字符串 str,从 start 位置开始，替换 length 个字符，替换为’newStr’<br>这里的start表示第几个字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSERT</span>(<span class="string">&#x27;万里长城万里长&#x27;</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="string">&#x27;黄河&#x27;</span>);		<span class="comment">-- 万里黄河万里长</span></span><br></pre></td></tr></table></figure>



<h5 id="4-4-转小写字符"><a href="#4-4-转小写字符" class="headerlink" title="4.4 转小写字符"></a>4.4 转小写字符</h5><p><code>lcase</code> 和 <code>lower</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LCASE(<span class="string">&#x27;aBCdEFg&#x27;</span>);  <span class="comment">-- abcdefg</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(<span class="string">&#x27;aBCdEFg&#x27;</span>);  <span class="comment">-- abcdefg</span></span><br></pre></td></tr></table></figure>



<h5 id="4-4-转大写字符"><a href="#4-4-转大写字符" class="headerlink" title="4.4 转大写字符"></a>4.4 转大写字符</h5><p><code>ucase</code> 和 <code>upper</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> UCASE(<span class="string">&#x27;aBCdEFg&#x27;</span>);  <span class="comment">-- ABCDEFG</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(<span class="string">&#x27;aBCdEFg&#x27;</span>);  <span class="comment">-- ABCDEFG</span></span><br></pre></td></tr></table></figure>



<h5 id="4-5-去首尾空格trim"><a href="#4-5-去首尾空格trim" class="headerlink" title="4.5 去首尾空格	trim()"></a>4.5 <strong>去首尾空格	<code>trim()</code></strong></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="string">&#x27; AB &#x27;</span>);</span><br></pre></td></tr></table></figure>



<h5 id="4-7-反转字符串reverse"><a href="#4-7-反转字符串reverse" class="headerlink" title="4.7 反转字符串	reverse()"></a>4.7 反转字符串	<code>reverse()</code></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> REVERSE(<span class="string">&#x27;上海自来水来自海上！！！&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h5 id="4-8返回字符串左边指定个数的字符left-str-len"><a href="#4-8返回字符串左边指定个数的字符left-str-len" class="headerlink" title="4.8返回字符串左边指定个数的字符	left(str, len)"></a>4.8返回字符串左边指定个数的字符	<code>left(str, len)</code></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">&#x27;今朝有酒今朝醉&#x27;</span>, <span class="number">3</span>);	<span class="comment">-- 今朝有</span></span><br></pre></td></tr></table></figure>

<p>查询教师表中所有老师的姓 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(tname,<span class="number">1</span>) <span class="keyword">AS</span> <span class="string">&#x27;姓氏&#x27;</span> <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>



<h5 id="4-9-返回字符串的长度length"><a href="#4-9-返回字符串的长度length" class="headerlink" title="4.9 返回字符串的长度	length()"></a>4.9 返回字符串的长度	<code>length()</code></h5><p>一个汉字占3个字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;长城外面是故乡&#x27;</span>);   <span class="comment">-- 21</span></span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;hello&#x27;</span>);   <span class="comment">-- 5</span></span><br></pre></td></tr></table></figure>



<h5 id="4-10-字符串比较strcmp-str1-str2"><a href="#4-10-字符串比较strcmp-str1-str2" class="headerlink" title="4.10 字符串比较	strcmp(str1,str2)"></a>4.10 字符串比较	<code>strcmp(str1,str2)</code></h5><p>不区分大小写，比大小<br>str1 &gt; str2返回1<br>str1 &lt; str2<br>str1 &#x3D; str2返回 0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> STRCMP(<span class="string">&#x27;F&#x27;</span>,<span class="string">&#x27;B&#x27;</span>);	   <span class="comment">-- 1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> STRCMP(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;B&#x27;</span>);	<span class="comment">-- 0</span></span><br></pre></td></tr></table></figure>



<h5 id="4-11-返回字符出现的第一次位置"><a href="#4-11-返回字符出现的第一次位置" class="headerlink" title="4.11 返回字符出现的第一次位置"></a>4.11 返回字符出现的第一次位置</h5><p><code>position(substr in str)</code><br>返回substr在str字符串中第一次出现的位置<br>注意：位置指的是第几个字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">POSITION</span>(<span class="string">&#x27;长城&#x27;</span> <span class="keyword">IN</span> <span class="string">&#x27;万里长城万里长，长城外面是故乡&#x27;</span>); <span class="comment">-- 3</span></span><br></pre></td></tr></table></figure>



<h5 id="4-12-截取字符串"><a href="#4-12-截取字符串" class="headerlink" title="4.12 截取字符串"></a><strong>4.12 截取字符串</strong></h5><p><code>substr</code> 和 <code>substring</code><br>SUBSTR(str FROM pos FOR len)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;万里长城万里长&#x27;</span>, <span class="number">2</span>);  <span class="comment">-- 从第二个位置截取道末尾   里长城万里长</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;万里长城万里长&#x27;</span>, <span class="number">3</span>, <span class="number">2</span>); <span class="comment">-- 从第三个位置截取，截取2个字符		长城</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;万里长城万里长&#x27;</span>, <span class="number">2</span>); </span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;万里长城万里长&#x27;</span>, <span class="number">3</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>



<h4 id="5、日期和时间函数"><a href="#5、日期和时间函数" class="headerlink" title="5、日期和时间函数"></a>5、日期和时间函数</h4><h5 id="5-1-返回当前系统时间"><a href="#5-1-返回当前系统时间" class="headerlink" title="5.1 返回当前系统时间"></a>5.1 返回当前系统时间</h5><p>日期：年月日</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CURDATE();  <span class="comment">-- mysql支持</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_DATE</span>;  <span class="comment">-- sql:标准的时间函数</span></span><br></pre></td></tr></table></figure>

<p>时间：时分秒</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CURTIME();</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIME</span>();</span><br></pre></td></tr></table></figure>

<p>年月日+时分秒</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT NOW();</span><br></pre></td></tr></table></figure>



<h5 id="5-2-格式化时间"><a href="#5-2-格式化时间" class="headerlink" title="5.2 格式化时间"></a>5.2 <strong>格式化时间</strong></h5><p><code>DATE_FORMAT(时间,格式)</code><br>通过 <strong>%</strong> 读取时间:<br>		%Y年 %m月 %d日 %H时 %i分 %s秒</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(),<span class="string">&#x27;%Y年%m月%d日 %H时%i分%s秒&#x27;</span>) <span class="keyword">AS</span> <span class="string">&#x27;时间&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>H 24小时制， h 12小时制</p>
<h5 id="5-3-日期和时间计算"><a href="#5-3-日期和时间计算" class="headerlink" title="5.3 日期和时间计算"></a><strong>5.3 日期和时间计算</strong></h5><p><strong>加法运算</strong></p>
<p><code>date_add(date, interval expr unit)</code>在date的基础上加指定时间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="built_in">CURRENT_DATE</span>(),<span class="type">INTERVAL</span> <span class="number">3</span> <span class="keyword">DAY</span>); <span class="comment">-- 在当前系统时间+3天</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="built_in">CURRENT_DATE</span>(),<span class="type">INTERVAL</span> <span class="number">2</span> <span class="keyword">DAY</span>); <span class="comment">-- 在当前系统时间+2月</span></span><br></pre></td></tr></table></figure>

<p>减法运算<br><code>date_sub(date, interval expr unit)</code>在date的基础上减指定时间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_SUB(NOW(),<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>) <span class="comment">-- 减一个月</span></span><br></pre></td></tr></table></figure>



<p><strong>计算时间差</strong>（<strong>天数差</strong>）<br><code>datediff(date1,date2);</code>  计算两个日期的<strong>天数差</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATEDIFF(NOW(),<span class="string">&#x27;2003-01-01&#x27;</span>) <span class="keyword">AS</span> <span class="string">&#x27;天数&#x27;</span>;  <span class="comment">-- 8246</span></span><br></pre></td></tr></table></figure>



<p><strong>指定单位差</strong><br><code>timestampdiff(unit,date1,date2)</code> 根据指定单位计算日期差</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">YEAR</span>,NOW(),<span class="string">&#x27;2003-01-01&#x27;</span>);  <span class="comment">-- -22</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">DAY</span>, NOW(),<span class="string">&#x27;1987-05-06&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">YEAR</span>, NOW(),<span class="string">&#x27;1987-05-06&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">MONTH</span>, NOW(),<span class="string">&#x27;1987-05-06&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h5 id="5-4-获取日期和时间部分"><a href="#5-4-获取日期和时间部分" class="headerlink" title="5.4 获取日期和时间部分"></a>5.4 获取日期和时间部分</h5><p>获取年份</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(now());</span><br></pre></td></tr></table></figure>

<p>获取月份</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(<span class="string">&#x27;2003-11-11&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>获取日</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(<span class="string">&#x27;2003-11-11&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>获取一周的第几天</strong></p>
<p>​		<strong>星期日为第一天</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DAYOFWEEK(NOW());  <span class="comment">-- 4 	星期日为第一天</span></span><br></pre></td></tr></table></figure>

<p><strong>获取时间戳</strong><br>时间戳指的是 指定时间 距离 1970-01-01 00:00:00 的毫秒数<br>1s &#x3D; 1000 ms</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> UNIX_TIMESTAMP(); <span class="comment">-- 获取当前系统时间的时间戳</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> UNIX_TIMESTAMP(<span class="string">&#x27;1970-01-02&#x27;</span>); <span class="comment">-- 根据指定时间格式的字符串获取时间戳</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> FROM_UNIXTIME(<span class="number">1753865651</span>); <span class="comment">-- 将时间戳转换为日期</span></span><br></pre></td></tr></table></figure>




<h5 id="5-5-获取指定日期月份的最后一天"><a href="#5-5-获取指定日期月份的最后一天" class="headerlink" title="5.5 获取指定日期月份的最后一天"></a>5.5 获取指定日期月份的最后一天</h5><p><code>LAST_DAY(date)</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LAST_DAY(<span class="string">&#x27;2025-07-01&#x27;</span>);  <span class="comment">-- 2025-07-31</span></span><br><span class="line"><span class="keyword">SELECT</span> LAST_DAY(NOW());</span><br></pre></td></tr></table></figure>

<p>获取指定月份的 倒数第二天的 （获取日）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(LAST_DAY(NOW()) <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(LAST_DAY(<span class="string">&#x27;2025-02-01&#x27;</span>) <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>);  <span class="comment">-- 27</span></span><br></pre></td></tr></table></figure>



<h4 id="6、流程函数"><a href="#6、流程函数" class="headerlink" title="6、流程函数"></a><strong>6、流程函数</strong></h4><h5 id="6-1-三元运算"><a href="#6-1-三元运算" class="headerlink" title="6.1 三元运算"></a><strong>6.1 三元运算</strong></h5><p><code>if(value,t,f)</code> 条件判断，value值为真，返回 t ，否则返回 f</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname, IF(gender<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;先生&#x27;</span>,<span class="string">&#x27;女生&#x27;</span>)</span><br><span class="line"><span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h5 id="6-2-null-值处理"><a href="#6-2-null-值处理" class="headerlink" title="6.2 null 值处理"></a><strong>6.2 null 值处理</strong></h5><p><code>IFNULL</code>(value1,value2) 如果value1 非 null，返回value1，否则返回value2 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname,IFNULL(dno,<span class="string">&#x27;无部门&#x27;</span>) <span class="keyword">AS</span> <span class="string">&#x27;部门编号&#x27;</span> </span><br><span class="line"><span class="keyword">FROM</span> c_teacher; </span><br></pre></td></tr></table></figure>



<h5 id="6-3-多条件分支"><a href="#6-3-多条件分支" class="headerlink" title="6.3 多条件分支"></a><strong>6.3 多条件分支</strong></h5><p>语法：<br><code>case</code><br>  <code>when [val1] then [result1]</code><br>  <code>when [val2] then [result2]</code><br>  <code>......</code><br><code>else [default]</code><br><code>end;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname,</span><br><span class="line"><span class="keyword">CASE</span> </span><br><span class="line">	<span class="keyword">WHEN</span> dno<span class="operator">=</span><span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;人力部&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> dno<span class="operator">=</span><span class="number">2</span> <span class="keyword">THEN</span> <span class="string">&#x27;产品部&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> dno<span class="operator">=</span><span class="number">3</span> <span class="keyword">THEN</span> <span class="string">&#x27;招生部&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span>  <span class="string">&#x27;其他部门&#x27;</span>	</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">&#x27;部门&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> c_teacher <span class="keyword">ORDER</span> <span class="keyword">BY</span> dno;</span><br></pre></td></tr></table></figure>




<h5 id="6-4-等值判断"><a href="#6-4-等值判断" class="headerlink" title="6.4 等值判断"></a>6.4 等值判断</h5><p>语法：<br>case <strong>value</strong><br>  when value1 then res1<br>  when value2 then res2<br>  when value3 then res3<br>  else dafault<br>end;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">CASE</span> DAYOFWEEK(now())<span class="number">-1</span></span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期一&#x27;</span></span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期二&#x27;</span></span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期三&#x27;</span></span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">4</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期四&#x27;</span></span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">5</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期五&#x27;</span></span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">5</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期六&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span> <span class="string">&#x27;星期天&#x27;</span></span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">&#x27;星期&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname,</span><br><span class="line"><span class="keyword">CASE</span> dno</span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;人力部&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">&#x27;产品部&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="string">&#x27;招生部&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span>  <span class="string">&#x27;其他部门&#x27;</span>	</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">&#x27;部门&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> c_teacher <span class="keyword">ORDER</span> <span class="keyword">BY</span> dno;</span><br></pre></td></tr></table></figure>



<h4 id="函数知识点小结"><a href="#函数知识点小结" class="headerlink" title="函数知识点小结"></a><strong>函数知识点小结</strong></h4><p>  1、null值处理函数: COALESCE()<br>  2、聚合函数，拓展一个 mysql 的聚合函数 group_concat<br>  3、数学函数 </p>
<p>rand() 、TRUNCATE()、floor()、ceil()</p>
<p>4、字符串函数</p>
<p>concate()、trim()、substr()、lower() 和 upper()<br>5、日期函数</p>
<p>CURRENT_DATE()、CURRENT_TIME()</p>
<p>NOW()、DATE_FORMAT()</p>
<p>DATE_ADD()、DATE_SUB()、DATEDIFF()、TIMESTAMPDIFF()</p>
<p>YEAR()、MONTH()、DAY()</p>
<p>DAYOFWEEK()、LAST_DAY()<br>6、流程控制函数</p>
<p>if()、ifnull()、case when 、case value when </p>
<h3 id="数据库表约束"><a href="#数据库表约束" class="headerlink" title="数据库表约束"></a>数据库表约束</h3><p>1、<strong>概念</strong>：约束是作用于作用域中字段上的规则，用于限制存储在表中的数据<br><strong>目的</strong>：保证数据库中数据的正确，有效性和完整性</p>
<p>2、约束的分类</p>
<p>(1)主键约束(<code>primary key</code>):当前字段是数据的唯一标识符，唯一且不能为空<br>(2)外键约束(<code>foreign key</code>): 用来让两张表的数据之间建立连接，保证数据的一致性和完整性(当前表的外键是另一张表的主键)<br>(3)非空约束(<code>not null</code>): 限制当前字段的数据不能为null<br>(4)唯一约束(<code>unique</code>): 保证该字段的所有数据都是唯一、不重复，可以为null<br>(5)检查约束(<code>check</code>): 保证字段的值满足某一个(男&#x2F;女)<br>(6)默认值约束(<code>default</code>): 保存数据时,如果没有指定该字段的值,则采用默认值(入职时间,岗位)</p>
<p><strong>注意</strong>: 在sql中 null 和任何值都不相等,包括null 本身和 null 也不相等</p>
<h4 id="1、主键约束-PRIMARY-KEY"><a href="#1、主键约束-PRIMARY-KEY" class="headerlink" title="1、主键约束(PRIMARY KEY)"></a><strong>1、主键约束(<code>PRIMARY KEY</code>)</strong></h4><h5 id="1-1-创建表的时候，指定主键"><a href="#1-1-创建表的时候，指定主键" class="headerlink" title="1.1 创建表的时候，指定主键"></a>1.1 创建表的时候，指定主键</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> stu01(</span><br><span class="line"><span class="comment">-- `id` INT PRIMARY KEY, -- 在声明字段时标注当前字段是主键</span></span><br><span class="line">`id` <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> auto_increment,</span><br><span class="line"><span class="comment">-- `id` INT,</span></span><br><span class="line">`name` <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line"><span class="comment">--  PRIMARY KEY(id) -- 字段创建完成后，指定主键字段</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="1-2、通过-alter-语法添加主键"><a href="#1-2、通过-alter-语法添加主键" class="headerlink" title="1.2、通过 alter 语法添加主键"></a>1.2、通过 alter 语法添加主键</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> stu02(</span><br><span class="line">`id` <span class="type">INT</span>,</span><br><span class="line">`name` <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- ALTER TABLE stu02 ADD PRIMARY KEY(id); -- 指定表中的 id 字段为主键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> stu02 MODIFY <span class="keyword">COLUMN</span> id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> auto_increment; <span class="comment">-- 设置主键，且主键自增</span></span><br></pre></td></tr></table></figure>

<h5 id="1-3、删除主键约束"><a href="#1-3、删除主键约束" class="headerlink" title="1.3、删除主键约束"></a>1.3、删除主键约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> stu02 <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br></pre></td></tr></table></figure>

<h4 id="2、非空约束-NOT-NULL"><a href="#2、非空约束-NOT-NULL" class="headerlink" title="2、非空约束(NOT NULL)"></a><strong>2、非空约束(<code>NOT NULL</code>)</strong></h4><h5 id="2-1-建表的时候定义字段非空约束"><a href="#2-1-建表的时候定义字段非空约束" class="headerlink" title="2.1 建表的时候定义字段非空约束"></a>2.1 建表的时候定义字段非空约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> stu03(</span><br><span class="line">`id` <span class="type">INT</span>,</span><br><span class="line">`name` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>, <span class="comment">-- 创建字段时 定义为 not null</span></span><br><span class="line">`password`<span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="2-2-alter语法修改字段非空约束"><a href="#2-2-alter语法修改字段非空约束" class="headerlink" title="2.2 alter语法修改字段非空约束"></a>2.2 alter语法修改字段非空约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> stu03 MODIFY `password`<span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>;</span><br></pre></td></tr></table></figure>

<h4 id="3、检查约束-CHECK"><a href="#3、检查约束-CHECK" class="headerlink" title="3、检查约束(CHECK)"></a><strong>3、检查约束(<code>CHECK</code>)</strong></h4><h5 id="3-1-建表时添加-检查字段-check"><a href="#3-1-建表时添加-检查字段-check" class="headerlink" title="3.1 建表时添加 检查字段 check"></a>3.1 建表时添加 检查字段 check</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> stu04(</span><br><span class="line">`id` <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> auto_increment,</span><br><span class="line">`name` <span class="type">VARCHAR</span>(<span class="number">50</span>), </span><br><span class="line">`age` <span class="type">INT</span>,</span><br><span class="line">`gender` <span class="type">CHAR</span>(<span class="number">2</span>) <span class="keyword">CHECK</span> (gender <span class="keyword">in</span>(<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;女&#x27;</span>)) <span class="comment">-- 检查约束</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu04 (name,gender) <span class="keyword">VALUES</span>(<span class="string">&#x27;frank&#x27;</span>,<span class="string">&#x27;妖怪&#x27;</span>); <span class="comment">-- 添加失败，不符合约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu04 (name,gender) <span class="keyword">VALUES</span>(<span class="string">&#x27;frank&#x27;</span>,<span class="string">&#x27;男&#x27;</span>); <span class="comment">-- 可以添加</span></span><br></pre></td></tr></table></figure>

<h5 id="3-2-通过alter-语法添加-检查约束"><a href="#3-2-通过alter-语法添加-检查约束" class="headerlink" title="3.2 通过alter 语法添加 检查约束"></a>3.2 通过alter 语法添加 检查约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> stu04 <span class="keyword">ADD CONSTRAINT</span> ck_stu04_age <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span><span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span><span class="number">120</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu04 (name,,age,gender) <span class="keyword">VALUES</span>(<span class="string">&#x27;frank&#x27;</span>,<span class="number">15</span>,<span class="string">&#x27;男&#x27;</span>); <span class="comment">-- 年龄不符合检查约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu04 (name,age,gender) <span class="keyword">VALUES</span>(<span class="string">&#x27;jack&#x27;</span>,<span class="number">25</span>,<span class="string">&#x27;男&#x27;</span>); </span><br></pre></td></tr></table></figure>

<h4 id="4、唯一约束（UNIQUE）"><a href="#4、唯一约束（UNIQUE）" class="headerlink" title="4、唯一约束（UNIQUE）"></a><strong>4、唯一约束（<code>UNIQUE</code>）</strong></h4><h5 id="4-1-建表时添加-唯一约束"><a href="#4-1-建表时添加-唯一约束" class="headerlink" title="4.1 建表时添加 唯一约束"></a>4.1 建表时添加 唯一约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> stu05(</span><br><span class="line">`id` <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> auto_increment,</span><br><span class="line">`name` <span class="type">VARCHAR</span>(<span class="number">50</span>), </span><br><span class="line">`age` <span class="type">INT</span>,</span><br><span class="line">`card_number` <span class="type">CHAR</span>(<span class="number">18</span>) <span class="keyword">UNIQUE</span>  <span class="comment">-- 唯一约束</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu05 (name,card_number) <span class="keyword">VALUES</span>(<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;362326202507311234&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> stu05 (name,card_number) <span class="keyword">VALUES</span>(<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;362326202507311234&#x27;</span>); <span class="comment">-- 失败，重复的值不能添加</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu05 (name,card_number) <span class="keyword">VALUES</span>(<span class="string">&#x27;rose&#x27;</span>,<span class="keyword">null</span>); <span class="comment">-- 可以添加null</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu05 (name,card_number) <span class="keyword">VALUES</span>(<span class="string">&#x27;alex&#x27;</span>,<span class="keyword">null</span>); <span class="comment">-- null 可以重复添加</span></span><br></pre></td></tr></table></figure>

<h5 id="4-2-alter-语法添加唯一约束"><a href="#4-2-alter-语法添加唯一约束" class="headerlink" title="4.2 alter 语法添加唯一约束"></a>4.2 alter 语法添加唯一约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> stu05 <span class="keyword">ADD CONSTRAINT</span> uk_stu05_name <span class="keyword">UNIQUE</span> (name);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu05 (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;rose&#x27;</span>); <span class="comment">-- 失败，重复的名字不能新增</span></span><br></pre></td></tr></table></figure>

<h4 id="5、默认值约束-DEFAULT"><a href="#5、默认值约束-DEFAULT" class="headerlink" title="5、默认值约束(DEFAULT)"></a><strong>5、默认值约束(<code>DEFAULT</code>)</strong></h4><h5 id="5-1-建表时-指定默认值"><a href="#5-1-建表时-指定默认值" class="headerlink" title="5.1 建表时 指定默认值"></a>5.1 建表时 指定默认值</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> stu06(</span><br><span class="line">`id` <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> auto_increment,</span><br><span class="line">`name` <span class="type">VARCHAR</span>(<span class="number">50</span>), </span><br><span class="line">`age` <span class="type">INT</span>,</span><br><span class="line">`gender` <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;male&#x27;</span> <span class="comment">-- 默认值约束</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> stu06 (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;rose&#x27;</span>); </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> stu06;</span><br></pre></td></tr></table></figure>

<h5 id="5-2-alter-语法设置默认值"><a href="#5-2-alter-语法设置默认值" class="headerlink" title="5.2 alter 语法设置默认值"></a>5.2 alter 语法设置默认值</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> stu06 MODIFY `name` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;user&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="6、外键约束-FOREIGN-KEY"><a href="#6、外键约束-FOREIGN-KEY" class="headerlink" title="6、外键约束(FOREIGN KEY)"></a><strong>6、外键约束(<code>FOREIGN KEY</code>)</strong></h4><p>外键是用来让两张表的数据建立连接保证数据的一致性和完整性<br> 创建时表指定外键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> 表名(</span><br><span class="line">字段名 类型,</span><br><span class="line">...</span><br><span class="line">[<span class="keyword">CONSTRAINT</span>][外键名称] <span class="keyword">FOREIGN KEY</span> (外键的字段名) <span class="keyword">REFERENCES</span> 主表 (主表字段名)</span><br><span class="line"><span class="comment">-- 例如：constraint fk_teacher_dno foreign key (dno) references dept (dno)</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p> 使用ALTER 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--  alter table 表名 add constraint 外键名称 foreign key (外键的字段名) references 主表 (主表字段名)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将 c_teacher 表的 dno 字段 与 c_dept 表使用外键约束关联</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter table</span> c_teacher <span class="keyword">add constraint</span> fk_teacher_dno <span class="keyword">foreign key</span> (dno) <span class="keyword">references</span> c_dept (dno); </span><br></pre></td></tr></table></figure>

<p> <strong>注意：一旦建立了外键约束，不能随意删除主表数据</strong></p>
<h3 id="1、子查询"><a href="#1、子查询" class="headerlink" title="1、子查询"></a><strong>1、子查询</strong></h3><p>子查询：在查询语句的 select、from、where、having<br>关键字的后面，都可以包含另外的查询语句<br>外层查询：主查询<br>内层查询：子查询<br>执行顺序：一般是先执行子查询，然后将子查询的结果带入到主查询中，得出最终的结果</p>
<h5 id="1-1单行子查询：返回一条结果"><a href="#1-1单行子查询：返回一条结果" class="headerlink" title="1.1单行子查询：返回一条结果"></a>1.1单行子查询：<strong>返回一条结果</strong></h5><p>查询教师表中	工资比	秦占豪	高的老师信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tname, sal <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tname<span class="operator">=</span><span class="string">&#x27;秦占豪&#x27;</span>;	<span class="comment">-- 31564.79</span></span><br><span class="line"><span class="keyword">SELECT</span> tname, sal <span class="keyword">FROM</span>  c_teacher <span class="keyword">WHERE</span> sal<span class="operator">&gt;</span><span class="number">31564.79</span>;</span><br></pre></td></tr></table></figure>

<p>子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> c_teacher</span><br><span class="line"><span class="keyword">WHERE</span> sal<span class="operator">&gt;</span>(</span><br><span class="line">  <span class="keyword">SELECT</span> sal</span><br><span class="line">  <span class="keyword">FROM</span> c_teacher</span><br><span class="line">  <span class="keyword">WHERE</span> tname <span class="operator">=</span> <span class="string">&#x27;秦占豪&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>练：查询招生部所有男老师的姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--先查询出招生部的编号</span></span><br><span class="line"><span class="keyword">SELECT</span> dno <span class="keyword">FROM</span> c_dept <span class="keyword">WHERE</span> dname<span class="operator">=</span><span class="string">&#x27;招生部&#x27;</span>; <span class="comment">-- 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--再根据编号出该部门编号的所有老师，筛选出男老师</span></span><br><span class="line"><span class="keyword">SELECT</span> tname, gender, dno <span class="keyword">FROM</span> c_teacher</span><br><span class="line"><span class="keyword">WHERE</span> dno<span class="operator">=</span>(</span><br><span class="line"><span class="keyword">SELECT</span> dno <span class="keyword">FROM</span> c_dept <span class="keyword">WHERE</span> dname<span class="operator">=</span><span class="string">&#x27;招生部&#x27;</span></span><br><span class="line">) <span class="keyword">AND</span> gender<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p>给表取别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tname,t.gender,t.dno</span><br><span class="line"><span class="keyword">FROM</span> c_teacher <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">WHERE</span> t.dno<span class="operator">=</span>(</span><br><span class="line"><span class="keyword">SELECT</span> d.dno <span class="keyword">FROM</span> c_dept d <span class="keyword">WHERE</span> d.dname<span class="operator">=</span><span class="string">&#x27;招生部&#x27;</span></span><br><span class="line">) <span class="keyword">AND</span> gender<span class="operator">=</span><span class="string">&#x27;男&#x27;</span>;</span><br></pre></td></tr></table></figure>




<h5 id="1-2-多行子查询，查询返回多条记录"><a href="#1-2-多行子查询，查询返回多条记录" class="headerlink" title="1.2 多行子查询，查询返回多条记录"></a>1.2 多行子查询，<strong>查询返回多条记录</strong></h5><p><code>in</code> : 条件满足列表中的一个即可，例如：a in(x,y,z),a等于其中一个即可<br><code>any</code> : 和子查询中返回的任意一个值比较，例如 a &gt; any(100,200,300) ，a<strong>大于最小</strong>的即可<br><code>all</code> : 和子查询和子查询中返回所有值比较，例如 a &gt; all(100,200,300)，a<strong>大于最大</strong>的即可</p>
<p>需求：查询出地址时北京海淀的所有老师信息 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--先查询出所有地址是北京海淀的 部门编号</span></span><br><span class="line"><span class="keyword">SELECT</span> dno <span class="keyword">FROM</span> c_dept <span class="keyword">WHERE</span> loc<span class="operator">=</span><span class="string">&#x27;北京海淀&#x27;</span>; <span class="comment">-- 1 2 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--再根据部门编号查询出符合条件的所有老师</span></span><br><span class="line"><span class="keyword">SELECT</span> tname,dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tname,t.dno <span class="keyword">FROM</span> c_teacher t <span class="keyword">WHERE</span> t.dno <span class="keyword">in</span>(</span><br><span class="line"><span class="keyword">SELECT</span> d.dno <span class="keyword">FROM</span> c_dept d <span class="keyword">WHERE</span> d.loc<span class="operator">=</span><span class="string">&#x27;北京海淀&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>练习：<br>练：查询工资比1号部门任意一个教师工资高的老师编号、姓名和工资信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname,sal <span class="keyword">FROM</span> c_teacher;</span><br><span class="line"><span class="keyword">SELECT</span> dno,dname <span class="keyword">FROM</span> c_dept <span class="keyword">WHERE</span> dno<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> t.tno,t.tname,t.sal </span><br><span class="line"><span class="keyword">FROM</span> c_teacher t</span><br><span class="line"><span class="keyword">WHERE</span> sal <span class="operator">&gt;</span><span class="keyword">ANY</span>(</span><br><span class="line">  <span class="keyword">SELECT</span> sal </span><br><span class="line">  <span class="keyword">FROM</span> c_teacher </span><br><span class="line">  <span class="keyword">WHERE</span> dno<span class="operator">=</span><span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>练：查询工资比2号部门所有老师工资都高的老师编号、姓名和工资信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tno,t.tname,t.sal <span class="keyword">FROM</span> c_teacher t</span><br><span class="line"><span class="keyword">WHERE</span> t.sal <span class="operator">&gt;</span> <span class="keyword">ALL</span>(</span><br><span class="line">  <span class="keyword">SELECT</span> sal</span><br><span class="line">  <span class="keyword">FROM</span> c_teacher </span><br><span class="line">  <span class="keyword">WHERE</span> dno<span class="operator">=</span><span class="number">2</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>练：查询有 营销专员 的部门中所有教师编号、姓名、部门编号和岗位信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tno,t.tname,t.dno,t.job </span><br><span class="line"><span class="keyword">FROM</span> c_teacher t</span><br><span class="line"><span class="keyword">WHERE</span> dno <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> dno <span class="keyword">FROM</span> </span><br><span class="line"><span class="string">&#x27;营销专员&#x27;</span> </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>练：所有在人力部、招生部的教师编号、姓名、部门编号信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tno,t.tname,t.dno </span><br><span class="line"><span class="keyword">FROM</span> c_teacher t</span><br><span class="line"><span class="keyword">WHERE</span> t.dno <span class="keyword">IN</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> dno </span><br><span class="line">  <span class="keyword">FROM</span> c_dept </span><br><span class="line">  <span class="keyword">WHERE</span> dname <span class="keyword">IN</span>(<span class="string">&#x27;人力部&#x27;</span>,<span class="string">&#x27;招生部&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>练：所有老师的姓名和该老师的部门名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tname,<span class="built_in">COALESCE</span>( (</span><br><span class="line"><span class="keyword">SELECT</span> dname <span class="keyword">FROM</span> c_dept d <span class="keyword">WHERE</span> t.dno<span class="operator">=</span>d.dno <span class="comment">-- teacher表和dept表相匹配的数据</span></span><br><span class="line">), <span class="string">&#x27;混吃等死部门&#x27;</span>)</span><br><span class="line"><span class="keyword">FROM</span> c_teacher t;</span><br></pre></td></tr></table></figure>



<h5 id="1-3-EXISTS-和-NOT-EXISTS"><a href="#1-3-EXISTS-和-NOT-EXISTS" class="headerlink" title="1.3  EXISTS 和 NOT EXISTS"></a>1.3  <strong>EXISTS</strong> 和 <strong>NOT EXISTS</strong></h5><p>用于判断子查询是否返回结果的逻辑运算符、</p>
<p>核心解决“是否存在满足条件的记录”的问题</p>
<p><code>EXISTS</code> ：检查子查询是否 <strong>至少返回一条</strong>数据（只要有结果，立即返回）</p>
<p><code>NOT EXISTS</code>：检查子查询是否 <strong>返回0行数据</strong>（只有无结果时，才返回true）</p>
<p>查询有部门的老师信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname,dno <span class="keyword">FROM</span> c_teacher t</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	 <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_dept d</span><br><span class="line">	 <span class="keyword">WHERE</span> t.dno<span class="operator">=</span>d.dno <span class="comment">-- 关联部门表</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>没有部门的老师信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno, tname, dno <span class="keyword">FROM</span> c_teacher t</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_dept d</span><br><span class="line"><span class="keyword">WHERE</span> t.dno <span class="operator">=</span> d.dno <span class="comment">--关联部门表</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h3 id="2、多表连接查询"><a href="#2、多表连接查询" class="headerlink" title="2、多表连接查询"></a><strong>2、多表连接查询</strong></h3><p><strong>连接查询</strong>：使用一张以上的表根据指定条件查询<br><strong>多表连接</strong>：用一张主表作为结果集，将其他表的记录 有选择的连接在主表的结果集上<br><strong>常见的连接查询</strong>：内连接、外连接、自连接和交叉连接（笛卡尔积）</p>
<h5 id="2-1-外连接"><a href="#2-1-外连接" class="headerlink" title="2.1 外连接"></a>2.1 外连接</h5><p>左外连接 和 右外连接<br>（1）<strong>左外连接</strong>：从左表（表1）中返回所有记录，即便右表（表2）中没有匹配的行<br>语法：<br>SELECT 字段1,字段2,… FROM 表1 LEFT JOIN 表2 ON 连接条件</p>
<p>（2）<strong>右外连接</strong>：从右表（表1）中返回所有记录，即便左表（表2）中没有匹配的行<br>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段<span class="number">1</span>,字段<span class="number">2</span>,... <span class="keyword">FROM</span> 表<span class="number">2</span> <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> 表<span class="number">1</span> <span class="keyword">ON</span> 连接条件</span><br></pre></td></tr></table></figure>

<p>查询所有老师的信息和该老师的部门名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.<span class="operator">*</span>, d.dname </span><br><span class="line"><span class="keyword">FROM</span> c_teacher t <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> c_dept d </span><br><span class="line"><span class="keyword">ON</span> t.dno<span class="operator">=</span>d.dno; </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> c_teacher t <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> c_dept d </span><br><span class="line"><span class="keyword">ON</span> t.dno<span class="operator">=</span>d.dno; </span><br></pre></td></tr></table></figure>

<p>练：查询工作地点在北京海淀的老师信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.loc,t.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> c_teacher t <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> c_dept d </span><br><span class="line"><span class="keyword">ON</span> t.dno<span class="operator">=</span>d.dno</span><br><span class="line"><span class="keyword">WHERE</span> d.loc<span class="operator">=</span><span class="string">&#x27;北京海淀&#x27;</span>; </span><br></pre></td></tr></table></figure>

<p>练：查询薪水等级(c_salgrade)为4的教师编号、姓名、薪水等级和薪水所在区间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tno,t.tname,g.grade </span><br><span class="line"><span class="keyword">FROM</span> c_teacher t <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> c_salgrade g</span><br><span class="line"><span class="keyword">ON</span> t.sal <span class="keyword">BETWEEN</span> g.losal <span class="keyword">AND</span> g.hisal</span><br><span class="line"><span class="keyword">WHERE</span> g.grade<span class="operator">=</span><span class="number">4</span>;</span><br></pre></td></tr></table></figure>



<h5 id="2-2-内连接"><a href="#2-2-内连接" class="headerlink" title="2.2 内连接"></a>2.2 内连接</h5><p>两张表的记录满足条件，两张表的记录合并成一条记录，返回到结果集</p>
<p><strong>注意</strong> :<br><strong>内连接</strong>：返回所有满足条件的数据，不满足条件的数据不返回<br><strong>外连接</strong>：返回主表的所有记录，满足条件的就连接到主表，<strong>不满足条件的返回null</strong><br>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段<span class="number">1</span>,字段<span class="number">2</span>,... <span class="keyword">FROM</span> 表<span class="number">1</span> [<span class="keyword">INNER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 连接条件</span><br></pre></td></tr></table></figure>

<p>查询所有  有部门的（非空） 老师的信息和该老师的部门名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tno,t.tname,t.dno,d.dname</span><br><span class="line"><span class="keyword">FROM</span> c_teacher t <span class="keyword">INNER</span> <span class="keyword">JOIN</span> c_dept d</span><br><span class="line"><span class="keyword">ON</span> t.dno<span class="operator">=</span>d.dno; <span class="comment">-- INNER 可省略</span></span><br></pre></td></tr></table></figure>

<p>练：查询教师编号、姓名、薪水、薪水等级</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tno,t.tname,t.sal,g.grade</span><br><span class="line"><span class="keyword">FROM</span> c_teacher t <span class="keyword">INNER</span> <span class="keyword">JOIN</span> c_salgrade g</span><br><span class="line"><span class="keyword">ON</span> sal <span class="keyword">BETWEEN</span> g.losal <span class="keyword">AND</span> g.hisal;</span><br></pre></td></tr></table></figure>

<p>练：查询薪水等级为4的教师编号、姓名、薪水等级和薪水所在区间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.tno,t.tname,t.sal,g.grade</span><br><span class="line"><span class="keyword">FROM</span> c_teacher t <span class="keyword">INNER</span> <span class="keyword">JOIN</span> c_salgrade g</span><br><span class="line"><span class="keyword">ON</span> sal <span class="keyword">BETWEEN</span> g.losal <span class="keyword">AND</span> g.hisal</span><br><span class="line"><span class="keyword">WHERE</span> g.grade<span class="operator">=</span><span class="number">4</span>;</span><br></pre></td></tr></table></figure>



<h5 id="2-3-自连接"><a href="#2-3-自连接" class="headerlink" title="2.3  自连接"></a><strong>2.3  自连接</strong></h5><p>概念：数据表与自身进行连接</p>
<p>查询所有老师姓名和对应的导师姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.tno <span class="string">&#x27;老师编号&#x27;</span>,t1.tname <span class="string">&#x27;老师姓名&#x27;</span>,t2.tno <span class="string">&#x27;导师编号&#x27;</span>,t2.tname <span class="string">&#x27;导师姓名&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> c_teacher t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> c_teacher t2</span><br><span class="line"><span class="keyword">ON</span> t1.mgrno<span class="operator">=</span>t2.tno;</span><br></pre></td></tr></table></figure>

<p>查询分类表 t_category<br>查询父类别名称和 其对应的子类别名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c1.categoryName <span class="string">&#x27;父类别名称&#x27;</span>,c2.categoryName <span class="string">&#x27;子类别名称&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> t_category c1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> t_category c2</span><br><span class="line"><span class="keyword">ON</span> c1.categoryid<span class="operator">=</span>c2.pid;</span><br></pre></td></tr></table></figure>



<h5 id="2-4-交叉链接（笛卡尔积）"><a href="#2-4-交叉链接（笛卡尔积）" class="headerlink" title="2.4 交叉链接（笛卡尔积）"></a><strong>2.4 交叉链接（笛卡尔积）</strong></h5><p>交叉连接 会产生笛卡尔积（结果是两个表的记录数相乘）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> c_teacher,c_dept; <span class="comment">-- 539</span></span><br></pre></td></tr></table></figure>



<h5 id="2-5-联合查询"><a href="#2-5-联合查询" class="headerlink" title="2.5 联合查询"></a><strong>2.5 联合查询</strong></h5><p>两个操作符：<br>（1）<code>union all</code> ：将 两个查询结果合并成一个结果集，<strong>不会去重</strong><br>（2）<code>union</code> ：将 两个查询结果合并成一个结果集，<strong>会去重</strong>（重复的记录只保留一条）</p>
<p>查询1 6 66 号老师<br>查询1 7 号老师<br><strong>UNION去重</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tno <span class="keyword">IN</span>(<span class="number">1</span>,<span class="number">6</span>,<span class="number">66</span>)</span><br><span class="line"><span class="keyword">UNION</span> </span><br><span class="line"><span class="keyword">SELECT</span> tno,tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tno <span class="keyword">IN</span>(<span class="number">1</span>,<span class="number">7</span>);		<span class="comment">-- 4条数据</span></span><br></pre></td></tr></table></figure>

<p><strong>UNION ALL不去重</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tno,tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tno <span class="keyword">IN</span>(<span class="number">1</span>,<span class="number">6</span>,<span class="number">66</span>)</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> tno,tname <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tno <span class="keyword">IN</span>(<span class="number">1</span>,<span class="number">7</span>);		<span class="comment">-- 5条数据</span></span><br></pre></td></tr></table></figure>



<h3 id="08-视图"><a href="#08-视图" class="headerlink" title="08-视图"></a>08-视图</h3><h4 id="1-视图-view-："><a href="#1-视图-view-：" class="headerlink" title="1.视图(view)："></a>1.视图(view)：</h4><p>​	是mysql中一种<strong>虚拟表</strong>，他是基于sql查询语句的结果生成的一张不存在的表</p>
<h4 id="2-作用："><a href="#2-作用：" class="headerlink" title="2.作用："></a><strong>2.作用：</strong></h4><blockquote>
<ul>
<li>(1)<strong>简化复杂查询</strong>：<strong>封装</strong>常用的查询逻辑，使sql更易理解和维护</li>
<li>(2)<strong>数据安全</strong>：通过视图控制用户对敏感数据的访问权限</li>
<li>(3)<strong>逻辑隔离</strong>：屏蔽底层表结构变化，提供统一的数据接口</li>
<li>总的来说，视图可以简化复杂查询，增强数据的安全性和逻辑性</li>
</ul>
</blockquote>
<h4 id="3-创建视图的语法："><a href="#3-创建视图的语法：" class="headerlink" title="3.创建视图的语法："></a>3.创建视图的语法：</h4><blockquote>
<p><code>create [or replace] view 视图名称 as select 语句</code><br>说明： or replace 表示视图如果存在，则替换原来的视图</p>
</blockquote>
<h4 id="1-基本用法"><a href="#1-基本用法" class="headerlink" title="1.基本用法"></a>1.基本用法</h4><h5 id="1-1-创建视图"><a href="#1-1-创建视图" class="headerlink" title="1.1 创建视图"></a>1.1 创建视图</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_teacher</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, job, sal <span class="keyword">FROM</span> c_teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_teacher_dept</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> tno, tname, job, sal <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>



<h5 id="1-2-使用视图"><a href="#1-2-使用视图" class="headerlink" title="1.2 使用视图"></a>1.2 使用视图</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> view_teacher;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> view_teacher_dept;</span><br></pre></td></tr></table></figure>



<p>创建视图：查询所有教师基本信息和所在的部门名称、部门地址信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> view_teacher_dept2 <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> t.tno,t.tname,t.dno,d.dname,d.loc </span><br><span class="line"><span class="keyword">FROM</span> c_teacher t <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> c_dept d <span class="keyword">ON</span> t.dno<span class="operator">=</span>d.dno</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> view_teacher_dept2;</span><br></pre></td></tr></table></figure>



<h4 id="2-可以更新视图：是指通过修改视图的字段，修改基表"><a href="#2-可以更新视图：是指通过修改视图的字段，修改基表" class="headerlink" title="2. 可以更新视图：是指通过修改视图的字段，修改基表"></a>2. 可以<strong>更新视图</strong>：是指通过修改视图的字段，修改基表</h4><p>可以通过视图修改基表数据需要满足以下条件：</p>
<blockquote>
<ul>
<li>(1)视图定义中只包含<strong>一个基表</strong></li>
<li>(2)视图中包含基表的<strong>主键</strong>或<strong>唯一键</strong></li>
<li>(3)视图中没有包含 **聚合函数 ** 和 **distinct 关键字 **</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> v_emp_sal <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> empno,ename,job,sal <span class="keyword">FROM</span> t_emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> v_emp_sal;</span><br></pre></td></tr></table></figure>

<p>v_emp_sal 视图符合修改基表数据的三个条件<br>– 修改7369号员工的薪资（涨薪20%）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> v_emp_sal <span class="keyword">SET</span> sal<span class="operator">=</span>sal<span class="operator">*</span><span class="number">1.2</span> <span class="keyword">WHERE</span> empno<span class="operator">=</span><span class="number">7369</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> v_emp_sal;</span><br></pre></td></tr></table></figure>



<h4 id="3-修改视图"><a href="#3-修改视图" class="headerlink" title="3. 修改视图"></a>3. 修改视图</h4><h5 id="3-1-覆盖原来的视图"><a href="#3-1-覆盖原来的视图" class="headerlink" title="3.1 覆盖原来的视图"></a>3.1 覆盖原来的视图</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> v_emp_sal <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> empno,ename,job,sal,comm <span class="keyword">FROM</span> t_emp;</span><br></pre></td></tr></table></figure>



<h5 id="3-2-ALTER修改原来的视图"><a href="#3-2-ALTER修改原来的视图" class="headerlink" title="3.2 ALTER修改原来的视图"></a>3.2 ALTER修改原来的视图</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> v_emp_sal <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> empno,ename,job,sal <span class="keyword">FROM</span> t_emp;</span><br></pre></td></tr></table></figure>



<h4 id="4-删除视图"><a href="#4-删除视图" class="headerlink" title="4. 删除视图"></a>4. 删除视图</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> IF <span class="keyword">EXISTS</span> v_emp_sal;</span><br></pre></td></tr></table></figure>



<h3 id="09-存储过程"><a href="#09-存储过程" class="headerlink" title="09-存储过程"></a>09-存储过程</h3><h4 id="存储过程："><a href="#存储过程：" class="headerlink" title="存储过程："></a>存储过程：</h4><h4 id="1-是什么："><a href="#1-是什么：" class="headerlink" title="(1)是什么："></a>(1)是什么：</h4><p>存储过程是一组可编程的函数，是为了完成特定功能的<strong>sql语句集</strong>，经过编译创建并保存在数据库中，用户可以通过指定存储过程的名字<strong>调用执行</strong>。（相当于java中类的方法）</p>
<p>简单来说：存储过程是用来<strong>封装</strong> <strong>一段sql逻辑</strong>供开发者<strong>重复调用</strong>，类似java中的方法</p>
<h4 id="2-优点："><a href="#2-优点：" class="headerlink" title="(2)优点："></a>(2)优点：</h4><blockquote>
<p>(1)存储过程是<strong>预编译</strong>的代码块，执行效率高<br>(2)存储过程在<strong>服务器端运行</strong>，减少客户端压力<br>(3)存储过程只需要<strong>创建一次</strong>，可以<strong>重复使用</strong><br>(4)存储过程代替大量的SQL语句，提高通信效率<br>(5)可以一定程度上<strong>确保数据安全</strong></p>
</blockquote>
<p>缺点：<br><strong>调试麻烦  可移植性低</strong></p>
<h4 id="3-语法："><a href="#3-语法：" class="headerlink" title="(3)语法："></a>(3)语法：</h4><p>创建存储过程：<br><code>create procedure 存储过程名称(参数 参数类型)</code><br><code>begin</code><br>  <code>-- 逻辑代码(sql语句集)</code><br><code>end;</code></p>
<p>调用存储过程：<br><code>call 存储过程名称(参数);</code></p>
<h4 id="1、存储过程的使用"><a href="#1、存储过程的使用" class="headerlink" title="1、存储过程的使用"></a>1、存储过程的使用</h4><h5 id="1-1创建一个查询所有教师的存储过程"><a href="#1-1创建一个查询所有教师的存储过程" class="headerlink" title="1.1创建一个查询所有教师的存储过程"></a>1.1创建一个查询所有教师的存储过程</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> pro_get_teacher()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- 查询所有教师</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_teacher;  </span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>



<h5 id="1-2-调用存储过程"><a href="#1-2-调用存储过程" class="headerlink" title="1.2 调用存储过程"></a>1.2 调用存储过程</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> pro_get_teacher(); </span><br></pre></td></tr></table></figure>



<h5 id="1-3-查看存储过程"><a href="#1-3-查看存储过程" class="headerlink" title="1.3 查看存储过程"></a>1.3 查看存储过程</h5><p>查看所有存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS;</span><br></pre></td></tr></table></figure>

<p>搜索指定存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;%teacher%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>查看存储过程的定义</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> pro_get_teacher;</span><br></pre></td></tr></table></figure>

<p>查看某个数据库下的所有存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS <span class="keyword">WHERE</span> db<span class="operator">=</span><span class="string">&#x27;sys&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h5 id="1-4-删除存储过程"><a href="#1-4-删除存储过程" class="headerlink" title="1.4 删除存储过程"></a>1.4 删除存储过程</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> pro_get_teacher;</span><br></pre></td></tr></table></figure>



<h4 id="2-mysql的变量"><a href="#2-mysql的变量" class="headerlink" title="2. mysql的变量"></a>2. mysql的变量</h4><h5 id="2-1-系统变量"><a href="#2-1-系统变量" class="headerlink" title="2.1 系统变量"></a>2.1 系统变量</h5><p>系统变量是指 mysql服务器运行时，控制其行为的参数，</p>
<p>这些变量可以被设置为特定的值来改变服务器的<strong>默认设置</strong>。</p>
<p>分类：<br>(1)全局(<strong>global</strong>)作用域的系统变量：所有连接和所有数据库都能使用<br>(2)会话(<strong>session</strong>)级别的系统变量：当前连接和当前数据库使用</p>
<p>查看系统变量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> variables;</span><br><span class="line"><span class="keyword">SHOW</span> SESSION variables;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> c_dept <span class="keyword">SET</span> dname<span class="operator">=</span><span class="string">&#x27;后勤3部&#x27;</span> <span class="keyword">where</span> dno<span class="operator">=</span><span class="number">7</span>; <span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>查看指定名称的变量： <strong>SELECT @@系统变量名;</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@autocommit</span><span class="operator">=</span><span class="number">0</span>; <span class="comment">-- 表示关闭自动提交</span></span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@autocommit</span><span class="operator">=</span><span class="number">1</span>; <span class="comment">-- 表示开启自动提交</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@admin_port</span>;</span><br></pre></td></tr></table></figure>



<h5 id="2-2-用户变量"><a href="#2-2-用户变量" class="headerlink" title="2.2 用户变量"></a>2.2 用户变量</h5><p>用户自定义的变量，只在当前会话有效，所有<strong>用户变量</strong>使用 <strong>@ 开头</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@username</span><span class="operator">=</span><span class="string">&#x27;tom&#x27;</span>; <span class="comment">-- 定义了一个用户变量</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@username</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@age</span> :<span class="operator">=</span><span class="number">30</span>; <span class="comment">-- 初始化一个用户变量</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@age</span>;</span><br></pre></td></tr></table></figure>

<p><strong>动态赋值</strong></p>
<p>将查询的结果赋值(into)给变量 @sex</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> gender <span class="keyword">INTO</span> <span class="variable">@sex</span> <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tno<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@sex</span>;</span><br></pre></td></tr></table></figure>



<h5 id="2-3-局部变量"><a href="#2-3-局部变量" class="headerlink" title="2.3 局部变量"></a>2.3 局部变量</h5><p>在存储过程内部声明的变量<br>语法：<br><code>DECLARE 变量名 数据类型 [DEFAULT ...]</code></p>
<h6 id="声明一个查询教师表总工资的存储过程"><a href="#声明一个查询教师表总工资的存储过程" class="headerlink" title="声明一个查询教师表总工资的存储过程"></a>声明一个查询教师表总工资的存储过程</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> get_teacher_sal_sum;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_teacher_sal_sum() </span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- 声明一个局部变量</span></span><br><span class="line">  <span class="keyword">DECLARE</span> salsum <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 给变量赋值</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">SUM</span>(sal) <span class="keyword">INTO</span> salsum <span class="keyword">FROM</span> c_teacher;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 查询结果</span></span><br><span class="line">  <span class="keyword">SELECT</span> salsum;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span> get_teacher_sal_sum();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 验证</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(sal) <span class="keyword">FROM</span> c_teacher;</span><br></pre></td></tr></table></figure>

<h4 id="3-IF语句"><a href="#3-IF语句" class="headerlink" title="3. IF语句"></a>3. IF语句</h4><p>语法：<br><code>IF 条件 THEN ...;   ELSEIF 条件 THEN ...;   ELSEIF 条件 THEN ...;   ELSEIF 条件 THEN ...;   ELSE ...; END IF;</code></p>
<h6 id="需求：判断-1-号教师的薪资等级"><a href="#需求：判断-1-号教师的薪资等级" class="headerlink" title="需求：判断 1 号教师的薪资等级"></a>需求：判断 1 号教师的薪资等级</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> get_sal_rank;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_sal_rank()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> `rank` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;null&#x27;</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> `salvalue` <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">  <span class="keyword">SELECT</span> sal <span class="keyword">INTO</span> `salvalue` <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tid <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  </span><br><span class="line">  IF salvalue <span class="operator">&gt;=</span><span class="number">16000</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> `rank` :<span class="operator">=</span><span class="string">&#x27;高收入&#x27;</span>;</span><br><span class="line">    ELSEIF salvalue<span class="operator">&gt;=</span><span class="number">8000</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> `rank` :<span class="operator">=</span><span class="string">&#x27;中收入&#x27;</span>;</span><br><span class="line">    ELSEIF salvalue<span class="operator">&gt;=</span><span class="number">4000</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> `rank` :<span class="operator">=</span><span class="string">&#x27;低收入&#x27;</span>;</span><br><span class="line">    <span class="keyword">ELSE</span> <span class="keyword">SET</span> `rank` :<span class="operator">=</span><span class="string">&#x27;贫困收入&#x27;</span>;</span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">SELECT</span> `rank`;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span> get_sal_rank();</span><br></pre></td></tr></table></figure>



<h4 id="4-参数"><a href="#4-参数" class="headerlink" title="4. 参数"></a>4. 参数</h4><blockquote>
<p>存储过程的参数有三种<br><code>IN</code> : 入参<br><code>OUT</code> ：出参<br><code>INOUT</code> : 既是入参，也是出参</p>
</blockquote>
<h6 id="需求：给定任意一个教师编号，判断他的薪资等级"><a href="#需求：给定任意一个教师编号，判断他的薪资等级" class="headerlink" title="需求：给定任意一个教师编号，判断他的薪资等级"></a>需求：给定任意一个教师编号，判断他的薪资等级</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> get_rank_tno;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_rank_tno(<span class="keyword">IN</span> v_tno <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> `rank` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;null&#x27;</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> `salvalue` <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">SELECT</span> sal <span class="keyword">INTO</span> `salvalue` <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tno <span class="operator">=</span> v_tno;</span><br><span class="line">  IF salvalue <span class="operator">&gt;=</span><span class="number">16000</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> `rank` :<span class="operator">=</span><span class="string">&#x27;高收入&#x27;</span>;</span><br><span class="line">    ELSEIF salvalue<span class="operator">&gt;=</span><span class="number">8000</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> `rank` :<span class="operator">=</span><span class="string">&#x27;中收入&#x27;</span>;</span><br><span class="line">    ELSEIF salvalue<span class="operator">&gt;=</span><span class="number">4000</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> `rank` :<span class="operator">=</span><span class="string">&#x27;低收入&#x27;</span>;</span><br><span class="line">    <span class="keyword">ELSE</span> <span class="keyword">SET</span> `rank` :<span class="operator">=</span><span class="string">&#x27;贫困收入&#x27;</span>;</span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">SELECT</span> `rank`;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> get_rank_tno(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">CALL</span> get_rank_tno(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>



<h4 id="5-CASE-WHEN-语法"><a href="#5-CASE-WHEN-语法" class="headerlink" title="5. CASE WHEN 语法"></a>5. <code>CASE WHEN</code> 语法</h4><h6 id="需求：输出指定-tno-教师的教师的部门名称"><a href="#需求：输出指定-tno-教师的教师的部门名称" class="headerlink" title="需求：输出指定 tno 教师的教师的部门名称"></a>需求：输出指定 tno 教师的教师的部门名称</h6><p>– 例如1号教师的部门编号为4，则输出 研究院<br>– 例如3号教师的部门编号为2，则输出 产品部</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> print_teacher_dname;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> print_teacher_dname(<span class="keyword">IN</span> v_tno <span class="type">INT</span>, <span class="keyword">OUT</span> v_dname <span class="type">VARCHAR</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> v_dno <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 查询出教师的部门编号</span></span><br><span class="line">  <span class="keyword">SELECT</span> dno <span class="keyword">INTO</span> v_dno <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tno<span class="operator">=</span>v_tno;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 根据部门编号匹配部门名称</span></span><br><span class="line">  <span class="keyword">CASE</span> v_dno</span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> v_dname :<span class="operator">=</span><span class="string">&#x27;人力部&#x27;</span>;</span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> v_dname :<span class="operator">=</span><span class="string">&#x27;产品部&#x27;</span>;</span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> v_dname :<span class="operator">=</span><span class="string">&#x27;招生部&#x27;</span>;</span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">4</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> v_dname :<span class="operator">=</span><span class="string">&#x27;研究院&#x27;</span>;</span><br><span class="line">    <span class="keyword">WHEN</span> <span class="number">5</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> v_dname :<span class="operator">=</span><span class="string">&#x27;系统部&#x27;</span>;</span><br><span class="line">    <span class="keyword">ELSE</span> <span class="keyword">SET</span> v_dname :<span class="operator">=</span><span class="string">&#x27;其他部门&#x27;</span>;</span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@teadname</span> :<span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> print_teacher_dname(<span class="number">1</span>,<span class="variable">@teadname</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@teadname</span>; <span class="comment">-- 1号老师部门编号为4，输出 研究院</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> print_teacher_dname(<span class="number">3</span>,<span class="variable">@teadname</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@teadname</span>; <span class="comment">-- 3号老师部门编号为2，输出 产品部</span></span><br></pre></td></tr></table></figure>



<h6 id="需求：涨薪10"><a href="#需求：涨薪10" class="headerlink" title="需求：涨薪10%"></a>需求：涨薪10%</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> add_sal;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> add_sal(<span class="keyword">INOUT</span> salvalue <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SET</span> salvalue :<span class="operator">=</span> salvalue<span class="operator">*</span><span class="number">1.1</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@salval</span> <span class="operator">=</span><span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> add_sal(<span class="variable">@salval</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@salval</span>;</span><br></pre></td></tr></table></figure>



<h4 id="6-循环"><a href="#6-循环" class="headerlink" title="6. 循环"></a>6. 循环</h4><h5 id="6-1-while循环"><a href="#6-1-while循环" class="headerlink" title="6.1 while循环"></a>6.1 while循环</h5><p>语法：<br><code>WHILE 条件 DO 循环体</code><br><code>END WHILE;</code></p>
<h6 id="需求：传入一个值n，求1-n之间偶数和"><a href="#需求：传入一个值n，求1-n之间偶数和" class="headerlink" title="需求：传入一个值n，求1~n之间偶数和"></a>需求：传入一个值n，求1~n之间偶数和</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> get_enen_sum;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_enen_sum(<span class="keyword">IN</span> n <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">-- 声明变量接收和</span></span><br><span class="line">	<span class="keyword">DECLARE</span> v_sum <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 循环计算偶数和</span></span><br><span class="line">WHILE n<span class="operator">&gt;</span><span class="number">1</span> DO</span><br><span class="line">	IF n<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">0</span> <span class="keyword">THEN</span> </span><br><span class="line">		<span class="keyword">SET</span> v_sum :<span class="operator">=</span> v_sum<span class="operator">+</span>n;</span><br><span class="line">	<span class="keyword">END</span> IF;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SET</span> n :<span class="operator">=</span> n<span class="number">-1</span>;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">END</span> WHILE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> v_sum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> get_enen_sum(<span class="number">100</span>); <span class="comment">-- 2550</span></span><br></pre></td></tr></table></figure>



<h5 id="6-2-repeat循环"><a href="#6-2-repeat循环" class="headerlink" title="6.2 repeat循环"></a>6.2 repeat循环</h5><p>语法：<br><code>REPEAT 循环体``;</code><br>	<code>UNTIL 结束条件</code><br><code>END REPEAT;</code><br><strong>注意</strong>：until语句后面不加分号</p>
<h6 id="需求：传入一个值n，求1-n之间奇数和"><a href="#需求：传入一个值n，求1-n之间奇数和" class="headerlink" title="需求：传入一个值n，求1~n之间奇数和"></a>需求：传入一个值n，求1~n之间奇数和</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> get_odd_sum;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_odd_sum(<span class="keyword">IN</span> n <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">	<span class="keyword">DECLARE</span> v_sum <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">REPEAT</span><br><span class="line">	IF n<span class="operator">%</span><span class="number">2</span> <span class="operator">!=</span><span class="number">0</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> v_sum :<span class="operator">=</span> v_sum<span class="operator">+</span>n;</span><br><span class="line">	<span class="keyword">END</span> IF;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SET</span> n :<span class="operator">=</span> n<span class="number">-1</span>;</span><br><span class="line">	</span><br><span class="line">	UNTIL n <span class="operator">&lt;</span> <span class="number">1</span> <span class="comment">-- 退出循环的条件</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">END</span> REPEAT;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> v_sum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> get_odd_sum(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>



<h5 id="6-3-loop循环"><a href="#6-3-loop循环" class="headerlink" title="6.3 loop循环"></a>6.3 loop循环</h5><blockquote>
<p><code>leave</code>：类似break</p>
<p><code>iterate</code>：类似continue</p>
</blockquote>
<h6 id="需求：获取-i-的值"><a href="#需求：获取-i-的值" class="headerlink" title="需求：获取 i 的值"></a>需求：获取 i 的值</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> get_i;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_i()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; <span class="comment">-- 初始化i值为0</span></span><br><span class="line">	</span><br><span class="line">label: LOOP</span><br><span class="line">	<span class="keyword">SET</span> i :<span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	IF i <span class="operator">=</span> <span class="number">5</span> <span class="keyword">THEN</span></span><br><span class="line">		LEAVE label; 	<span class="comment">-- 结束循环,leave相当于break</span></span><br><span class="line">	<span class="keyword">END</span> IF; </span><br><span class="line"><span class="keyword">END</span> LOOP label;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> i;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> get_i(); <span class="comment">-- 5</span></span><br></pre></td></tr></table></figure>

<h6 id="获取-i-的值"><a href="#获取-i-的值" class="headerlink" title="获取 i 的值"></a>获取 i 的值</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> get_ii;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_ii()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; <span class="comment">-- 初始化i值为0</span></span><br><span class="line">	</span><br><span class="line">    label: LOOP</span><br><span class="line">        <span class="keyword">SET</span> i :<span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        IF i <span class="operator">=</span> <span class="number">5</span> <span class="keyword">THEN</span></span><br><span class="line">            ITERATE label; 	<span class="comment">-- 跳出当前循环,继续执行下次循环</span></span><br><span class="line">        ELSEIF i <span class="operator">=</span><span class="number">10</span> <span class="keyword">THEN</span> </span><br><span class="line">            LEAVE label;</span><br><span class="line">        <span class="keyword">END</span> IF; </span><br><span class="line">    <span class="keyword">END</span> LOOP label;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">SELECT</span> i;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> get_ii(); <span class="comment">-- 10</span></span><br></pre></td></tr></table></figure>



<h3 id="10-异常捕获"><a href="#10-异常捕获" class="headerlink" title="10-异常捕获"></a>10-异常捕获</h3><h4 id="捕获异常并处理"><a href="#捕获异常并处理" class="headerlink" title="捕获异常并处理"></a>捕获异常并处理</h4><h4 id="1、语法"><a href="#1、语法" class="headerlink" title="1、语法"></a>1、语法</h4><blockquote>
<p>DECLARE  handler_name HANDLER FOR condition_value action_satament;</p>
<p>DECLARE 处理方式 HANDLER FOR 异常条件 处理动作;</p>
</blockquote>
<h4 id="语法解析："><a href="#语法解析：" class="headerlink" title="语法解析："></a>语法解析：</h4><p>（1） <strong>handler_name（处理方式）</strong>: 异常处理程序的名称，取值如下：</p>
<ul>
<li><strong>continue</strong>：发生异常后，程序不会终止，会正常执行后续的过程（捕获异常）;</li>
<li><strong>exit</strong>：发生异常后，终止存储过程的执行</li>
</ul>
<p>（2）<strong>condition_value（异常条件）</strong>：是指捕获异常类型，取值如下：</p>
<ul>
<li><p>SQLSTATTE sqlstate_value(状态码)，例如：SQLSTATE ‘02000’<br>（捕获特定的 sqlstate 错误码）<br>（捕获特定的 状态码的异常，例如：23000 表示主键冲突）</p>
</li>
<li><p><strong>sqlwaring</strong>： 代表所有警告类型的异常 （sqlstate 以01 开头）<br>（这类错误通常表示警告，例如数据截断、空值转换等）</p>
</li>
<li><p><strong>not found</strong>： 未找到数据异常（sqlstate 以 02 开头）<br>（通常用于游标中，表示”没有更多的数据”）</p>
</li>
<li><p><strong>sqlexception</strong>: 代表除了 01 和 02 开头以外的 sqlstate 错误<br>（表示严重的异常，例如主<strong>键冲突、权限不足</strong>等）</p>
<p>(3) <strong>处理动作</strong>：<br>    通常是一条sql语句，例如：SET 变量 :&#x3D; 值    ，    SELECT ‘错误信息’<br>    如果处理方式有多条sql语句，使用 begin…end 包裹</p>
</li>
</ul>
<blockquote>
<h4 id="抛出自定义异常：-signal"><a href="#抛出自定义异常：-signal" class="headerlink" title="**抛出自定义异常：**signal"></a>**抛出自定义异常：**signal</h4><p>​    在 mysql 中使用 signal sqlstate ‘4500’抛出用户自定义异常可以在存储过程、存储函数、触发器中适用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;45000&#x27;</span> <span class="keyword">SET</span> MESSAGE_TEXT<span class="operator">=</span><span class="string">&#x27;错误:新工资低于旧工资!!!&#x27;</span>;</span><br></pre></td></tr></table></figure></blockquote>
<p>需求：写一个存储过程，新增员工</p>
<p>– 非工作日不能新增员工</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> add_emp;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> add_emp(<span class="keyword">IN</span> var_eno <span class="type">INT</span>,<span class="keyword">IN</span> var_ename <span class="type">VARCHAR</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">	<span class="keyword">DECLARE</span> var_week <span class="type">INT</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SELECT</span> DAYOFWEEK(NOW()) <span class="keyword">INTO</span> var_week;</span><br><span class="line">	</span><br><span class="line">	IF var_week<span class="operator">=</span><span class="number">1</span> <span class="operator">||</span> var_week<span class="operator">=</span><span class="number">7</span> <span class="keyword">THEN</span></span><br><span class="line">		SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;45000&#x27;</span> <span class="keyword">SET</span> MESSAGE_TEXT<span class="operator">=</span><span class="string">&#x27;周末不允许添加员工&#x27;</span>;</span><br><span class="line">	<span class="keyword">ELSE</span> </span><br><span class="line">		<span class="keyword">INSERT INTO</span> t_emp(empno,ename) </span><br><span class="line">		<span class="keyword">VALUES</span>(var_eno,var_ename);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="string">&#x27;新增成功！！！&#x27;</span>;</span><br><span class="line">	<span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> add_emp(<span class="number">7133</span>,<span class="string">&#x27;alex&#x27;</span>);</span><br></pre></td></tr></table></figure>





<h4 id="2、异常处理声明的位置"><a href="#2、异常处理声明的位置" class="headerlink" title="2、异常处理声明的位置"></a>2、异常处理声明的位置</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">-- 1.声明异常</span></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.声明异常处理器(必须在变量之后声明)</span></span><br><span class="line"><span class="comment">-- 示例：</span></span><br><span class="line"><span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="string">&#x27;发生错误&#x27;</span>;</span><br><span class="line">	<span class="keyword">ROLLBACK</span>; <span class="comment">-- 回滚事务</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.主业务逻辑</span></span><br><span class="line"><span class="comment">-- 例如：给员工加薪，转账操作。。。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;			</span><br></pre></td></tr></table></figure>



<p>处理**主键冲突(**SQLSTATE 23000)<br>在新增数据的业务中，可能会出现主键冲突的异常</p>
<p>需求：向部门表中新增数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> insert_dept;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_dept(</span><br><span class="line">	<span class="keyword">IN</span> var_dno <span class="type">INT</span>,		<span class="comment">-- Variable变量</span></span><br><span class="line">	<span class="keyword">IN</span> var_dname <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">	<span class="keyword">IN</span> var_loc <span class="type">VARCHAR</span>(<span class="number">255</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">		<span class="comment">-- 1.声明变量</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">	<span class="comment">-- 2.声明异常处理器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 	DECLARE EXIT HANDLER FOR SQLSTATE &#x27;23000&#x27;</span></span><br><span class="line">		<span class="keyword">DECLARE</span> primarykey_conflict <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;23000&#x27;</span>;</span><br><span class="line">		<span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> primarykey_conflict</span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line">			<span class="keyword">SELECT</span> <span class="string">&#x27;错误：当前部门编号已存在&#x27;</span> <span class="keyword">AS</span> <span class="string">&#x27;err_mssage&#x27;</span>;</span><br><span class="line">		<span class="keyword">END</span>;	<span class="comment">-- 只有一条代码可以省略begin end</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">	<span class="comment">-- 主业务逻辑(插入数据)</span></span><br><span class="line">	<span class="keyword">INSERT INTO</span> c_dept(dno,dname,loc) </span><br><span class="line">		<span class="keyword">VALUES</span>(var_dno,var_dname,var_loc);</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="string">&#x27;新增数据成功！！！&#x27;</span> <span class="keyword">AS</span> <span class="string">&#x27;success&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> insert_dept(<span class="number">1</span>,<span class="string">&#x27;营销部&#x27;</span>,<span class="string">&#x27;江西南昌&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> insert_dept(<span class="number">8</span>,<span class="string">&#x27;营销部&#x27;</span>,<span class="string">&#x27;江西南昌&#x27;</span>);</span><br></pre></td></tr></table></figure>


<p>​			<br>需求：处理 <strong>除 0 异常</strong><br>  定义一个存储过程，输入一个被除数和一个除数<br>  如果除数为0，输出”除数不能为0”的错误信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> test_exception;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_exception(</span><br><span class="line">  <span class="keyword">IN</span> numberator <span class="type">INT</span>,  <span class="comment">-- 被除数</span></span><br><span class="line">  <span class="keyword">IN</span> denominator <span class="type">INT</span>,  <span class="comment">-- 除数</span></span><br><span class="line">  <span class="keyword">OUT</span> <span class="keyword">result</span> <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),  <span class="comment">-- 结果</span></span><br><span class="line">  <span class="keyword">OUT</span> errmsg <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="comment">-- 错误信息</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- 1.声明变量的</span></span><br><span class="line">  <span class="comment">--  将特定 sqlstate 映射为可读性更好的条件名称</span></span><br><span class="line">  <span class="comment">-- 除零错误的 sqlstate: SOLSTATE &#x27;22012&#x27;</span></span><br><span class="line">  <span class="keyword">DECLARE</span> division_by_zero <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;22012&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 2.声明处理异常程序</span></span><br><span class="line">  <span class="comment">-- 当发生除零错误的时候执行此处理程序</span></span><br><span class="line">  <span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> division_by_zero</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="keyword">SET</span> errmsg :<span class="operator">=</span> <span class="string">&#x27;错误：除数不能为0&#x27;</span>;</span><br><span class="line">  <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 处理其他的错误</span></span><br><span class="line">   <span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span> </span><br><span class="line">   <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 获取错误信息</span></span><br><span class="line">      <span class="keyword">GET</span> DIAGNOSTICS <span class="keyword">CONDITION</span> <span class="number">1</span></span><br><span class="line">      <span class="variable">@sqlstate</span> <span class="operator">=</span> RETURNED_SQLSTATE,   <span class="comment">--  sql 标准的错误码</span></span><br><span class="line">      <span class="variable">@errno</span> <span class="operator">=</span> MYSQL_ERRNO,         <span class="comment">--  mysql 特定的错误号</span></span><br><span class="line">      <span class="variable">@text</span> <span class="operator">=</span> MESSAGE_TEXT;</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">  <span class="keyword">SET</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="keyword">NULL</span>;</span><br><span class="line">  <span class="keyword">SET</span> errmsg :<span class="operator">=</span> CONCAT(</span><br><span class="line">    <span class="string">&#x27;其他错误: @sqlstate&#x27;</span>,<span class="variable">@sqlstate</span>,</span><br><span class="line">    <span class="string">&#x27;,@errno = &#x27;</span>,<span class="variable">@errno</span>,<span class="string">&#x27;,@text = &#x27;</span>,<span class="variable">@text</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- 3.执行主业务逻辑</span></span><br><span class="line">   <span class="comment">-- 没有异常，正常输出结果</span></span><br><span class="line">   <span class="keyword">SET</span> <span class="keyword">result</span> :<span class="operator">=</span> numberator <span class="operator">/</span> denominator;</span><br><span class="line">   <span class="keyword">SET</span> errmsg :<span class="operator">=</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@result</span> :<span class="operator">=</span><span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@errmsg</span> :<span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">CALL</span> test_exception(<span class="number">10</span>,<span class="number">5</span>,<span class="variable">@result</span>,<span class="variable">@errmsg</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@result</span>,<span class="variable">@errmsg</span>;   <span class="comment">-- 2.00 NULL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_exception(<span class="number">10</span>,<span class="number">0</span>,<span class="variable">@result</span>,<span class="variable">@errmsg</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@result</span>,<span class="variable">@errmsg</span>;   <span class="comment">-- NULL 错误：除数不能为0</span></span><br></pre></td></tr></table></figure>





<h3 id="11-游标"><a href="#11-游标" class="headerlink" title="11-游标"></a>11-游标</h3><p>游标：<br>可以理解为一个指向结果集中某条记录的指针，允许我们<strong>逐一访问结果集</strong>中的每条记录，并对其进行逐行操作和处理<br>简单来说，类似java中保存数据的集合（<strong>可以被遍历</strong>）</p>
<blockquote>
<p>语法：<br><code>DECLARE</code> 游标名称 <code>CURSOR</code> <code>FOR</code> 查询语句;</p>
</blockquote>
<blockquote>
<p>使用游标:<br>OPEN 游标名称<br>FETCH 游标名称 INTO 变量 [,变量, …];<br>CLOSE 游标名称</p>
</blockquote>
<p>需求：将c_dept表中的所有数据查询出来，循环插入到c_dept2表中<br>  复制表中的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> c_dept2;</span><br><span class="line"><span class="comment">-- 先创建c_dept表结构到c_dept2表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> c_dept2(</span><br><span class="line">  dno <span class="type">INT</span>,</span><br><span class="line">  dname <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  loc <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> copy_dept;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> copy_dept()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> v_dno <span class="type">INT</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> v_dname <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">  <span class="keyword">DECLARE</span> v_loc <span class="type">VARCHAR</span>(<span class="number">255</span>);</span><br><span class="line">  <span class="comment">-- 声明一个变量控制循环的结束</span></span><br><span class="line">  <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">  <span class="comment">-- 1.查询c_dept表中的所有数据，保存到一个游标中</span></span><br><span class="line">  <span class="keyword">DECLARE</span> dept_cursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> </span><br><span class="line">    <span class="keyword">SELECT</span> dno,dname,loc <span class="keyword">FROM</span> c_dept;</span><br><span class="line">  <span class="comment">-- 声明异常处理器  </span></span><br><span class="line">  <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done :<span class="operator">=</span> <span class="literal">TRUE</span>;</span><br><span class="line">  <span class="comment">-- 2.使用游标 </span></span><br><span class="line">  <span class="keyword">OPEN</span> dept_cursor;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 循环游标</span></span><br><span class="line">  label: LOOP</span><br><span class="line">    <span class="comment">-- 每次循环从游标中取一行数据</span></span><br><span class="line">    <span class="keyword">FETCH</span> dept_cursor <span class="keyword">INTO</span> v_dno,v_dname,v_loc;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">IF done <span class="keyword">THEN</span> <span class="comment">-- 退出条件：取不到数据</span></span><br><span class="line">  LEAVE label;</span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将取出来的数据插入c_dept2 表中</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> c_dept2(dno,dname,loc) <span class="keyword">VALUES</span> (v_dno,v_dname,v_loc);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">END</span> LOOP label;</span><br><span class="line">  <span class="keyword">CLOSE</span> dept_cursor;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALl</span> copy_dept();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- TRUNCATE TABLE c_dept2;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_dept2;</span><br></pre></td></tr></table></figure>



<h3 id="12-存储函数"><a href="#12-存储函数" class="headerlink" title="12-存储函数"></a>12-存储函数</h3><h4 id="1、存储函数："><a href="#1、存储函数：" class="headerlink" title="1、存储函数："></a>1、存储函数：</h4><p>是<strong>预编译并存储</strong>在数据库中的<strong>sql程序</strong>，它封装了一系列SQL语句和逻辑判断，【<strong>必须返回一个值</strong>】，它可以像内置函数（例如sum(),concat()…）嵌入到SQL语句中直接调用<br>简单理解：是一个<strong>带返回值的存储过程</strong></p>
<h4 id="2、核心特点："><a href="#2、核心特点：" class="headerlink" title="2、核心特点："></a><strong>2、核心特点：</strong></h4><p>（1）强制返回值：函数中必须包含<strong>return</strong>语句，要注意：返回值的类型与声明的一致<br>（2）参数限制：函数的参数仅<strong>支持IN类型</strong>的参数，没有OUT和INOUT（默认IN类型，可以不写）<br>（3）嵌入性：可以直接用在select，where，insert等语句中</p>
<h4 id="3、语法结构"><a href="#3、语法结构" class="headerlink" title="3、语法结构"></a>3、语法结构</h4><blockquote>
<p><code>CREATE</code> <code>FUNCTION</code> 函数名称(参数 参数类型, …)<br>– 默认IN类型，可以不写<br><code>RETURNS</code> 返回值数据类型<br>[特性选项]  – 可选<br>BEGIN<br>– 函数逻辑<br>– 整个函数必须有return返回值<br><code>RETURN</code> 结果;<br>END;</p>
</blockquote>
<h4 id="4、特性选项说明："><a href="#4、特性选项说明：" class="headerlink" title="4、特性选项说明："></a>4、特性选项说明：</h4><p>标明特性的目的是：告诉数据库引擎，优化函数的执行效率<br>取值如下：<br>（1）<strong>DETERMINISTIC</strong> ：输入相同的参数时，返回的结果时固定的，多次调用，直接复用结果，有助于优化器提速；<br><strong>确定性函数</strong>：是指每次调用函数时，传同一个参数，返回值是固定的</p>
<ul>
<li>如果 传递一个参数 返回值是固定的，第一次调用时会执行函数，计算出结果并缓存；</li>
<li>之后每次调用则使用缓存的结果，不需要再次执行函数过程，提升执行效率</li>
</ul>
<p>（2）<strong>SQL DATA ACCESS</strong> ：声明的函数对数据的操作类型<br>   <strong>no sql</strong> ：无数据操作<br>   <strong>reads sql data</strong> ：仅读数据<br>   <strong>modifies sql data</strong> ：修改数据</p>
<h5 id="1、确定性函数-科学计算"><a href="#1、确定性函数-科学计算" class="headerlink" title="1、确定性函数(科学计算)"></a>1、确定性函数(科学计算)</h5><p>无数据库操作，结果是确定的(每一次传100进来，结果是确定的5050)<br>创建一个函数：计算0~n之间的整数和</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> IF <span class="keyword">EXISTS</span> get_sum;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> get_sum(n <span class="type">INT</span>)  <span class="keyword">RETURNS</span> <span class="type">INT</span> </span><br><span class="line"><span class="keyword">DETERMINISTIC</span> <span class="comment">-- 表示是确定性函数</span></span><br><span class="line"> <span class="comment">-- NOT DETERMINISTIC -- 表示不确定性函数，例如返回一个随机数时，使用该特性</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> <span class="keyword">result</span>  <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> i <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  label: LOOP</span><br><span class="line">    IF i <span class="operator">&lt;=</span> n <span class="keyword">THEN</span> </span><br><span class="line">      <span class="keyword">SET</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="keyword">result</span> <span class="operator">+</span> i;</span><br><span class="line">      <span class="keyword">SET</span> i :<span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">    <span class="keyword">ELSE</span> LEAVE label; <span class="comment">-- i &gt; n 则推出循环</span></span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">  <span class="keyword">END</span> LOOP label;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 返回结果</span></span><br><span class="line">  <span class="keyword">RETURN</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>– 使用函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 第一次调用，计算结果会缓存</span></span><br><span class="line"><span class="keyword">SELECT</span> get_sum(<span class="number">100</span>) <span class="keyword">AS</span> <span class="string">&#x27;result&#x27;</span>;  </span><br><span class="line"><span class="comment">-- 后面的调用，使用缓存的结果，效率更快</span></span><br><span class="line"><span class="keyword">SELECT</span> get_sum(<span class="number">100</span>) <span class="keyword">AS</span> <span class="string">&#x27;result&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h5 id="2、查询型函数-读取数据库数据"><a href="#2、查询型函数-读取数据库数据" class="headerlink" title="2、查询型函数(读取数据库数据)"></a>2、查询型函数(读取数据库数据)</h5><p>需求：根据部门dno，查询部门的地址loc</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> IF <span class="keyword">EXISTS</span> get_dept_loc;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> get_dept_loc(v_dno <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">255</span>) </span><br><span class="line"><span class="keyword">READS</span> <span class="keyword">SQL</span> DATA <span class="comment">-- 该特性表示 仅读取数据</span></span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">  <span class="keyword">DECLARE</span> var_loc <span class="type">VARCHAR</span>(<span class="number">255</span>); <span class="comment">-- 保存查询到的部门地址</span></span><br><span class="line">  <span class="comment">-- 查询逻辑</span></span><br><span class="line">  <span class="keyword">SELECT</span> loc <span class="keyword">INTO</span> var_loc <span class="keyword">FROM</span> c_dept <span class="keyword">WHERE</span> dno<span class="operator">=</span>v_dno;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 判断查询结果</span></span><br><span class="line">  IF var_loc <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">THEN</span> </span><br><span class="line">    <span class="keyword">SET</span> var_loc :<span class="operator">=</span> <span class="string">&#x27;没有该部门的地址信息！！！&#x27;</span>;</span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">RETURN</span> var_loc;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> get_dept_loc(<span class="number">2</span>) <span class="keyword">AS</span> <span class="string">&#x27;部门地址&#x27;</span>; <span class="comment">-- 北京海淀</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> get_dept_loc(<span class="number">10</span>) <span class="keyword">AS</span> <span class="string">&#x27;部门地址&#x27;</span>; </span><br><span class="line">          <span class="comment">-- 没有该部门的地址信息！！！</span></span><br><span class="line"><span class="keyword">SELECT</span> loc <span class="keyword">FROM</span> c_dept <span class="keyword">WHERE</span> dno<span class="operator">=</span><span class="number">10</span>;</span><br></pre></td></tr></table></figure>



<h5 id="3、带游标和异常处理的复杂函数"><a href="#3、带游标和异常处理的复杂函数" class="headerlink" title="3、带游标和异常处理的复杂函数"></a>3、带游标和异常处理的复杂函数</h5><p>计算教师表c_teacher，每个部门的老师平均工资<br>– 传递部门编号，计算出该部门的平均薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> IF <span class="keyword">EXISTS</span> get_avgsal_by_dept;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> get_avgsal_by_dept(v_dno <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">READS</span> <span class="keyword">SQL</span> DATA <span class="comment">-- 仅查询</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- 1.声明变量</span></span><br><span class="line">  <span class="comment">-- 计算部门的薪资和</span></span><br><span class="line">  <span class="keyword">DECLARE</span> var_total_sal <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> var_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; <span class="comment">-- 统计部门的人数</span></span><br><span class="line">  <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; <span class="comment">-- 控制循环的变量</span></span><br><span class="line">  <span class="keyword">DECLARE</span> var_sal <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>); <span class="comment">-- 接受游标中取出来的值</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">DECLARE</span> var_avgsal <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>); <span class="comment">-- 返回结果：部门的平均工资</span></span><br><span class="line">  <span class="comment">-- 2.声明游标，保存当前部门的薪资</span></span><br><span class="line">  <span class="keyword">DECLARE</span> cur_sal <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">      <span class="keyword">SELECT</span> sal <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> dno<span class="operator">=</span>v_dno;</span><br><span class="line">  <span class="comment">-- 3.声明异常处理器</span></span><br><span class="line">  <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 4.使用游标</span></span><br><span class="line">  <span class="keyword">OPEN</span> cur_sal;</span><br><span class="line">    label: LOOP</span><br><span class="line">      <span class="keyword">FETCH</span> cur_sal <span class="keyword">INTO</span> var_sal;</span><br><span class="line">      <span class="comment">-- 取不到就立即退出循环</span></span><br><span class="line">      IF done <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> LEAVE label;</span><br><span class="line">      <span class="keyword">END</span> IF;</span><br><span class="line">      </span><br><span class="line">  <span class="comment">-- 计算薪资和</span></span><br><span class="line">  <span class="keyword">SET</span> var_total_sal :<span class="operator">=</span> var_total_sal <span class="operator">+</span> var_sal;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 统计人数</span></span><br><span class="line">  <span class="keyword">SET</span> var_count :<span class="operator">=</span> var_count <span class="operator">+</span> <span class="number">1</span>; <span class="comment">-- 每次取到就+1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> LOOP label;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">CLOSE</span> cur_sal;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 计算平均值</span></span><br><span class="line">  <span class="comment">-- 加入某个部门的人数为0，不能作为除数，计算平均工资</span></span><br><span class="line">  IF var_count <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span> </span><br><span class="line">    <span class="keyword">RETURN</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">ELSE</span> </span><br><span class="line">    <span class="comment">-- 平均工资 = 总工资 / 人数</span></span><br><span class="line">    <span class="keyword">SET</span> var_avgsal :<span class="operator">=</span> var_total_sal <span class="operator">/</span> var_count;</span><br><span class="line">    <span class="keyword">RETURN</span> var_avgsal;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> get_avgsal_by_dept(<span class="number">1</span>) <span class="keyword">AS</span> <span class="string">&#x27;部门平均薪资&#x27;</span>; <span class="comment">-- 15978.49</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 验证</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="built_in">AVG</span>(sal),<span class="number">2</span>) <span class="keyword">FROM</span> c_teacher <span class="keyword">GROUP</span> <span class="keyword">BY</span> dno <span class="keyword">HAVING</span> dno <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>





<h4 id="存储函数和存储过程的区别"><a href="#存储函数和存储过程的区别" class="headerlink" title="存储函数和存储过程的区别"></a><strong>存储函数和存储过程的区别</strong></h4><ul>
<li>1.声明的<strong>关键字</strong>不一样：<ul>
<li>存储过程使用 <code>procedure</code>，</li>
<li>函数使用 <code>function</code></li>
</ul>
</li>
<li>2**.参数类型**支持不一样：<ul>
<li>存储过程支持 IN\OUT\INOUT参数类型，</li>
<li>函数仅支持 IN类型参数</li>
</ul>
</li>
<li>3.<strong>返回结果</strong>的处理方式不一样：<ul>
<li>存储过程可以通过OUT参数返回结果，或者不返回结果，</li>
<li>函数必须返回结果，使用 return 关键字</li>
</ul>
</li>
<li>4.<strong>调用方式</strong>：<ul>
<li>存储过程通过 call 语句调用，</li>
<li>函数可以直接嵌套在 slq 语句中</li>
</ul>
</li>
<li>5.<strong>事务支持不一样</strong>：<ul>
<li>存储过程完全支持事务，</li>
<li>函数支持事务但是有限制(不推荐在函数中使用事务)</li>
</ul>
</li>
</ul>
<h3 id="13-触发器"><a href="#13-触发器" class="headerlink" title="13-触发器"></a>13-触发器</h3><h4 id="1、触发器："><a href="#1、触发器：" class="headerlink" title="1、触发器："></a>1、触发器：</h4><p>是<strong>与表关联</strong>的特殊的存储过程，会在满足特定条件的<strong>自动触发执行</strong>，无需手动调用</p>
<h4 id="2、核心要素"><a href="#2、核心要素" class="headerlink" title="2、核心要素"></a>2、核心要素</h4><p>（1）<strong>触发事件</strong>：引起触发器执行的操作：<code>insert、update、delete</code><br>（2）<strong>触发时机</strong>：引起发生的时间点：<code>before</code>、<code>after</code><br>（3）<strong>触发对象</strong>：关联的表（触发器必须依附于某张表，不能独立存在）<br>（4）<strong>触发频率</strong>：for each row(默认)，每影响一行数据，就触发一次（<strong>行级触发器</strong>）</p>
<h4 id="3、语法结构-1"><a href="#3、语法结构-1" class="headerlink" title="3、语法结构"></a>3、语法结构</h4><blockquote>
<p><code>CREATE</code> <code>TRIGGER</code> 触发器名称<br>触发时机 触发事件 <code>ON</code> 表名<br><code>FOR EACH ROW</code> – 行级触发<br>BEGIN<br>– 触发器执行逻辑(SQL语句，条件判断…)<br>END;</p>
</blockquote>
<h4 id="4、new-和-old-关键字说明"><a href="#4、new-和-old-关键字说明" class="headerlink" title="4、new 和 old 关键字说明"></a>4、new 和 old 关键字说明</h4><blockquote>
<p>  <code>new.字段名</code> ：引用 插入 | 更新后的新值（insert 和 update 事件可用）</p>
<p>  <code>old.字段名</code> ：引用 更新 | 删除前的旧值（update 和 delete 事件可用）</p>
</blockquote>
<p>  **注意：**new和old后面的字段名 是 </p>
<p>– （1）创建日志表：记录对 c_dept表的操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> c_dept_logs(</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> auto_increment,</span><br><span class="line">  dno <span class="type">INT</span> COMMENT <span class="string">&#x27;记录操作的部门编号&#x27;</span>,</span><br><span class="line">  action <span class="type">VARCHAR</span>(<span class="number">255</span>) COMMENT <span class="string">&#x27;记录操作部门表的行为&#x27;</span>,</span><br><span class="line">  time_at <span class="type">DATE</span> COMMENT <span class="string">&#x27;记录操作的事件&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>需求：向部门表插入数据<br> 每次插入一条数据，要在 dept_logs表中记录一条信息</p>
<h4 id="1、insert-触发器"><a href="#1、insert-触发器" class="headerlink" title="1、insert 触发器"></a><strong>1、insert 触发器</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> trigger_dept_insert;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_dept_insert</span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> c_dept</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">-- 记录新增的日志</span></span><br><span class="line">   <span class="keyword">INSERT INTO</span> c_dept_logs(dno,action,time_at)   </span><br><span class="line">     <span class="keyword">VALUES</span>(NEW.dno, <span class="string">&#x27;insert&#x27;</span>, NOW());</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向c_dept 表中新增数据时，会自动触发trigger_dept_insert执行</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> c_dept(dname,loc) <span class="keyword">VALUES</span>(<span class="string">&#x27;事业部&#x27;</span>,<span class="string">&#x27;江西南昌&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> c_dept(dname,loc) <span class="keyword">VALUES</span>(<span class="string">&#x27;坐飞机部&#x27;</span>,<span class="string">&#x27;北京朝阳&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_dept_logs;</span><br></pre></td></tr></table></figure>



<h4 id="2、update-触发器"><a href="#2、update-触发器" class="headerlink" title="2、update 触发器"></a><strong>2、update 触发器</strong></h4><p>需求：修改c_dept表的数据，触发 执行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> trigger_dept_update;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_dept_update</span><br><span class="line">AFTER <span class="keyword">UPDATE</span> <span class="keyword">ON</span> c_dept</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 记录更新的日志</span></span><br><span class="line">   <span class="keyword">INSERT INTO</span> c_dept_logs(dno,action,time_at)   </span><br><span class="line">      <span class="keyword">VALUES</span>(NEW.dno, <span class="string">&#x27;update&#x27;</span>, NOW());</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> c_dept <span class="keyword">SET</span> dname<span class="operator">=</span><span class="string">&#x27;研发5部&#x27;</span> <span class="keyword">WHERE</span> dno<span class="operator">=</span><span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_dept_logs;</span><br></pre></td></tr></table></figure>




<h4 id="3、delete-触发器"><a href="#3、delete-触发器" class="headerlink" title="3、delete 触发器"></a><strong>3、delete 触发器</strong></h4><p>需求：删除c_dept表的数据，触发 执行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> trigger_dept_delete;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_dept_delete</span><br><span class="line">BEFORE <span class="keyword">DELETE</span> <span class="keyword">ON</span> c_dept  <span class="comment">-- 删除前</span></span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 记录删除的日志</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> c_dept_logs(dno,action,time_at)   </span><br><span class="line">        <span class="keyword">VALUES</span>(OLD.dno, <span class="string">&#x27;delete&#x27;</span>, NOW()); <span class="comment">-- 删除前旧数据</span></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向c_dept 表中新增数据时，会自动触发trigger_dept_insert执行</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROm</span>  c_dept  <span class="keyword">WHERE</span> dno<span class="operator">=</span><span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_dept_logs;</span><br></pre></td></tr></table></figure>



<h4 id="4、查看触发器"><a href="#4、查看触发器" class="headerlink" title="4、查看触发器"></a>4、查看触发器</h4><h5 id="（1）查看所有触发器"><a href="#（1）查看所有触发器" class="headerlink" title="（1）查看所有触发器"></a>（1）查看所有触发器</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TRIGGERS;</span><br></pre></td></tr></table></figure>



<h5 id="（2）从系统表中查看指定表名的触发器"><a href="#（2）从系统表中查看指定表名的触发器" class="headerlink" title="（2）从系统表中查看指定表名的触发器"></a>（2）从系统表中查看指定表名的触发器</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.TRIGGERS <span class="keyword">WHERE</span> EVENT_OBJECT_TABLE<span class="operator">=</span><span class="string">&#x27;c_dept&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h4 id="5、删除触发器"><a href="#5、删除触发器" class="headerlink" title="5、删除触发器"></a>5、删除触发器</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> 触发器名称;</span><br></pre></td></tr></table></figure>



<h4 id="触发器的优点（使用场景）"><a href="#触发器的优点（使用场景）" class="headerlink" title="触发器的优点（使用场景）"></a><strong>触发器的优点（使用场景）</strong></h4><ul>
<li>（1）<strong>自动化</strong>：在指定的事件和时机下，自动触发执行，无需手动调用<ul>
<li>（例如：自定计算、日志记录）</li>
</ul>
</li>
<li>（2）<strong>数据一致性</strong>（强制实施业务规则）：触发器可以帮助确保表中的业务规则强制执行<ul>
<li>（例如：只能在工作日插入员工信息，价格不能为负数等）</li>
</ul>
</li>
<li>（3）<strong>简化代码</strong>：将重复的逻辑（例如备份、日志）封装在触发器中，避免程序重复编写</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>（1）性能影响：频繁触发的触发器会增加数据库负担</li>
<li>（2）调试困难：触发器在后台自动执行，出错时难以追踪</li>
</ul>
<p>**注意事项：**触发器内尽量只写简单逻辑（例如赋值、写日志），复杂业务建议使用存储过程</p>
<h3 id="14-定时任务"><a href="#14-定时任务" class="headerlink" title="14-定时任务"></a>14-定时任务</h3><h4 id="1、定时任务"><a href="#1、定时任务" class="headerlink" title="1、定时任务"></a>1、定时任务</h4><p>定时任务：通常指按预设时间自动执行的数据库操作（如数据清理、统计汇总、备份等）。<br>mysql中，内置的事件(EVENT)机制就是实现定时任务的核心工具<br>mysql提供<strong>事件调度器</strong>（event scheduler）来执行定时任务</p>
<h4 id="2、适用场景"><a href="#2、适用场景" class="headerlink" title="2、适用场景"></a>2、适用场景</h4><p><strong>（1）定时清理数据（例如清理过期日志、垃圾图片信息）</strong><br><strong>（2）数据统计和报表生成（例如每日的销售额汇总）</strong><br><strong>（3）缓存刷新或者数据同步</strong></p>
<h4 id="3、事件调度器的注意事项"><a href="#3、事件调度器的注意事项" class="headerlink" title="3、事件调度器的注意事项"></a>3、事件调度器的注意事项</h4><p>（1）权限要求：创建事件需要event权限<br>（2）依赖问题：事件中调用的存储过程 或 表 需要提前存在<br>（3）时间精度：最小执行间隔为 1s，但是频繁执行会影响性能<br>（4）错误处理：时间执行失败，不会自动重试，需要代码中处理异常</p>
<h4 id="4、语法"><a href="#4、语法" class="headerlink" title="4、语法"></a>4、语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> EVENT IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> 定时任务名称</span><br><span class="line"><span class="keyword">ON</span> SCHEDULE <span class="keyword">AT</span> <span class="operator">|</span> <span class="keyword">EVERY</span> 执行时间 </span><br><span class="line">	<span class="comment">-- AT 一次性定时任务, every 是周期定时任务</span></span><br><span class="line">DO</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">-- sql 逻辑</span></span><br><span class="line"><span class="keyword">END</span>; </span><br></pre></td></tr></table></figure>



<h4 id="1-查看事件调度器"><a href="#1-查看事件调度器" class="headerlink" title="1.查看事件调度器"></a>1.查看事件调度器</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;event_scheduler&#x27;</span>;  <span class="comment">-- ON</span></span><br><span class="line">    <span class="comment">-- on表示启用 off禁用</span></span><br></pre></td></tr></table></figure>



<h4 id="2、临时启用事件调度器，重启服务器后会失效"><a href="#2、临时启用事件调度器，重启服务器后会失效" class="headerlink" title="2、临时启用事件调度器，重启服务器后会失效"></a>2、临时启用事件调度器，重启服务器后会失效</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 如果默认是关闭的，需要临时启用</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> event_scheduler <span class="operator">=</span> <span class="keyword">ON</span>;</span><br></pre></td></tr></table></figure>



<h4 id="3-创建一次性执行事件"><a href="#3-创建一次性执行事件" class="headerlink" title="3.创建一次性执行事件"></a>3.创建一次性执行事件</h4><p>– 在指定时间删除超过2天的日志信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> EVENT IF <span class="keyword">EXISTS</span> delete_log_data;</span><br><span class="line"><span class="keyword">CREATE</span> EVENT IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> delete_log_data</span><br><span class="line"><span class="keyword">ON</span> SCHEDULE <span class="keyword">AT</span> <span class="string">&#x27;2025-08-07 18:27:00&#x27;</span> <span class="comment">-- 指定执行时间</span></span><br><span class="line">DO</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DELETE</span> <span class="keyword">FROM</span> c_dept_logs </span><br><span class="line">    <span class="keyword">WHERE</span> time_at <span class="operator">&lt;</span> <span class="built_in">CURRENT_DATE</span> <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">2</span> <span class="keyword">DAY</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> c_dept_logs;</span><br></pre></td></tr></table></figure>



<h4 id="4-周期性执行事件"><a href="#4-周期性执行事件" class="headerlink" title="4.周期性执行事件"></a>4.周期性执行事件</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> EVENT IF <span class="keyword">EXISTS</span> dayly_backup;</span><br><span class="line"><span class="keyword">CREATE</span> EVENT IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> dayly_backup</span><br><span class="line"><span class="keyword">ON</span> SCHEDULE <span class="keyword">EVERY</span> <span class="number">7</span> <span class="keyword">DAY</span> <span class="comment">-- 每7天执行一次</span></span><br><span class="line">STARTS <span class="string">&#x27;2025-08-07 01:00:00&#x27;</span></span><br><span class="line">DO</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- 调用存储过程</span></span><br><span class="line">  <span class="keyword">CALL</span> add_sal();</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>



<h4 id="5-管理定义的事件"><a href="#5-管理定义的事件" class="headerlink" title="5.管理定义的事件"></a>5.管理定义的事件</h4><h5 id="查看所有事件"><a href="#查看所有事件" class="headerlink" title="查看所有事件"></a>查看所有事件</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> EVENTS;</span><br></pre></td></tr></table></figure>



<h5 id="修改事件"><a href="#修改事件" class="headerlink" title="修改事件"></a>修改事件</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> EVENT dayly_backup</span><br><span class="line"><span class="keyword">ON</span> SCHEDULE <span class="keyword">EVERY</span> <span class="number">3</span> <span class="keyword">DAY</span>; <span class="comment">-- 修改为3天执行一次</span></span><br></pre></td></tr></table></figure>



<h5 id="启用-禁用事件"><a href="#启用-禁用事件" class="headerlink" title="启用 | 禁用事件"></a>启用 | 禁用事件</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> dayly_backup DISABLE; <span class="comment">-- 禁用</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> dayly_backup ENABLE; <span class="comment">-- 启用</span></span><br></pre></td></tr></table></figure>



<h5 id="删除事件"><a href="#删除事件" class="headerlink" title="删除事件"></a>删除事件</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> EVENT IF <span class="keyword">EXISTS</span> dayly_backup;</span><br></pre></td></tr></table></figure>



<h3 id="15-事务"><a href="#15-事务" class="headerlink" title="15-事务"></a>15-事务</h3><h4 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a><strong>1、概述</strong></h4><p>一件事情有n个组成单元 要不这n个组成单元同时成功 要不n个单元同时失败，这就是将n</p>
<p>个组成单元放到一个事务中</p>
<blockquote>
<p>概念：事务是用来控制一组sql语句的，要么全部成功，要么全部失败<br>为什么使用：用于保证事务的完整性</p>
</blockquote>
<h4 id="2、事务的特性和隔离级别"><a href="#2、事务的特性和隔离级别" class="headerlink" title="2、事务的特性和隔离级别"></a>2、事务的特性和隔离级别</h4><p><strong>事务的四大特性（ACID）:</strong></p>
<blockquote>
<p><strong>原子性</strong>（<strong>Atomicity</strong>）：是指事务是一个不可分割的整体，事务中的操作要么全部成功，要么全部失败。</p>
<p>例如：转账业务中减钱和加钱的操作，要么 同时成功，要么同时失败；</p>
<p><strong>一致性</strong>（<strong>完整性</strong>）（<strong>Consistency</strong>）：是指一个事务中，事务前后数据的完整性必须保持一致。</p>
<p>例如：转账业务中，转账前和转账后，总金额必须一致；</p>
<p><strong>隔离性</strong>（<strong>Isolation</strong>）：多个事务，事务的隔离性是指在并发事务中，一个事务不能被其他事务所干扰，多个并发事务之间数据要相互隔离。</p>
<p><strong>持久性</strong>（<strong>Durability</strong>）：是指一个事务一旦被提交，该事务对数据库中数据的操作，必须被持久化</p>
</blockquote>
<p>事务的四大特性（ACID）是数据库系统中保证数据一致性和可靠性的核心原则。这四个特性分别是：<strong>原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）和持久性（Durability）</strong>。下面我们通过一个经典的银行转账例子来逐一解释。</p>
<hr>
<h5 id="🏦-场景：银行转账"><a href="#🏦-场景：银行转账" class="headerlink" title="🏦 场景：银行转账"></a>🏦 场景：银行转账</h5><p>假设用户 A 向用户 B 转账 100 元：</p>
<ul>
<li>A 的账户余额减少 100 元</li>
<li>B 的账户余额增加 100 元</li>
</ul>
<p>这个操作必须作为一个<strong>事务</strong>来执行，以确保数据的正确性。</p>
<hr>
<h5 id="1-原子性（Atomicity）"><a href="#1-原子性（Atomicity）" class="headerlink" title="1. 原子性（Atomicity）"></a>1. 原子性（Atomicity）</h5><blockquote>
<p><strong>“要么全部执行，要么全部不执行。”</strong></p>
</blockquote>
<h6 id="举例："><a href="#举例：" class="headerlink" title="举例："></a>举例：</h6><p>在转账过程中，如果 A 的账户成功扣了 100 元，但系统在给 B 加钱时突然崩溃了，那么整个操作必须<strong>回滚（rollback）</strong>，A 扣的钱也要退还。</p>
<p>✅ 原子性确保：  </p>
<blockquote>
<p>“转账”这个操作是一个不可分割的整体。即使中间出错，也不会出现“钱消失”的情况。</p>
</blockquote>
<p>❌ 如果没有原子性：  </p>
<blockquote>
<p>A 少了 100 元，B 没收到钱 → 钱“凭空消失”。</p>
</blockquote>
<hr>
<h5 id="2-一致性（Consistency）"><a href="#2-一致性（Consistency）" class="headerlink" title="2. 一致性（Consistency）"></a>2. 一致性（Consistency）</h5><blockquote>
<p><strong>“事务执行前后，数据库都处于一致状态。”</strong></p>
</blockquote>
<h6 id="举例：-1"><a href="#举例：-1" class="headerlink" title="举例："></a>举例：</h6><p>转账前：  </p>
<ul>
<li>A 有 500 元，B 有 300 元 → 总金额 &#x3D; 800 元</li>
</ul>
<p>转账后：  </p>
<ul>
<li>A 有 400 元，B 有 400 元 → 总金额仍为 800 元</li>
</ul>
<p>✅ 一致性确保：  </p>
<blockquote>
<p>无论事务是否成功，数据库的<strong>业务规则</strong>（如总金额不变、余额不能为负等）始终被遵守。</p>
</blockquote>
<p>❌ 如果没有一致性：  </p>
<blockquote>
<p>A 扣了 100 元，B 加了 150 元 → 总金额变成 850 元，破坏了“资金守恒”。</p>
</blockquote>
<blockquote>
<p>💡 注意：一致性是由应用程序和数据库共同维护的，事务的原子性、隔离性、持久性是实现一致性的手段。</p>
</blockquote>
<hr>
<h5 id="3-隔离性（Isolation）"><a href="#3-隔离性（Isolation）" class="headerlink" title="3. 隔离性（Isolation）"></a>3. 隔离性（Isolation）</h5><blockquote>
<p><strong>“并发执行的多个事务之间互不干扰。”</strong></p>
</blockquote>
<h6 id="举例：-2"><a href="#举例：-2" class="headerlink" title="举例："></a>举例：</h6><p>A 正在给 B 转账（事务未完成），同时 C 也在查询 B 的余额。</p>
<p>✅ 隔离性确保：  </p>
<blockquote>
<p>在 A 的转账事务提交之前，C 查询到的 B 的余额仍然是旧值（比如 300 元），不会看到“中间状态”（如 350 元）。</p>
</blockquote>
<blockquote>
<p>这防止了<strong>脏读</strong>、<strong>不可重复读</strong>、<strong>幻读</strong>等问题。</p>
</blockquote>
<p>❌ 如果没有隔离性：  </p>
<blockquote>
<p>C 看到 B 的余额变成 400 元，但随后 A 的转账失败并回滚，B 实际还是 300 元 → C 读到了“脏数据”。</p>
</blockquote>
<hr>
<h5 id="4-持久性（Durability）"><a href="#4-持久性（Durability）" class="headerlink" title="4. 持久性（Durability）"></a>4. 持久性（Durability）</h5><blockquote>
<p><strong>“一旦事务提交，其结果就是永久性的，即使系统崩溃也不会丢失。”</strong></p>
</blockquote>
<h6 id="举例：-3"><a href="#举例：-3" class="headerlink" title="举例："></a>举例：</h6><p>A 成功给 B 转账 100 元，事务提交后：</p>
<ul>
<li>系统突然断电或重启</li>
</ul>
<p>✅ 持久性确保：  </p>
<blockquote>
<p>重启后，A 的余额是 400 元，B 的余额是 400 元，转账结果不会丢失。</p>
</blockquote>
<blockquote>
<p>数据库会通过写日志（如 redo log）等方式，确保已提交的事务能被恢复。</p>
</blockquote>
<p>❌ 如果没有持久性：  </p>
<blockquote>
<p>转账成功了，但一重启，数据又变回转账前的状态 → 用户“白转了”。</p>
</blockquote>
<hr>
<h5 id="✅-总结（用一句话记住-ACID）"><a href="#✅-总结（用一句话记住-ACID）" class="headerlink" title="✅ 总结（用一句话记住 ACID）"></a>✅ 总结（用一句话记住 ACID）</h5><table>
<thead>
<tr>
<th>特性</th>
<th>一句话解释</th>
</tr>
</thead>
<tbody><tr>
<td><strong>A 原子性</strong></td>
<td>要么全做，要么全不做</td>
</tr>
<tr>
<td><strong>C 一致性</strong></td>
<td>数据始终符合业务规则</td>
</tr>
<tr>
<td><strong>I 隔离性</strong></td>
<td>并发事务互不干扰</td>
</tr>
<tr>
<td><strong>D 持久性</strong></td>
<td>提交后永不丢失</td>
</tr>
</tbody></table>
<blockquote>
<p>💡 所有现代关系型数据库（如 MySQL、PostgreSQL、Oracle）都通过日志、锁、MVCC 等技术来实现这四大特性，确保数据安全可靠。</p>
</blockquote>
<p>准备表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `account`;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> `account` (</span><br><span class="line">  `id` <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> auto_increment,</span><br><span class="line">  `name` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `balance` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">NOT NULL</span> <span class="keyword">CHECK</span>(balance <span class="operator">&gt;=</span> <span class="number">0</span>)</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> account(`name`,balance) </span><br><span class="line">  <span class="keyword">VALUES</span>(<span class="string">&#x27;tom&#x27;</span>,<span class="number">20000.00</span>),(<span class="string">&#x27;rose&#x27;</span>,<span class="number">20000.00</span>);</span><br></pre></td></tr></table></figure>

<p>– 查询数据库的事务提交方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>; <span class="comment">-- 默认 = 1，表示自动提交</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@autocommit</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">-- 修改为手动提交</span></span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@autocommit</span> <span class="operator">=</span> <span class="number">1</span>;<span class="comment">-- 修改为自动提交</span></span><br></pre></td></tr></table></figure>



<h4 id="模拟转账业务"><a href="#模拟转账业务" class="headerlink" title="模拟转账业务"></a>模拟转账业务</h4><h5 id="手动控制事务流程"><a href="#手动控制事务流程" class="headerlink" title="手动控制事务流程"></a>手动控制事务流程</h5><p>（1）修改数据库提交事务的方式：SET @@autocommit &#x3D; 0;<br>（2）执行事务中的SQL语句<br>（3）如果没有异常，执行 commit 提交事务<br>（4）如果出现异常，执行 rollback 回滚事务</p>
<p>– （1）修改提交方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> @<span class="variable">@autocommit</span> <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>– （2）执行SQL语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询余额</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> account <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;tom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- tom账户减少10000元</span></span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance<span class="operator">=</span>balance<span class="number">-10000</span> <span class="keyword">WHERE</span> `name`<span class="operator">=</span><span class="string">&#x27;tom&#x27;</span>;</span><br><span class="line">异常</span><br><span class="line"><span class="comment">-- rose账户增加1000元</span></span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance<span class="operator">=</span>balance<span class="operator">+</span><span class="number">10000</span> <span class="keyword">WHERE</span> `name`<span class="operator">=</span><span class="string">&#x27;rose&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果没有异常：</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果出现异常：</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="由数据库控制事务的流程"><a href="#由数据库控制事务的流程" class="headerlink" title="由数据库控制事务的流程"></a>由数据库控制事务的流程</h5><p>（1）修改数据库提交事务的方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> @<span class="variable">@autocommit</span> <span class="operator">=</span> <span class="number">1</span>（mysql数据库默认为<span class="number">1</span>）</span><br></pre></td></tr></table></figure>

<p>（2）开始事务<br>（3）执行事务中的SQL语句<br>（4）如果没有异常，执行commit<br>（5）如果有异常，执行rollback</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="comment">-- BEGIN; -- 第一种方式开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION; <span class="comment">-- 第二种方式开启事务</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 查询余额</span></span><br><span class="line">  <span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> account <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;tom&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- tom账户减少10000元</span></span><br><span class="line">  <span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance<span class="operator">=</span>balance<span class="number">-10000</span> <span class="keyword">WHERE</span> `name`<span class="operator">=</span><span class="string">&#x27;tom&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  出现异常</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- rose账户增加1000元</span></span><br><span class="line">  <span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance<span class="operator">=</span>balance<span class="operator">+</span><span class="number">10000</span> <span class="keyword">WHERE</span> `name`<span class="operator">=</span><span class="string">&#x27;rose&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>



<h4 id="使用存储过程完成转账业务操作"><a href="#使用存储过程完成转账业务操作" class="headerlink" title="使用存储过程完成转账业务操作"></a><strong>使用存储过程完成转账业务操作</strong></h4><p>需求<br>（1）查询余额大于1000的 可以转账,小于1000，提示余额不足<br>（2）出现异常，回滚事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> transfer_money;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> transfer_money(</span><br><span class="line">  <span class="keyword">IN</span> out_id <span class="type">INT</span>, <span class="comment">-- 转出账户</span></span><br><span class="line">  <span class="keyword">IN</span> in_id <span class="type">INT</span>, <span class="comment">-- 转入账户</span></span><br><span class="line">  <span class="keyword">IN</span> money <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>), <span class="comment">-- 转账金额</span></span><br><span class="line">  <span class="keyword">OUT</span> result_msg <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="comment">-- 转账结果</span></span><br><span class="line">)</span><br><span class="line">label: <span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- 转出账户的余额</span></span><br><span class="line">  <span class="keyword">DECLARE</span> out_balance <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>; </span><br><span class="line">  <span class="comment">-- 判断转入账户是否存在</span></span><br><span class="line">  <span class="keyword">DECLARE</span> has_in_id <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 异常处理器</span></span><br><span class="line">  <span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span> </span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">ROLLBACK</span>; <span class="comment">-- 回滚事务</span></span><br><span class="line">    <span class="keyword">SET</span> result_msg :<span class="operator">=</span> <span class="string">&#x27;转账失败，系统出现异常，请重试！！！&#x27;</span>;</span><br><span class="line">  <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 判断转入账户是否存在</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> has_in_id <span class="keyword">FROM</span> account <span class="keyword">WHERE</span> id<span class="operator">=</span>in_id;</span><br><span class="line"></span><br><span class="line">  IF has_in_id <span class="operator">=</span><span class="number">0</span> <span class="keyword">THEN</span> </span><br><span class="line">    <span class="keyword">SET</span> result_msg :<span class="operator">=</span> <span class="string">&#x27;转入账户不存在！！！&#x27;</span>;</span><br><span class="line">    LEAVE label; <span class="comment">-- leave后续代码不执行</span></span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 开始事务</span></span><br><span class="line">  <span class="keyword">START</span> TRANSACTION; </span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 查询转出账户的余额</span></span><br><span class="line">  <span class="keyword">SELECT</span> balance <span class="keyword">INTO</span> out_balance <span class="keyword">FROM</span> account <span class="keyword">WHERE</span> id<span class="operator">=</span>out_id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 判断余额 与 转账金额 大小</span></span><br><span class="line">  IF out_balance <span class="operator">&gt;=</span> money <span class="keyword">THEN</span> </span><br><span class="line">    <span class="comment">-- 转出账户减钱</span></span><br><span class="line">    <span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance<span class="operator">=</span>balance<span class="operator">-</span>money <span class="keyword">WHERE</span> id<span class="operator">=</span>out_id;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">-- 模拟的SQL异常</span></span><br><span class="line"><span class="comment">--     SELECT * FROM CCC;   </span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 转入账户加钱</span></span><br><span class="line">  <span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance<span class="operator">=</span>balance<span class="operator">+</span>money <span class="keyword">WHERE</span> id<span class="operator">=</span>in_id;</span><br><span class="line">  <span class="comment">-- 转账完成，提交事务</span></span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line">  <span class="keyword">SET</span> result_msg :<span class="operator">=</span> <span class="string">&#x27;转账成功！！！&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">ELSE</span> </span><br><span class="line">    <span class="keyword">ROLLBACK</span>;</span><br><span class="line">    <span class="keyword">SET</span> result_msg :<span class="operator">=</span> <span class="string">&#x27;转账失败，您的余额不足！！！&#x27;</span>;</span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@result</span> :<span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确转账</span></span><br><span class="line"><span class="keyword">CALL</span> transfer_money(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1000</span>,<span class="variable">@result</span>); </span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@result</span>; <span class="comment">-- 转账成功！！！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 余额不足</span></span><br><span class="line"><span class="keyword">CALL</span> transfer_money(<span class="number">3</span>,<span class="number">2</span>,<span class="number">2000</span>,<span class="variable">@result</span>); </span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@result</span>;  <span class="comment">-- 转账失败，您的余额不足！！！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 账号不存在</span></span><br><span class="line"><span class="keyword">CALL</span> transfer_money(<span class="number">2</span>,<span class="number">6</span>,<span class="number">2000</span>,<span class="variable">@result</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@result</span>;  <span class="comment">-- 转入账户不存在！！！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 出现异常</span></span><br><span class="line"><span class="keyword">CALL</span> transfer_money(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1000</span>,<span class="variable">@result</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@result</span>; <span class="comment">-- 转账失败，系统出现异常，请重试！！！</span></span><br></pre></td></tr></table></figure>



<h4 id="3、事务的并发问题"><a href="#3、事务的并发问题" class="headerlink" title="3、事务的并发问题"></a>3、<strong>事务的并发问题</strong></h4><blockquote>
<p>1、<strong>脏读</strong>：是指一个事务读取到了另外一个事务未提交的数据（脏数据）；<br>2、<strong>不可重复读</strong>：当前事务在读取数据时，另外一个事务修改了数据，导致当前事务对数据的两次查询结果不一致；<br>3、<strong>幻读</strong>：当前事务读取表数据，另外一个事务对表的数据进行了新增或删除，导致当前事务对表的两次查询结果不一致。</p>
</blockquote>
<p><strong>事务的隔离级别</strong></p>
<blockquote>
<ol>
<li><strong>Read uncommitted  读未提交</strong>： 可能出现任何事物的并发问题</li>
<li><strong>Read committed 读已提交</strong>：解决了脏读问题</li>
<li><strong>Repeatable read 可重复读</strong>：解决了脏读和不可重复读问题（mysql默认）</li>
<li><strong>Serializable 序列（串行）化</strong>： 都不会出现</li>
</ol>
</blockquote>
<p><strong>查询 隔离级别</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.transaction_isolation; <span class="comment">-- REPEATABLE-READ是mysql默认的 隔离级别</span></span><br></pre></td></tr></table></figure>

<p>设置隔离级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line">    <span class="comment">-- 将隔离级别设置为 读未提交 数据</span></span><br><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line">    <span class="comment">-- -- 将隔离级别设置为 可重复读</span></span><br></pre></td></tr></table></figure>


<p>事务一：<br>Repeatable read 可重复读：解决了脏读和不可重复读问题（mysql默认）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance<span class="operator">=</span>balance<span class="operator">+</span><span class="number">1000</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">3</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>事务二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> account <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">3</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>



<h3 id="16-数据库三大范式"><a href="#16-数据库三大范式" class="headerlink" title="16-数据库三大范式"></a>16-数据库三大范式</h3><h4 id="数据库范式的作用："><a href="#数据库范式的作用：" class="headerlink" title="数据库范式的作用："></a>数据库范式的作用：</h4><p>数据库的三大范式是关系型数据库设计中用于<strong>规范表结构</strong>、<strong>减少数据冗余</strong>和<strong>避免更新异常</strong>的重要原则。它们从低到高逐步细化，每一级范式都建立在对上一级范式的满足之上。</p>
<h4 id="简答："><a href="#简答：" class="headerlink" title="简答："></a>简答：</h4><blockquote>
<p><strong>1NF</strong>：列不可分割（原子性）。<br><strong>2NF</strong>：消除非主属性对复合主键的部分依赖（基于1NF）。<br><strong>3NF</strong>：消除非主属性之间的传递依赖（基于2NF）。  </p>
</blockquote>
<p><strong>注意</strong>：范式并非越高越好，过度规范化可能导致表数量过多，查询时需频繁关联表，降低性能。实际设计中需在规范化和查询效率之间权衡，有时会适当保留少量冗余（如反范式设计）。</p>
<blockquote>
<h4 id="第一范式："><a href="#第一范式：" class="headerlink" title="第一范式："></a>第一范式：</h4><p><strong>原子性</strong>，确保表中的每个列是原子列，不可再分。</p>
<h4 id="第二范式："><a href="#第二范式：" class="headerlink" title="第二范式："></a>第二范式：</h4><p>在满足第一范式的基础上，保证表中的所有非主键属性必须完全依赖于整个主键，而不能仅依赖于主键的一部分，解决的是复合主键下，表中数据冗余和更新异常的问题</p>
<h4 id="第三范式："><a href="#第三范式：" class="headerlink" title="第三范式："></a>第三范式：</h4><p>在满足第二范式的基础上，所有的非主键属性之间不能存在直接的依赖关系，主键属性必须直接主键属性，解决的是非主键属性对主键的依赖传递问题（非主键属性之间存在依赖）</p>
</blockquote>
<h4 id="三范式解决什么问题"><a href="#三范式解决什么问题" class="headerlink" title="三范式解决什么问题"></a>三范式解决什么问题</h4><p><strong>1NF</strong>: 确保数据的基本单元，为后面的范式打下基础<br><strong>2NF</strong>: 确保复合主键情况下，数据冗余和更新异常问题<br><strong>3NF</strong>：解决非主键属性 间接 依赖主键问题（非主键属性之间存在依赖传递）</p>
<h3 id="17-存储引擎"><a href="#17-存储引擎" class="headerlink" title="17-存储引擎"></a>17-存储引擎</h3><h4 id="mysql体系结构"><a href="#mysql体系结构" class="headerlink" title="mysql体系结构"></a>mysql体系结构</h4><p>(1)连接层：主要负责连接处理、授权认证、安全方案等功能。<br>(2)服务层：主要负责大多数核心服务功能，比如sql接口，完成缓存查询，布置函数的执行等功能。<br>(3)<strong>引擎层</strong>：存储引擎主要负责mysql中数据的存储和提取。<br>(4)存储层：主要负责将数据存储到磁盘文件中。</p>
<h4 id="存储引擎的作用："><a href="#存储引擎的作用：" class="headerlink" title="存储引擎的作用："></a>存储引擎的作用：</h4><p>存储引擎就是<strong>存储数据、建立索引、更新&#x2F;查询数据</strong>等技术的实现方式。<br>存储引擎是<strong>基于表</strong>的，而不是基于库的，所以存储引擎也可被称为<strong>表类型</strong>。</p>
<p>查看数据库支持的存储引擎：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> ENGINES;</span><br><span class="line"><span class="comment">-- InnoDB</span></span><br><span class="line"><span class="comment">-- MyISAM</span></span><br><span class="line"><span class="comment">-- MEMORY</span></span><br></pre></td></tr></table></figure>

<p>可以查看表使用的存储引擎：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> account;</span><br></pre></td></tr></table></figure>

<h4 id="设置存储引擎"><a href="#设置存储引擎" class="headerlink" title="设置存储引擎"></a>设置存储引擎</h4><p>创建表的语句都没有指定表的存储引擎，那就会使用默认的存储引擎 InnoDB 。如果我们想显 式的指定一下表的存储引擎，那可以这么写： </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> 表名(</span><br><span class="line">建表语句;</span><br><span class="line">) ENGINE <span class="operator">=</span> 存储引擎名称;</span><br></pre></td></tr></table></figure>

<p> 如果表已经建好了，我们也可以使用下边这个语句来修改表的存储引擎 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名 ENGINE <span class="operator">=</span> 存储引擎名称;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例：</span></span><br><span class="line"><span class="keyword">alter table</span> t_emp engine <span class="operator">=</span> <span class="string">&#x27;MYISAM&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h4 id="存储引擎特点"><a href="#存储引擎特点" class="headerlink" title="存储引擎特点"></a>存储引擎特点</h4><h4 id="1、-InnoDB"><a href="#1、-InnoDB" class="headerlink" title="1、 InnoDB"></a>1、 <strong>InnoDB</strong></h4><blockquote>
<p>(1)介绍<br>	InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在 MySQL 5.5 之后，InnoDB是<strong>默认</strong>的 MySQL 存储引擎。<br>(2) 特点<br>DML操作遵循ACID模型，支持事务 ；<br>行级锁 ，提高并发访问性能；<br>支持外键 FOREIGN KEY约束，保证数据的完整性和正确性；<br>(3) 文件<br><strong>xxx.ibd</strong>：xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件，<br>存储该表的表结构（frm、sdi）、数据和索引。<br>(4) InnoDB 存储结构<br><strong>表空间 → 段(1M) → 区(64页) → 页(16k) → 行</strong></p>
</blockquote>
<p>查看每张表是否开启了对应的表空间：<br>参数：<code>innodb_file_per_table</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;innodb_file_per_table&#x27;</span>; <span class="comment">-- ON</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>on 打开的，表示每张表对应一个表空间文件</p>
</blockquote>
<p><img src="/images/1754822778050.png" alt="1754822778050"></p>
<p>查看表空间文件</p>
<p>首先查看  MySQL 的表空间文件 <strong>默认存放在数据目录</strong> 下，可通过 SQL 命令查询： </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;datadir&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/1754823084537.png" alt="1754823084537"></p>
<p>进入 mysql 数据目录：</p>
<p><img src="/images/1754823181658.png" alt="1754823181658"></p>
<p><img src="/images/1754826017259.png" alt="1754826017259"></p>
<p><strong>windows下默认存放数据目录</strong>：在 mysql 安装的 data 目录中</p>
<p><img src="/images/1754823369860.png" alt="1754823369860"></p>
<h5 id="查看表文件内容"><a href="#查看表文件内容" class="headerlink" title="查看表文件内容"></a>查看表文件内容</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibd2sdi xxx.ibd</span><br></pre></td></tr></table></figure>

<p><img src="/images/1754823713034.png" alt="1754823713034"></p>
<h5 id="逻辑存储结构"><a href="#逻辑存储结构" class="headerlink" title="逻辑存储结构"></a>逻辑存储结构</h5><p><img src="/images/1754823431942.png" alt="1754823431942"></p>
<h4 id="2、MyISAM"><a href="#2、MyISAM" class="headerlink" title="2、MyISAM"></a>2、MyISAM</h4><p>(1) 介绍<br>	MyISAM是MySQL早期的默认存储引擎。<br>(2) 特点<br>    不支持事务，不支持外键<br>    支持表锁，不支持行锁<br>    访问速度快<br>(3) 文件<br>    xxx.sdi：存储表结构信息<br>    xxx.MYD: 存储数据<br>    xxx.MYI: 存储索引</p>
<p><strong>修改存储引擎：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> account ENGINE <span class="operator">=</span> <span class="string">&#x27;MyISAM&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="查看数据文件"><a href="#查看数据文件" class="headerlink" title="查看数据文件"></a>查看数据文件</h5><p><img src="/images/1754826172999.png" alt="1754826172999"></p>
<h4 id="3、Memory"><a href="#3、Memory" class="headerlink" title="3、Memory"></a>3、Memory</h4><p>(1) 介绍<br>	Memory引擎的表数据时存储在<strong>内存</strong>中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为临时表或缓存使用。<br>(2) 特点<br>    内存存放<br>    hash索引（默认）<br>(3) 文件<br>    xxx.sdi：存储表结构信息</p>
<h4 id="4、存储引擎选择"><a href="#4、存储引擎选择" class="headerlink" title="4、存储引擎选择"></a>4、存储引擎选择</h4><p>在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。</p>
<p><strong>InnoDB</strong> : 是Mysql的默认存储引擎，支持事务、外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。</p>
<p><strong>MyISAM</strong> ： 如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。</p>
<p><strong>MEMORY</strong>：将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。</p>
<h3 id="18-1索引"><a href="#18-1索引" class="headerlink" title="18-1索引"></a>18-1索引</h3><h4 id="1、索引的概念"><a href="#1、索引的概念" class="headerlink" title="1、索引的概念"></a>1、索引的概念</h4><p>索引(index)是帮助MySQL高效获取数据的数据结构(有序)。<br>在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用(指向)数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p>
<p>简单来说，数据库中的索引就类似<strong>图书的目录</strong>，我们可以根据索引快速高效的查找数据</p>
<h4 id="2、索引的优缺点"><a href="#2、索引的优缺点" class="headerlink" title="2、索引的优缺点"></a>2、索引的优缺点</h4><p><strong>优势：</strong><br>    (1)提高数据检索的效率，降低数据库的IO成本<br>    (2)通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗。<br><strong>劣势：</strong><br>    (1)索引列也是要占用空间的。<br>    (2)索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE时，效率降低。</p>
<h4 id="3、mysql索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构："><a href="#3、mysql索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构：" class="headerlink" title="3、mysql索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构："></a>3、mysql索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构：</h4><p>(1) b+tree 索引：最常见的索引类型<br>(2) hash 索引：底层是hash表实现的，只能用于精准匹配</p>
<h4 id="4、为什么InnoDB存储引擎选择使用B-tree索引结构？"><a href="#4、为什么InnoDB存储引擎选择使用B-tree索引结构？" class="headerlink" title="4、为什么InnoDB存储引擎选择使用B+tree索引结构？"></a>4、为什么InnoDB存储引擎选择使用B+tree索引结构？</h4><p>(1)相对于二叉树，b+tree层级更少，搜索效率高；<br>(2)B-tree,无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，同样保存大量数据，只能增加树的高度，导致性能降低；<br>(3) 相对Hash索引，B+tree支持<strong>范围匹配</strong>及排序操作；</p>
<h4 id="5、索引的分类"><a href="#5、索引的分类" class="headerlink" title="5、索引的分类"></a>5、索引的分类</h4><p>(1)<strong>主键索引</strong>：针对于表中主键创建的索引，默认自动创建，只能有一个关键字：PRIMARY<br>(2)<strong>唯一索引</strong>：避免同一个表中某数据列中的值重复，可以有多个关键字：UNIQUE<br>(3)普通索引：快速定位特定数据<br>(4)全文索引：全文索引查找的是文本中的关键词，而不是比较索引中的值</p>
<h4 id="6、根据索引的存储形式又可以分为："><a href="#6、根据索引的存储形式又可以分为：" class="headerlink" title="6、根据索引的存储形式又可以分为："></a>6、根据索引的存储形式又可以分为：</h4><p>(1)聚集索引(Clustered Index)：将数据存储与索引放到了一块，索引结构的叶子节点保存了行数据<br>(2)二级索引(Secondary Index)：将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键</p>
<h4 id="7、聚集索引选取的规则："><a href="#7、聚集索引选取的规则：" class="headerlink" title="7、聚集索引选取的规则："></a><strong>7、聚集索引选取的规则：</strong></h4><ul>
<li>如果存在主键，主键索引就是聚集索引。</li>
<li>如果不存在主键，将使用第一个唯一UNIQUE）索引作为聚集索引。</li>
<li>如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索引。</li>
</ul>
<h4 id="8、聚集索引和二级索引谁的查询的效率高？为什么？"><a href="#8、聚集索引和二级索引谁的查询的效率高？为什么？" class="headerlink" title="8、聚集索引和二级索引谁的查询的效率高？为什么？"></a>8、聚集索引和二级索引谁的查询的效率高？为什么？</h4><p>​    聚集索引的效率高<br>​    聚集索引将数据存储与索引放到了一块，二级索引将数据与索引分开存储，<br>它的索引结构的叶子节点关联的是对应的主键，使用二级索引查询，还是需要回表查询聚集索引</p>
<h3 id="18-2-索引"><a href="#18-2-索引" class="headerlink" title="18-2 索引"></a>18-2 索引</h3><h4 id="1、sql性能分析"><a href="#1、sql性能分析" class="headerlink" title="1、sql性能分析"></a>1、sql性能分析</h4><p>执行命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 命令可以提供服务器状态信息</span></span><br><span class="line"><span class="comment">-- 查看当前数据库的INSERT、 UPDATE、 DELETE、SELECT的访问频次：</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_______&#x27;</span>;   <span class="comment">-- 7个下划线，匹配7个字符</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/1754998453376.png" alt="1754998453376"></p>
<h4 id="2、慢查询日志"><a href="#2、慢查询日志" class="headerlink" title="2、慢查询日志"></a>2、慢查询日志</h4><p>配置文件的位置：&#x2F;etc&#x2F;my.cnf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启mysql慢日志查询开关</span></span><br><span class="line">slow_query_log=1</span><br><span class="line"><span class="comment">#设置慢日志的时间为2秒，sql语句执行时间超过2秒，就会是为慢查询，记录慢查询日志</span></span><br><span class="line">long_query_time=2</span><br></pre></td></tr></table></figure>

<p>设置完成后重启mysql服务器进行测试</p>
<p>查看慢日志文件中记录的信息 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 动态显示文档的最后内容,一般用来查看日志，执行命令：`tail -f b.txt`</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/lib/mysql/localhost-slow.log</span><br></pre></td></tr></table></figure>



<p>查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> age <span class="operator">&gt;</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/1755001488316.png" alt="1755001488316"></p>
<p>慢日志记录：</p>
<p><img src="/images/1755001544981.png" alt="1755001544981"></p>
<h4 id="3、profile详情"><a href="#3、profile详情" class="headerlink" title="3、profile详情"></a>3、profile详情</h4><p>show profiles 能够在做SQL优化时帮助我们了解时间都耗费到哪里去了。通过have_profiling参数，能够看到当前MySQL是否支持</p>
<p>profile操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@have_profiling</span>;   <span class="comment">-- 是否支持， yes 表示支持</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@profiling</span> ;   <span class="comment">-- 默认状态  0 表示关闭</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@profiling</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- 开启 profile操作</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/1755000519068.png" alt="1755000519068"></p>
<p>执行一系列的业务SQL的操作，然后通过如下指令查看指令的执行耗时：</p>
<p><strong>3.1 查看每一条sql的耗时基本情况</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profiles;</span><br></pre></td></tr></table></figure>

<p><img src="/images/1755000656665.png" alt="1755000656665"></p>
<p><strong>3.2 查看指定query_id的SQL语句各个阶段的耗时情况</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profile <span class="keyword">for</span> query query_id;</span><br></pre></td></tr></table></figure>

<p><img src="/images/1755001003608.png" alt="1755001003608"></p>
<blockquote>
<p> 各状态参数解析</p>
</blockquote>
<table>
<thead>
<tr>
<th>Status</th>
<th>中文含义</th>
<th>关键说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>starting</code></td>
<td>查询启动阶段</td>
<td>MySQL 初始化查询处理（如解析 SQL、准备执行环境），耗时通常很短。</td>
</tr>
<tr>
<td><code>Executing hook on transaction</code></td>
<td>事务钩子执行</td>
<td>触发事务相关的预处理逻辑（如事务启动、钩子函数），一般耗时极短。</td>
</tr>
<tr>
<td><code>starting</code></td>
<td>二次启动阶段（子阶段）</td>
<td>部分复杂查询会进入子阶段初始化（如子查询、存储过程内部逻辑）。</td>
</tr>
<tr>
<td><code>checking permissions</code></td>
<td>权限检查</td>
<td>验证用户对查询涉及的表、列是否有操作权限，权限未缓存时可能稍慢。</td>
</tr>
<tr>
<td><code>Opening tables</code></td>
<td>打开表</td>
<td>打开需要访问的表，获取表锁（如 <code>MyISAM</code> 表的读锁），耗时与表数量相关。</td>
</tr>
<tr>
<td><code>init</code></td>
<td>查询初始化</td>
<td>分配内存、设置查询上下文（如变量、临时表），简单查询此阶段很快。</td>
</tr>
<tr>
<td><code>System lock</code></td>
<td>系统级锁</td>
<td>申请表级锁（如 <code>FLUSH TABLES</code> 时的锁），或等待全局锁，通常耗时极短。</td>
</tr>
<tr>
<td><strong><code>optimizing</code></strong></td>
<td><strong>查询优化</strong></td>
<td><strong>优化器生成执行计划（选择索引、连接顺序等），耗时 <code>0.014875</code> 相对较高</strong>，可能因：<br>- 表统计信息过时（需 <code>ANALYZE TABLE</code>）；<br>- 查询逻辑复杂（多表连接、子查询）。</td>
</tr>
<tr>
<td><strong><code>statistics</code></strong></td>
<td><strong>统计信息收集</strong></td>
<td><strong>收集表的统计数据（行数、索引分布等），耗时 <code>0.018313</code> 较高</strong>，原因：<br>- 表数据量大；<br>- 统计信息未更新（需 <code>ANALYZE TABLE</code>）。</td>
</tr>
<tr>
<td><code>preparing</code></td>
<td>执行计划准备</td>
<td>将优化后的执行计划转换为可执行的操作（如绑定参数、准备迭代器）。</td>
</tr>
<tr>
<td><code>executing</code></td>
<td>查询执行</td>
<td>实际遍历索引、扫描行（如 <code>Index Scan</code> <code>Table Scan</code>），此阶段耗时低，说明执行本身很快（瓶颈在前序阶段）。</td>
</tr>
<tr>
<td><code>end</code></td>
<td>执行结束</td>
<td>清理查询执行的中间状态（如临时变量）。</td>
</tr>
<tr>
<td><code>query end</code></td>
<td>查询收尾</td>
<td>处理结果集的最终步骤（如排序、封装结果）。</td>
</tr>
<tr>
<td><code>waiting for handler commit</code></td>
<td>等待存储引擎提交</td>
<td>等待存储引擎完成事务提交（如写日志、释放锁），耗时短则事务简单。</td>
</tr>
<tr>
<td><code>closing tables</code></td>
<td>关闭表</td>
<td>释放表资源、关闭文件句柄，耗时与表数量相关。</td>
</tr>
<tr>
<td><code>freeing items</code></td>
<td>释放内存</td>
<td>释放查询过程中分配的内存（如缓存的查询计划、临时数据）。</td>
</tr>
<tr>
<td><code>cleaning up</code></td>
<td>最终清理</td>
<td>释放线程资源、标记查询结束，耗时极短。</td>
</tr>
</tbody></table>
<p><strong>3.3 查看指定query_id的SQL语句cpu的使用情况</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profile  cpu <span class="keyword">for</span>  query query_id;</span><br></pre></td></tr></table></figure>



<h4 id="4、explain-执行计划"><a href="#4、explain-执行计划" class="headerlink" title="4、explain 执行计划"></a>4、explain 执行计划</h4><p>EXPLAIN或者DESC命令获取MYSQL如何执行SELECT语句的信息，包括在SELECT语句执行过程中表如何连接和连接的顺序。</p>
<p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 直接在select 语句之前加上关键字  explain /desc</span></span><br><span class="line">explain <span class="keyword">select</span> 字段列表  <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件;</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p><img src="/images/1755001630431.png" alt="1755001630431"></p>
<p>解析：</p>
<p>EXPLAIN 执行计划各字段含义：</p>
<ul>
<li><strong>Id</strong>：select查询的序列号，表示查询中执行select子句或者是操作表的顺序(<strong>id相同，执行顺序从上到下； id不同，值越大，越先执行</strong>)。</li>
<li>select_type：表示 SELECT 的类型，常见的取值有 SIMPLE（简单表，即不使用表连接或者子查询）、 PRIMARY（主查询，即外层的查询）、UNION（UNION 中的第二个或者后面的查询语句）、SUBQUERY（SELECT&#x2F;WHERE之后包含了子查询）等</li>
<li><strong>type</strong>：表示连接类型，性能由好到差的连接类型为NULL、system、<strong>const</strong>、eq_ref、 <strong>ref</strong>、 range、 index、all </li>
<li>possible_key：显示可能应用在这张表上的索引，一个或多个。</li>
<li>Key：实际使用的索引，如果为NULL，则没有使用索引。</li>
<li>Key_len：表示索引中使用的字节数， 该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下， 长度越短越好 。</li>
<li>rows：MySQL认为必须要执行查询的行数，在innodb引擎的表中，是一个估计值，可能并不总是准确的。</li>
<li>filtered：表示返回结果的行数占需读取行数的百分比， filtered 的值越大越好。</li>
</ul>
<blockquote>
<p><strong>type列解释</strong>（性能从优到劣）：</p>
<ul>
<li><strong>const</strong>：唯一索引或主键查询</li>
<li>eq_ref：多表关联使用主键或唯一索引</li>
<li><strong>ref</strong>：普通索引查询</li>
<li>range：索引范围扫描</li>
<li>index：全索引扫描</li>
<li>ALL：全表扫描</li>
</ul>
<p>key列：实际使用的索引<br>rows列：预估扫描行数</p>
</blockquote>
<h5 id="4-1-执行计划：id"><a href="#4-1-执行计划：id" class="headerlink" title="4.1 执行计划：id"></a>4.1 执行计划：id</h5><p><img src="/images/1755001985806.png" alt="1755001985806"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 只有一个 id</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> tno <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 两个相等的id</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher t, c_dept d <span class="keyword">where</span> t.dno <span class="operator">=</span> d.dno;</span><br><span class="line"><span class="comment">-- 两个不等的id</span></span><br><span class="line">explain <span class="keyword">SELECT</span> tname, sal <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> sal<span class="operator">&gt;</span> (<span class="keyword">SELECT</span> sal <span class="keyword">FROM</span> c_teacher <span class="keyword">WHERE</span> tname<span class="operator">=</span><span class="string">&#x27;秦占豪&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/images/1755002306545.png" alt="1755002306545"></p>
<h5 id="4-2-执行计划：select-type"><a href="#4-2-执行计划：select-type" class="headerlink" title="4.2 执行计划：select_type"></a>4.2 执行计划：select_type</h5><ul>
<li>SIMPLE：简单表，即不使用表连接或者子查询</li>
<li>PRIMARY：主查询，即外层的查询</li>
<li>UNION：UNION 中的第二个或者后面的查询语句</li>
<li>SUBQUERY：SELECT&#x2F;WHERE之后包含了子查询</li>
</ul>
<h5 id="4-3-执行计划：type"><a href="#4-3-执行计划：type" class="headerlink" title="4.3 执行计划：type"></a>4.3 执行计划：type</h5><p>表示连接类型，性能由<strong>好到差</strong>的连接类型为<strong>NULL</strong>、system、<strong>const</strong>、eq_ref、 <strong>ref</strong>、 range、 index、all </p>
<p> <code>const</code> → <strong>最优访问类型之一</strong>，<strong>表示通过</strong> <strong>主键 &#x2F; 唯一索引</strong> 找到<strong>唯一一行</strong>（如 <code>WHERE id = 1</code>，直接定位主键）。 </p>
<p><img src="/images/1755002792745.png" alt="1755002792745"></p>
<h4 id="5、索引使用"><a href="#5、索引使用" class="headerlink" title="5、索引使用"></a>5、索引使用</h4><h5 id="5-1-验证索引效率"><a href="#5-1-验证索引效率" class="headerlink" title="5.1 验证索引效率"></a>5.1 验证索引效率</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX index_name <span class="keyword">ON</span> table_name(<span class="keyword">column</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看某张表中的所有索引</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> tb_user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除表中指定索引</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX inde_name <span class="keyword">ON</span> table_name;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> table_name <span class="keyword">DROP</span> INDEX index_name,<span class="keyword">DROP</span> INDEX index_name... ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 未建立索引之前，查询数据，查看耗时</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone<span class="operator">=</span><span class="string">&#x27;13100900001&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 针对字段创建索引</span></span><br><span class="line"><span class="keyword">create</span> index idx_user_phone <span class="keyword">on</span> tb_user(phone);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次执行sql查看耗时</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone<span class="operator">=</span><span class="string">&#x27;13100900001&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250814193915579.png" alt="image-20250814193915579"></p>
<h5 id="5-2-最左前缀法则"><a href="#5-2-最左前缀法则" class="headerlink" title="5.2 最左前缀法则"></a>5.2 最左前缀法则</h5><p>如果索引使用了多列（联合索引），要遵守最左前缀法则。最左前缀法则指的是查询从索引的最左列开始，并且不跳过索引中的列。 如果跳过某一列，索引将部分失效(后面的字段索引失效)。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_teacher_gender_job_sal <span class="keyword">ON</span> c_teacher(gender,job,sal);</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> gender <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span> <span class="keyword">and</span> job <span class="operator">=</span> <span class="string">&#x27;讲师&#x27;</span> <span class="keyword">and</span> sal <span class="operator">=</span> <span class="number">29936.29</span>;</span><br></pre></td></tr></table></figure>

<p>最左字段存在，都走索引</p>
<blockquote>
<p>注意  key_len： 49 → 40 → 7</p>
<p>sal&#x3D;9， job &#x3D; 33， gender &#x3D; 7</p>
</blockquote>
<p><img src="/images/1755003339090.png" alt="1755003339090"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 最左在，中间的跳过，那么后面的不走索引</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> gender <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span>  <span class="keyword">and</span> sal <span class="operator">=</span> <span class="number">29936.29</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/1755003504451.png" alt="1755003504451"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 和查询顺序没有关系</span></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;讲师&#x27;</span> <span class="keyword">and</span> sal <span class="operator">=</span> <span class="number">29936.29</span> <span class="keyword">and</span> gender<span class="operator">=</span><span class="string">&#x27;女&#x27;</span>;</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;讲师&#x27;</span> <span class="keyword">and</span> gender <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span> <span class="keyword">and</span> sal <span class="operator">=</span> <span class="number">29936.29</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/1755003647061.png" alt="1755003647061"></p>
<h5 id="5-3-范围查询"><a href="#5-3-范围查询" class="headerlink" title="5.3 范围查询"></a>5.3 范围查询</h5><p><img src="/images/1755133993521.png" alt="1755133993521"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> gender<span class="operator">=</span><span class="string">&#x27;男&#x27;</span> <span class="keyword">and</span> job <span class="operator">&gt;</span><span class="string">&#x27;考试专员&#x27;</span> <span class="keyword">and</span> sal <span class="operator">=</span> <span class="number">29000</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250814200039469.png" alt="image-20250814200039469"></p>
<h5 id="5-4-索引列运算"><a href="#5-4-索引列运算" class="headerlink" title="5.4 索引列运算"></a>5.4 索引列运算</h5><p><img src="/images/1755134033965.png" alt="1755134033965"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX inx_teacher_tname <span class="keyword">ON</span> c_teacher(tname);</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> tname <span class="operator">=</span> <span class="string">&#x27;赵辉&#x27;</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> <span class="built_in">substring</span>(tname, <span class="number">1</span>, <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;赵&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250814200948107.png" alt="image-20250814200948107"></p>
<h5 id="5-5-字符串不加引号"><a href="#5-5-字符串不加引号" class="headerlink" title="5.5 字符串不加引号"></a>5.5 字符串不加引号</h5><p><img src="/images/1755134062568.png" alt="cl"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone <span class="operator">=</span> <span class="string">&#x27;13100000015&#x27;</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone <span class="operator">=</span> <span class="number">13100000015</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250814201207293.png" alt="image-20250814201207293"></p>
<h5 id="5-6-模糊查询"><a href="#5-6-模糊查询" class="headerlink" title="5.6 模糊查询"></a>5.6 模糊查询</h5><p><img src="/images/1755134090596.png" alt="1755134090596"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> tname <span class="keyword">like</span> <span class="string">&#x27;%赵&#x27;</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> tname <span class="keyword">like</span> <span class="string">&#x27;%赵%&#x27;</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> tname <span class="keyword">like</span> <span class="string">&#x27;赵%&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p><img src="/images/image-20250814201528525.png" alt="image-20250814201528525"></p>
<h5 id="5-7-or-连接条件"><a href="#5-7-or-连接条件" class="headerlink" title="5.7 or 连接条件"></a>5.7 or 连接条件</h5><p><img src="/images/1755134105281.png" alt="1755134105281"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> tno<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> tno<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> gender <span class="operator">=</span><span class="string">&#x27;男&#x27;</span>; </span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> c_teacher <span class="keyword">where</span> tno<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> gender <span class="operator">=</span><span class="string">&#x27;男&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250814202228236.png" alt="image-20250814202228236"></p>
<h5 id="5-8-数据分布影响"><a href="#5-8-数据分布影响" class="headerlink" title="5.8 数据分布影响"></a>5.8 数据分布影响</h5><p><img src="/images/1755134148515.png" alt="1755134148515"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 解析：   手机号默认  13100000001  ~  13100000100;</span></span><br><span class="line">wehre phone <span class="operator">&gt;</span> <span class="string">&#x27;13100000000&#x27;</span>;    <span class="comment">-- 走全表扫描 不走索引  大多数数据满足条件</span></span><br><span class="line">wehre phone <span class="operator">&gt;</span> <span class="string">&#x27;13100000050&#x27;</span>;    <span class="comment">-- 走全表扫描 不走索引  </span></span><br><span class="line">wehre phone <span class="operator">&gt;</span> <span class="string">&#x27;13100000051&#x27;</span>;    <span class="comment">-- 走索引             小部分数据满足条件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分布影响是指：走全表扫描 比走索引更快</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/1755152341717.png" alt="1755152341717"></p>
<h5 id="5-9-sql提示"><a href="#5-9-sql提示" class="headerlink" title="5.9 sql提示"></a>5.9 sql提示</h5><p><img src="/images/1755134566910.png" alt="1755134566910"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user use index(idx_user_phone) <span class="keyword">where</span> phone<span class="operator">=</span><span class="string">&#x27;13100000008&#x27;</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user ignore index(idx_user_phone) <span class="keyword">where</span> phone<span class="operator">=</span><span class="string">&#x27;13100000008&#x27;</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user force index(idx_user_phone) <span class="keyword">where</span> phone<span class="operator">=</span><span class="string">&#x27;13100000008&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p><img src="/images/image-20250814202833201.png" alt="image-20250814202833201"></p>
<p>原本不走索引的情况，也可以强制使用索引：</p>
<p><img src="/images/1755152886217.png" alt="1755152886217"></p>
<h5 id="5-10-覆盖索引"><a href="#5-10-覆盖索引" class="headerlink" title="5.10 覆盖索引"></a>5.10 覆盖索引</h5><p><img src="/images/1755134616609.png" alt="1755134616609"></p>
<p><img src="/images/1755134636818.png" alt="1755134636818"></p>
<p><strong>情况一：</strong> 聚集索引直接查找数据</p>
<p><img src="/images/1755134699839.png" alt="1755134699839"></p>
<p><strong>情况二：</strong> 辅助索引覆盖了查询的数据，不用回表查询</p>
<p><img src="/images/1755134709971.png" alt="1755134709971"></p>
<p><strong>情况三</strong>：辅助索引没有覆盖查询数据，需要回表查询</p>
<p><img src="/images/1755134763357.png" alt="1755134763357"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> id,username,email <span class="keyword">from</span> tb_user <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;vofnxyyx&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_username_email <span class="keyword">ON</span> tb_user(username,email);</span><br></pre></td></tr></table></figure>

<p>覆盖索引（索引覆盖了查询的字段）</p>
<p><strong>相同的SQL语句，使用索引覆盖的查询效率更高</strong></p>
<p><strong>原因</strong>：<strong>覆盖索引包含了要查询的字段，不会触发回表查询</strong></p>
<p><img src="/images/1755153746360.png" alt="1755153746360"></p>
<p><img src="/images/image-20250814203837462.png" alt="image-20250814203837462"></p>
<p><strong>思考：</strong></p>
<p><img src="/images/1755134949318.png" alt="1755134949318"></p>
<h5 id="5-11-前缀索引"><a href="#5-11-前缀索引" class="headerlink" title="5.11 前缀索引"></a>5.11 前缀索引</h5><p><img src="/images/1755134993191.png" alt="1755134993191"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="built_in">substring</span>(phone,<span class="number">1</span>,<span class="number">7</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user; <span class="comment">-- 0.0001</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="built_in">substring</span>(phone,<span class="number">1</span>,<span class="number">9</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user; <span class="comment">-- 0.0100</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="built_in">substring</span>(phone,<span class="number">1</span>,<span class="number">11</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user; <span class="comment">-- 1.0000</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/1755155923673.png" alt="1755155923673"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_user_email <span class="keyword">on</span> tb_user(email(<span class="number">11</span>)); <span class="comment">-- 根据 email 字段前11个字符创建前缀索引</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> email<span class="operator">=</span><span class="string">&#x27;13101999012@pp.com&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/1755156264182.png" alt="1755156264182"></p>
<p><strong>前缀索引查询流程：</strong></p>
<p><img src="/images/1755135160359.png" alt="1755135160359"></p>
<h5 id="5-12-单列索引和联合索引"><a href="#5-12-单列索引和联合索引" class="headerlink" title="5.12 单列索引和联合索引"></a>5.12 单列索引和联合索引</h5><p><img src="/images/1755135181178.png" alt="1755135181178"></p>
<p><strong>联合索引情况：</strong></p>
<p><img src="/images/1755135246644.png" alt="1755135246644"></p>
<h5 id="5-13-小结"><a href="#5-13-小结" class="headerlink" title="5.13 小结"></a>5.13 小结</h5><h4 id="6、索引设计原则"><a href="#6、索引设计原则" class="headerlink" title="6、索引设计原则"></a>6、索引设计原则</h4><blockquote>
<p>1.针对于数据量较大，且查询比较频繁的表建立索引。<br>2.针对于常作为查询条件(where)、排序(order by)、分组(group by)操作的字段建立索引。<br>3.尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高。<br>4.如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。<br>5.尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率。<br>6.要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，会影响增删改的效率。<br>7.如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询。</p>
</blockquote>
<h3 id="19-SQL优化"><a href="#19-SQL优化" class="headerlink" title="19-SQL优化"></a>19-SQL优化</h3><h4 id="1、插入优化"><a href="#1、插入优化" class="headerlink" title="1、插入优化"></a>1、插入优化</h4><p><img src="/images/1755135378346.png" alt="1755135378346"></p>
<p><img src="/images/1755135432347.png" alt="1755135432347"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="comment">--local-infile -u root -p1234</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> local_infile <span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;/root/sql1.log&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="string">&#x27;tb_user&#x27;</span> fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h5 id="插入数据时可以做哪些优化？"><a href="#插入数据时可以做哪些优化？" class="headerlink" title="插入数据时可以做哪些优化？"></a><strong>插入数据时可以做哪些优化？</strong></h5><blockquote>
<h6 id="批量插入数据"><a href="#批量插入数据" class="headerlink" title="批量插入数据"></a>批量插入数据</h6><ul>
<li><strong>单条INSERT语句插入多行数据</strong>：使用一条INSERT语句插入多条记录，减少与数据库的交互次数。</li>
<li><strong>分批次插入</strong>：将数据分成多个批次进行插入，每个批次使用事务提交，避免一次性插入过多数据导致性能问题。</li>
</ul>
<h6 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h6><ul>
<li><strong>手动控制事务</strong>：通过手动开启和提交事务，减少事务的开销。</li>
<li><strong>批量提交</strong>：在插入大量数据时，设置合适的批次大小，进行批量提交，减少事务提交的次数。</li>
</ul>
<h6 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h6><ul>
<li><strong>主键顺序插入</strong>：顺序插入主键可以减少页分裂，提高插入性能。</li>
</ul>
<h6 id="引擎选择"><a href="#引擎选择" class="headerlink" title="引擎选择"></a>引擎选择</h6><ul>
<li><strong>选择合适的存储引擎</strong>：在需要大量插入数据时，可以考虑使用MyISAM引擎，其插入性能优于InnoDB引擎。</li>
</ul>
<h6 id="使用LOAD-DATA-INFILE"><a href="#使用LOAD-DATA-INFILE" class="headerlink" title="使用LOAD DATA INFILE"></a>使用LOAD DATA INFILE</h6><ul>
<li><strong>从文件导入数据</strong>：使用<code>LOAD DATA INFILE</code>命令从文本文件导入数据，这是MySQL中最快的数据导入方式。</li>
</ul>
<h6 id="JDBC批量插入优化"><a href="#JDBC批量插入优化" class="headerlink" title="JDBC批量插入优化"></a>JDBC批量插入优化</h6><ul>
<li><strong>开启rewriteBatchedStatements参数</strong>：在JDBC连接中设置<code>rewriteBatchedStatements=true</code>，以优化批量插入性能。</li>
</ul>
<h6 id="MyBatis批量插入"><a href="#MyBatis批量插入" class="headerlink" title="MyBatis批量插入"></a>MyBatis批量插入</h6><ul>
<li><strong>使用MyBatis的批量插入功能</strong>：结合<code>ExecutorType.BATCH</code>和事务管理，提高插入效率。</li>
</ul>
<h6 id="调整MySQL配置"><a href="#调整MySQL配置" class="headerlink" title="调整MySQL配置"></a>调整MySQL配置</h6><ul>
<li><strong>增加max_allowed_packet</strong>：适当增加<code>max_allowed_packet</code>参数的值，避免因数据包过大导致的错误。</li>
</ul>
</blockquote>
<h4 id="2、主键优化"><a href="#2、主键优化" class="headerlink" title="2、主键优化"></a>2、主键优化</h4><p><strong>数据组织方式</strong></p>
<p><img src="/images/1755135478110.png" alt="1755135478110"></p>
<p><strong>页分裂</strong></p>
<p><img src="/images/1755135492433.png" alt="1755135492433"></p>
<p><img src="/images/1755135529438.png" alt="1755135529438"></p>
<p><strong>页合并：</strong></p>
<p><img src="/images/1755135556331.png" alt="1755135556331"></p>
<p><strong>主键设计原则：</strong></p>
<ul>
<li>满足业务需求的情况下，尽量降低主键的长度。</li>
<li>插入数据时，尽量选择顺序插入，选择使用AUTO_INCREMENT自增主键。</li>
<li>尽量不要使用 uuid做主键或者是其他自然主键，如身份证号。</li>
<li>业务操作时，避免对主键的修改。</li>
</ul>
<p><img src="/images/1755144845831.png" alt="1755144845831"></p>
<h4 id="3、order-by优化"><a href="#3、order-by优化" class="headerlink" title="3、order by优化"></a>3、order by优化</h4><p><img src="/images/1755144880437.png" alt="1755144880437"></p>
<p><img src="/images/1755144969440.png" alt="1755144969440"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> phone,age <span class="keyword">from</span> tb_user <span class="keyword">order</span> <span class="keyword">by</span> phone,age <span class="keyword">desc</span>;</span><br><span class="line"><span class="keyword">create</span> index idx_user_phone_age <span class="keyword">on</span> tb_user(phone,age <span class="keyword">desc</span>);</span><br></pre></td></tr></table></figure>



<p><img src="/images/1755161446524.png" alt="1755161446524"></p>
<p><img src="/images/1755161612493.png" alt="1755161612493"></p>
<p><img src="/images/1755144979847.png" alt="1755144979847"></p>
<p><img src="/images/1755161738637.png" alt="1755161738637"></p>
<h4 id="4、group-by-优化"><a href="#4、group-by-优化" class="headerlink" title="4、group by 优化"></a>4、group by 优化</h4><p><img src="/images/1755145114749.png" alt="1755145114749"></p>
<h4 id="5、limit-优化"><a href="#5、limit-优化" class="headerlink" title="5、limit 优化"></a>5、limit 优化<img src="/images/1755145164179.png" alt="1755145164179"></h4><h4 id="6、count-优化"><a href="#6、count-优化" class="headerlink" title="6、count 优化"></a>6、count 优化</h4><p><img src="/images/1755145203394.png" alt="1755145203394"></p>
<p><img src="/images/1755145328733.png" alt="1755145328733"></p>
<h4 id="7、update-优化"><a href="#7、update-优化" class="headerlink" title="7、update 优化"></a>7、update 优化</h4><p><img src="/images/image-20250818200527697.png" alt="image-20250818200527697"></p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><h5 id="一、插入优化（INSERT-Optimization）"><a href="#一、插入优化（INSERT-Optimization）" class="headerlink" title="一、插入优化（INSERT Optimization）"></a>一、插入优化（INSERT Optimization）</h5><p><strong>问题</strong>：批量插入慢、I&#x2F;O压力大<br><strong>优化方案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 批量插入代替单条插入（减少事务提交）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name, age) <span class="keyword">VALUES</span> </span><br><span class="line">  (<span class="string">&#x27;Alice&#x27;</span>, <span class="number">25</span>), </span><br><span class="line">  (<span class="string">&#x27;Bob&#x27;</span>, <span class="number">30</span>), </span><br><span class="line">  (<span class="string">&#x27;Charlie&#x27;</span>, <span class="number">28</span>);  <span class="comment">-- 一次插入500-1000条最佳</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 手动提交事务（避免自动提交开销）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> logs (content) <span class="keyword">VALUES</span> (...);</span><br><span class="line"><span class="keyword">INSERT INTO</span> logs (content) <span class="keyword">VALUES</span> (...);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. LOAD DATA 加速（比INSERT快20倍）</span></span><br><span class="line">LOAD DATA INFILE <span class="string">&#x27;/tmp/data.csv&#x27;</span> </span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> orders </span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 并行插入（MySQL 8.0+）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> orders DISABLE SECONDARY_ENGINES;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="comment">/*+ SET_VAR(innodb_thread_concurrency=16) */</span> <span class="keyword">INTO</span> orders ...;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="二、主键优化（Primary-Key-Optimization）"><a href="#二、主键优化（Primary-Key-Optimization）" class="headerlink" title="二、主键优化（Primary Key Optimization）"></a>二、主键优化（Primary Key Optimization）</h5><p><strong>问题</strong>：页分裂、写入热点<br><strong>优化方案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 自增INT主键（避免UUID随机写入导致页分裂）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- 顺序写入</span></span><br><span class="line">  uuid <span class="type">CHAR</span>(<span class="number">36</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 禁止更新主键（导致行移动）</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> id <span class="operator">=</span> <span class="number">1001</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">100</span>; <span class="comment">-- ❌ 禁止</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 主键长度压缩（InnoDB二级索引带主键）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> logs (</span><br><span class="line">  id <span class="type">BIGINT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>, </span><br><span class="line">  data <span class="type">BLOB</span></span><br><span class="line">) ROW_FORMAT<span class="operator">=</span>COMPRESSED;  <span class="comment">-- 压缩长主键</span></span><br></pre></td></tr></table></figure>

<hr>
<h5 id="三、ORDER-BY-优化"><a href="#三、ORDER-BY-优化" class="headerlink" title="三、ORDER BY 优化"></a>三、ORDER BY 优化</h5><p><strong>问题</strong>：Using filesort 性能瓶颈<br><strong>优化方案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 最左前缀索引覆盖</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> orders <span class="keyword">ADD</span> INDEX idx_status_amount (status, amount);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用覆盖索引避免回表</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> id, amount <span class="keyword">FROM</span> orders </span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;paid&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> amount;  <span class="comment">-- type: index, Extra: Using where</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 文件排序优化</span></span><br><span class="line"><span class="keyword">SET</span> max_length_for_sort_data <span class="operator">=</span> <span class="number">1024</span>;  <span class="comment">-- 控制排序缓冲区</span></span><br><span class="line"><span class="keyword">SET</span> sort_buffer_size <span class="operator">=</span> <span class="number">8</span><span class="operator">*</span><span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>;   <span class="comment">-- 增大排序内存</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 倒序索引（MySQL 8.0+）</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_amount_desc <span class="keyword">ON</span> orders (amount <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="四、GROUP-BY-优化"><a href="#四、GROUP-BY-优化" class="headerlink" title="四、GROUP BY 优化"></a>四、GROUP BY 优化</h5><p><strong>问题</strong>：Using temporary 临时表<br><strong>优化方案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 索引优化分组</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> sales <span class="keyword">ADD</span> INDEX idx_store_product (store_id, product_id);</span><br><span class="line"></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> store_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) </span><br><span class="line"><span class="keyword">FROM</span> sales <span class="keyword">GROUP</span> <span class="keyword">BY</span> store_id;  <span class="comment">-- type: range, key: idx_store_product</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 关闭隐式排序（MySQL 8.0+）</span></span><br><span class="line"><span class="keyword">SELECT</span> product_id, <span class="built_in">SUM</span>(quantity) </span><br><span class="line"><span class="keyword">FROM</span> sales <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">NULL</span>;  <span class="comment">-- 避免排序开销</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 大表分组优化（分段聚合）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(cnt) <span class="keyword">FROM</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> store_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> cnt</span><br><span class="line">  <span class="keyword">FROM</span> sales <span class="keyword">WHERE</span> store_id <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="number">100</span> </span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> store_id</span><br><span class="line">) tmp;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="五、LIMIT-优化"><a href="#五、LIMIT-优化" class="headerlink" title="五、LIMIT 优化"></a>五、LIMIT 优化</h5><p><strong>问题</strong>：大偏移量扫描全表<br><strong>优化方案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 游标分页（基于最后一条ID）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">1000000</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">10</span>;  <span class="comment">-- 避免 OFFSET</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 延迟关联（覆盖索引+JOIN）</span></span><br><span class="line"><span class="keyword">SELECT</span> o.<span class="operator">*</span> <span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> create_time LIMIT <span class="number">1000000</span>, <span class="number">10</span>) tmp</span><br><span class="line"><span class="keyword">ON</span> o.id <span class="operator">=</span> tmp.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 预计算分页（推荐页码限制）</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> orders </span><br><span class="line"><span class="keyword">WHERE</span> create_time <span class="keyword">BETWEEN</span> ? <span class="keyword">AND</span> ? </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> create_time LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="六、COUNT-优化"><a href="#六、COUNT-优化" class="headerlink" title="六、COUNT 优化"></a>六、COUNT 优化</h5><p><strong>问题</strong>：全表扫描慢<br><strong>优化方案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. COUNT(*) vs COUNT(col)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> orders;  <span class="comment">-- ✅ 使用星号（无NULL判断）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> orders;  <span class="comment">-- 等效COUNT(*)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 近似计数（允许误差）</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;orders&#x27;</span>;  <span class="comment">-- Rows 列（统计估算值）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 精确计数维护</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> counters (</span><br><span class="line">  table_name <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  cnt <span class="type">BIGINT</span> UNSIGNED <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 通过触发器/事务维护计数</span></span><br></pre></td></tr></table></figure>

<hr>
<h5 id="七、UPDATE-优化"><a href="#七、UPDATE-优化" class="headerlink" title="七、UPDATE 优化"></a>七、UPDATE 优化</h5><p><strong>问题</strong>：行锁膨胀、索引更新代价<br><strong>优化方案</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 索引条件更新（避免全表锁）</span></span><br><span class="line"><span class="keyword">UPDATE</span> orders <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;shipped&#x27;</span> </span><br><span class="line"><span class="keyword">WHERE</span> order_id <span class="operator">=</span> <span class="number">1001</span>;  <span class="comment">-- 主键条件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 分批更新（减少长事务）</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@rows</span><span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">WHILE <span class="variable">@rows</span> <span class="operator">&gt;</span> <span class="number">0</span> DO</span><br><span class="line">  <span class="keyword">UPDATE</span> orders <span class="keyword">SET</span> price <span class="operator">=</span> price<span class="operator">*</span><span class="number">1.05</span> </span><br><span class="line">  <span class="keyword">WHERE</span> create_date <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span> </span><br><span class="line">  LIMIT <span class="number">1000</span>;</span><br><span class="line">  <span class="keyword">SET</span> <span class="variable">@rows</span> <span class="operator">=</span> ROW_COUNT();</span><br><span class="line"><span class="keyword">END</span> WHILE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 避免更新索引列</span></span><br><span class="line"><span class="keyword">UPDATE</span> products <span class="keyword">SET</span> </span><br><span class="line">  view_count <span class="operator">=</span> view_count <span class="operator">+</span> <span class="number">1</span>,  <span class="comment">-- ✅ 非索引列</span></span><br><span class="line">  title <span class="operator">=</span> CONCAT(title, <span class="string">&#x27;!&#x27;</span>)    <span class="comment">-- ❌ 索引列（触发索引重建）</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">101</span>;</span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="mysql-管理"><a href="#mysql-管理" class="headerlink" title="mysql 管理"></a>mysql 管理</h3><h4 id="1、初始数据库"><a href="#1、初始数据库" class="headerlink" title="1、初始数据库"></a>1、初始数据库</h4><p>MySQL 安装完成后自带的 <code>information_schema</code>、<code>mysql</code>、<code>performance_schema</code>、<code>sys</code> 四个数据库各自承担核心系统功能，以下是详细解析：</p>
<h5 id="1-1-information-schema：元数据信息库"><a href="#1-1-information-schema：元数据信息库" class="headerlink" title="1.1 information_schema：元数据信息库"></a>1.1 information_schema：元数据信息库</h5><p><strong>核心作用</strong>：存储 MySQL 服务器中所有数据库对象的<strong>元数据</strong>（结构信息），是只读视图集合（无实际物理文件）。  </p>
<ul>
<li>关键内容：  <ul>
<li>数据库、表、列、索引、视图、存储过程、函数、触发器的定义；  </li>
<li>用户权限、表字符集、排序规则等。</li>
</ul>
</li>
<li>典型表：  <ul>
<li><code>SCHEMATA</code>：所有数据库的基本信息（名称、字符集等）；  </li>
<li><code>TABLES</code>：所有表的信息（表名、存储引擎、行数等）；  </li>
<li><code>COLUMNS</code>：表的列信息（数据类型、默认值、是否允许空等）；  </li>
<li><code>STATISTICS</code>：索引信息（索引名、类型、唯一性等）。</li>
</ul>
</li>
<li>使用场景：  <ul>
<li>开发工具自动生成数据库文档（如表结构导出）；  </li>
<li>程序动态获取表结构（如 ORM 框架自动建表）；  </li>
<li>替代 <code>SHOW TABLES</code>&#x2F;<code>SHOW COLUMNS</code> 等命令（更灵活，支持 SQL 过滤）。</li>
</ul>
</li>
<li>特点：  <ul>
<li>数据由 MySQL 自动维护，<strong>禁止手动修改</strong>；  </li>
<li>是 SQL 标准定义的“数据字典”（类似 Oracle 的 <code>ALL_TABLES</code>）。</li>
</ul>
</li>
</ul>
<h5 id="1-2-mysql：系统数据库"><a href="#1-2-mysql：系统数据库" class="headerlink" title="1.2 mysql：系统数据库"></a>1.2 mysql：系统数据库</h5><p><strong>核心作用</strong>：存储 MySQL 服务器的<strong>系统级配置与状态信息</strong>，是 MySQL 运行的基础。  </p>
<ul>
<li>关键内容：  <ul>
<li>用户账户与权限（<code>user</code> 表存储用户密码、权限；<code>db</code>&#x2F;<code>tables_priv</code> 表存储数据库&#x2F;表级权限）；  </li>
<li>系统变量（<code>global_variables</code> 表存储 <code>innodb_buffer_pool_size</code> 等配置）；  </li>
<li>存储过程、函数、事件（<code>proc</code>&#x2F;<code>event</code> 表）；  </li>
<li>InnoDB 系统表（<code>innodb_system</code> 存储表空间、索引元数据）；  </li>
<li>时区信息（<code>time_zone</code> 表）。</li>
</ul>
</li>
<li>使用场景：  <ul>
<li>管理用户权限（如 <code>CREATE USER</code>&#x2F;<code>GRANT</code> 会修改 <code>user</code>&#x2F;<code>db</code> 表）；  </li>
<li>调整系统参数（如 <code>SET GLOBAL innodb_buffer_pool_size=1G</code> 会更新 <code>global_variables</code>）；  </li>
<li>维护 InnoDB 表空间（如 <code>ALTER TABLE ... IMPORT TABLESPACE</code> 依赖 <code>innodb_system</code>）。</li>
</ul>
</li>
<li>特点：  <ul>
<li>严禁随意修改表结构（可能导致 MySQL 崩溃）；  </li>
<li>升级 MySQL 时需特别注意该数据库的兼容性。</li>
</ul>
</li>
</ul>
<h5 id="1-3-performance-schema：性能监控库"><a href="#1-3-performance-schema：性能监控库" class="headerlink" title="1.3 performance_schema：性能监控库"></a>1.3 performance_schema：性能监控库</h5><p><strong>核心作用</strong>：实时采集 MySQL 服务器的<strong>性能指标与运行时事件</strong>，用于诊断性能瓶颈。  </p>
<ul>
<li>关键内容：  <ul>
<li>SQL 语句执行统计（<code>events_statements_summary_by_digest</code> 记录 SQL 执行次数、耗时）；  </li>
<li>锁与事务信息（<code>metadata_locks</code> 记录元数据锁；<code>innodb_lock_waits</code> 记录 InnoDB 行锁等待）；  </li>
<li>等待事件（<code>wait_classes_global_by_avg_latency</code> 统计各类等待事件的平均延迟）；  </li>
<li>线程与连接（<code>threads</code>&#x2F;<code>sessions</code> 记录当前连接的状态）。</li>
</ul>
</li>
<li>使用场景：  <ul>
<li>定位慢查询（通过 <code>events_statements_summary_by_digest</code> 筛选高耗时 SQL）；  </li>
<li>诊断锁冲突（如 <code>SELECT * FROM performance_schema.metadata_locks WHERE locked_by != &#39;&#39;</code>）；  </li>
<li>分析资源消耗（如 <code>SELECT * FROM performance_schema.file_summary_by_instance</code> 查看 IO 消耗）。</li>
</ul>
</li>
<li>特点：  <ul>
<li>数据存储在<strong>内存</strong>中，服务器重启后丢失；  </li>
<li>开销极低（默认开启，对性能影响&lt;5%）；  </li>
<li>是 MySQL 5.5+ 引入的“内置性能侦探”。</li>
</ul>
</li>
</ul>
<h5 id="1-4-sys：简化性能诊断的工具库"><a href="#1-4-sys：简化性能诊断的工具库" class="headerlink" title="1.4 sys：简化性能诊断的工具库"></a>1.4 sys：简化性能诊断的工具库</h5><p><strong>核心作用</strong>：基于 <code>information_schema</code> 和 <code>performance_schema</code> 封装<strong>易用的视图与存储过程</strong>，降低性能分析门槛。  </p>
<ul>
<li>关键内容：  <ul>
<li>性能视图（<code>sys.schema_table_statistics</code> 显示表的行数、大小、索引效率；<code>sys.session</code> 显示当前会话的详细状态）；  </li>
<li>锁诊断（<code>sys.innodb_lock_waits</code> 整合锁等待信息，支持一键杀死阻塞事务）；  </li>
<li>存储过程（<code>sys.sql_kill_blocking_connection()</code> 终止阻塞连接；<code>sys.config()</code> 调整性能监控参数）；  </li>
<li>原始数据视图（带 <code>x$</code> 前缀的视图保留原始单位，如 <code>x$wait_classes_global_by_avg_latency</code>）。</li>
</ul>
</li>
<li>使用场景：  <ul>
<li>快速查看表统计信息（<code>SELECT * FROM sys.schema_table_statistics WHERE table_schema=&#39;your_db&#39;</code>）；  </li>
<li>分析 IO 消耗（<code>SELECT * FROM sys.io_global_by_file_by_bytes</code>）；  </li>
<li>一键处理锁阻塞（<code>CALL sys.sql_kill_blocking_connection(阻塞线程ID)</code>）。</li>
</ul>
</li>
<li>特点：  <ul>
<li>MySQL 5.7+ 默认存在（5.6 需手动安装）；  </li>
<li>完全依赖 <code>information_schema</code> 和 <code>performance_schema</code>，本身不存储数据；  </li>
<li>是 DBA 日常运维的“瑞士军刀”。</li>
</ul>
</li>
</ul>
<h5 id="1-5-小结：协作关系"><a href="#1-5-小结：协作关系" class="headerlink" title="1.5 小结：协作关系"></a>1.5 小结：协作关系</h5><table>
<thead>
<tr>
<th>数据库</th>
<th>定位</th>
<th>数据来源</th>
<th>典型用途</th>
</tr>
</thead>
<tbody><tr>
<td><code>information_schema</code></td>
<td>元数据“字典”</td>
<td>数据库对象定义</td>
<td>查结构、生成文档</td>
</tr>
<tr>
<td><code>mysql</code></td>
<td>系统配置中心</td>
<td>权限、变量、InnoDB元数据</td>
<td>用户管理、系统调优</td>
</tr>
<tr>
<td><code>performance_schema</code></td>
<td>性能监控“黑匣子”</td>
<td>运行时事件、锁、SQL统计</td>
<td>慢查询、锁冲突、资源消耗分析</td>
</tr>
<tr>
<td><code>sys</code></td>
<td>性能诊断“工具包”</td>
<td>基于前两者的视图封装</td>
<td>快速定位问题、一键运维</td>
</tr>
</tbody></table>
<p>通过这四个数据库的协作，MySQL 实现了**“结构管理→系统配置→性能监控→诊断优化”**的完整闭环。</p>
<h4 id="2、常用工具"><a href="#2、常用工具" class="headerlink" title="2、常用工具"></a>2、常用工具</h4><h5 id="举例说明常见的mysql管理工具，并说明作用"><a href="#举例说明常见的mysql管理工具，并说明作用" class="headerlink" title="举例说明常见的mysql管理工具，并说明作用"></a><strong>举例说明常见的mysql管理工具，并说明作用</strong></h5><p>mysql客户端、mysqladmin、mysqlbinlog、mysqlshow、mysqldump、mysqlimport  和 source</p>
<table>
<thead>
<tr>
<th align="center">工具</th>
<th align="center">主要场景</th>
</tr>
</thead>
<tbody><tr>
<td align="center">mysql</td>
<td align="center">日常数据库操作&#x2F;脚本执行</td>
</tr>
<tr>
<td align="center">mysqldump</td>
<td align="center">数据备份&#x2F;迁移</td>
</tr>
<tr>
<td align="center">mysqlbinlog</td>
<td align="center">数据恢复&#x2F;审计</td>
</tr>
<tr>
<td align="center">mysqladmin</td>
<td align="center">服务器状态监控&#x2F;管理</td>
</tr>
<tr>
<td align="center">mysqlshow</td>
<td align="center">快速查看数据库结构</td>
</tr>
<tr>
<td align="center">mysqlimport</td>
<td align="center">批量数据导入</td>
</tr>
<tr>
<td align="center">source</td>
<td align="center">恢复备份&#x2F;执行大型SQL脚本</td>
</tr>
</tbody></table>
<p>1.<strong>mysql</strong>（命令行客户端工具）</p>
<p><strong>作用</strong>：</p>
<ul>
<li>连接 MySQL 服务器并执行 SQL 命令</li>
<li>支持批处理脚本操作</li>
<li>远程连接管理数据库</li>
</ul>
<p>2.<strong>mysqladmin</strong>（管理客户端）</p>
<p><strong>作用</strong>：</p>
<ul>
<li>检查服务器状态和配置</li>
<li>创建&#x2F;删除数据库</li>
<li>刷新权限&#x2F;日志</li>
<li>关闭服务器</li>
</ul>
<p>3.<strong>mysqlbinlog</strong>（二进制日志工具）</p>
<p><strong>作用</strong>：</p>
<ul>
<li>解析二进制日志文件（binlog）</li>
<li>数据恢复和审计</li>
<li>主从复制故障排查</li>
</ul>
<p>4.<strong>mysqlshow</strong>（元数据查看工具）</p>
<p><strong>作用</strong>：</p>
<ul>
<li>显示数据库&#x2F;表&#x2F;列结构</li>
<li>统计数据库对象信息</li>
<li>快速查看表状态</li>
</ul>
<p>5.<strong>mysqldump</strong>（数据备份工具）</p>
<p><strong>作用</strong>：</p>
<ul>
<li>逻辑备份数据库</li>
<li>生成 SQL 格式转储文件</li>
<li>支持全库&#x2F;单库&#x2F;单表备份</li>
</ul>
<p>6.<strong>mysqlimport</strong>（数据导入工具）</p>
<p><strong>作用</strong>：</p>
<ul>
<li>批量导入文本文件数据</li>
<li>高效加载分隔符格式数据</li>
<li>与 mysqldump 的 <code>-T</code> 选项配对使用</li>
</ul>
<p>7.<strong>source</strong>（SQL 脚本执行命令）</p>
<p><strong>作用</strong>：</p>
<ul>
<li>在 MySQL 客户端内执行 SQL 脚本</li>
<li>恢复 mysqldump 备份</li>
<li>批量执行 DDL&#x2F;DML 语句</li>
</ul>
<h5 id="2-1-mysql客户端"><a href="#2-1-mysql客户端" class="headerlink" title="2.1 mysql客户端"></a><strong>2.1 mysql客户端</strong></h5><p>mysql<br>该 mysql不是指 mysql服务，而是指 mysql的<strong>客户端工具</strong>。<br><strong>语法</strong>：<br>mysql [options]database]<br>选项：<br><strong>-u</strong>,–user&#x3D; name #指定用户名<br>-p,–password&#x3D; name #指定密码<br>-h,–host&#x3D; name #指定服务器IP或域名<br>-p,–port&#x3D; port #指定连接端口<br>-e,–execute&#x3D; name #执行SQL语句并退出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql- uroot -p1234 db01 -e <span class="string">&quot; select * from stu&quot;</span>;</span><br></pre></td></tr></table></figure>



<p><img src="/images/image-20250818152711720.png" alt="image-20250818152711720"></p>
<p>本地目录下运行cmd（A:\Programs\Mysql\mysql8\mysql-8.0.23-winx64\bin）</p>
<p><strong>-h参数</strong>：指定服务器 ip地址</p>
<p>当前登录的是 192.168.242.129 服务器的 mysql 数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -h192.168.242.129 -uroot -p1234 <span class="comment">#连接虚拟机的数据库</span></span><br><span class="line"></span><br><span class="line">mysql -uroot -proot <span class="comment">#登录本地mysql</span></span><br></pre></td></tr></table></figure>



<p><strong>-e</strong> 可以在mysql客户端执行SQL语句，不用连接到mysql数据库再执行，对于一些批处理脚本，这种方式尤其方便</p>
<p><strong>-e参数</strong>：执行sql语句，并退出</p>
<p>登录数据库，执行指定库下的 sql语句，执行完成后输出结果，并退出数据库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -proot <span class="built_in">test</span> -e <span class="string">&quot;select * from c_dept&quot;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h192.168.242.129 -uroot -p1234 sc0701 -e <span class="string">&quot;select * from c_teacher where tno=1&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818153507772.png" alt="image-20250818153507772"></p>
<h5 id="2-2-mysqladmin"><a href="#2-2-mysqladmin" class="headerlink" title="2.2 mysqladmin"></a><strong>2.2 mysqladmin</strong></h5><p>mysqladmin是一个执行管理操作的客户端程序。可以用它来检查服务器的配置和当前状态，创建并删除数据库等。</p>
<p>通过帮助文档查看选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818154327485.png" alt="image-20250818154327485"></p>
<p>查看当前数据库的版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -p1234 version</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818154434501.png" alt="image-20250818154434501"></p>
<p>删除指定的数据库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -p1234 drop <span class="string">&quot;db&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818154641382.png" alt="image-20250818154641382"></p>
<h5 id="2-3-mysqlbinlog"><a href="#2-3-mysqlbinlog" class="headerlink" title="2.3 mysqlbinlog"></a><strong>2.3 mysqlbinlog</strong></h5><p>由于服务器生成的二进制日志文件以二进制格式保存，所以如果想要检查这些文本的文本格式，就会使用到mysqlbinlog<strong>日志管理工具</strong>。</p>
<p><strong>语法</strong>：<br>	mysqlbinlog[ options] log-files1 log-files2…</p>
<p><strong>选项</strong>：<br><strong>-d</strong>, –database&#x3D; name 	指定数据库名称，只列出指定的数据库相关操作。<br><strong>-o</strong>, –offset&#x3D;# 	忽略掉日志中的前n行命令。<br><strong>-r</strong>, –result-file&#x3D; name 	将输出的文本格式日志输出到指定文件。<br><strong>-s</strong>, –short-form 	显示简单格式，省略掉一些信息。<br>– start-datatime&#x3D;date1 –stop-datatime&#x3D; date2 	指定日期间隔内的所有日志。<br>– start-position&#x3D;pos1 –stop-position&#x3D;pos2 	指定位置间隔内的所有日志。</p>
<p>显示MySQL服务器的系统变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -proot variables</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818192926942.png" alt="image-20250818192926942"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /var/lib/mysql <span class="comment">#查看binlog日志文件在哪里</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818193027447.png" alt="image-20250818193027447"></p>
<p>查看指定的binlog日志文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog /var/lib/mysql/binlog.000005</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818155607927.png" alt="image-20250818155607927"></p>
<p><strong>-d参数</strong>：查看指定的数据库日志：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog -d sc0701 /var/lib/mysql/binlog.000005</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818193110759.png" alt="image-20250818193110759"></p>
<h5 id="2-4-mysqlshow"><a href="#2-4-mysqlshow" class="headerlink" title="2.4 mysqlshow"></a><strong>2.4 mysqlshow</strong></h5><p>mysqlshow客户端<strong>对象查找工具</strong>，用来很快地查找存在哪些数据库、数据库中的表、表中的列或者索引。<br><strong>语法</strong>：<br>	mysqlshow [options] [db_name] [table_name[col_name]]]<br>选项：<br><strong>–count</strong>	显示数据库及表的统计信息(数据库，表均可以不指定)</p>
<p><strong>i</strong>	显示指定数据库或者指定表的状态信息</p>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询每个数据库的表的数量及表中记录的数量</span></span><br><span class="line">mysqlshow -uroot -p2143 --count</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询test库中每个表中的字段数，及行数</span></span><br><span class="line">mysqlshow -uroot -p1234 <span class="built_in">test</span> --count</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询test库中book表的详细情况</span></span><br><span class="line">mysqlshow -uroot -p1234 <span class="built_in">test</span> --count</span><br></pre></td></tr></table></figure>



<p>统计 mysql中的库：有多少表，有多少行数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlshow -uroot -p1234 --count </span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818160604473.png" alt="image-20250818160604473"></p>
<p>统计指定数据库中有哪些表，表中有哪些字段，表中的数据行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlshow -uroot -p1234  sc0701 --count </span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818160744852.png" alt="image-20250818160744852"></p>
<p>统计指定表的信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlshow -uroot -p1234  sc0701  c_teacher --count </span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818160854942.png" alt="image-20250818160854942"></p>
<h5 id="2-5-mysqldump"><a href="#2-5-mysqldump" class="headerlink" title="2.5 mysqldump"></a><strong>2.5 mysqldump</strong></h5><p>mysqldump客户端工具用来<strong>备份数据库</strong>或在不同数据库之间进行<strong>数据迁移</strong>。备份内容包含创建表，及插入表的SQL语句。</p>
<p><strong>语法</strong>：<br>	mysqldump [options] db_name[tables]<br>	mysqldump [options]–database&#x2F;-B db1[db2 db3…]<br>	mysqldump [options]–all-databases&#x2F;-A</p>
<p><strong>连接选项</strong>：<br><strong>-u</strong>, –user&#x3D;name	指定用户名<br><strong>-p</strong>, –password[&#x3D; name]	指定密码<br><strong>-h</strong>, –host&#x3D;name	指定服务器ip或域名<br><strong>-P</strong>, –port&#x3D;#	指定连接端口(本地默认3306)</p>
<p><strong>输出选项：</strong><br>–add-drop-database	在每个数据库创建语句前加上drop database语句<br>–add-drop-table	在每个表创建语句前加上drop table语句，默认开启；不开启(–skip-add-drop-table)<br>-n, –no-create-db	不包含数据库的创建语句<br>-t, –no-create-info	不包含数据表的创建语句<br>-d –no-data	不包含数据<br><strong>-T</strong>, –tab&#x3D;name	自动生成两个文件：一个.sql文件，创建表结构的语句；一个.txt文件，数据文件</p>
<p><strong>数据库备份</strong>（备份指定数据库）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h192.168.242.129 -uroot -p1234 sc0701  &gt; A:\sc0701.sql</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818193149430.png" alt="image-20250818193149430"></p>
<p>备份指定库下的指定表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h192.168.242.129 -uroot -p1234 sc0701 c_teacher &gt; A:\c_teacher.sql</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818193210028.png" alt="image-20250818193210028"></p>
<p>查看允许导出的目录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;secure_file_priv&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818165225265.png" alt="image-20250818165225265"></p>
<p>将数据库s0701中的表和表中的数据导入到指定目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p1234 -T /var/lib/mysql-files/ sc0701</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /var/lib/mysql-files/</span><br></pre></td></tr></table></figure>

<p>每一张表会生成两个文件：sql文件备份结构.txt文件备份数据</p>
<p><img src="/images/image-20250818164844924.png" alt="image-20250818164844924"></p>
<p>查看备份目录下的sql文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/lib/mysql-files/c_dept.sql</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818165432837.png" alt="image-20250818165432837"></p>
<p><strong>恢复数据</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql --local-infile -uroot -p1234 <span class="comment">#登录时添加 --local-infile 表示允许加载本地文件</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">-- 开启 加载本地文件</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> local_infile<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 加载本地文件</span></span><br><span class="line"><span class="comment">-- terminated by &#x27;,&#x27;  指定数据的分隔符</span></span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;/root/tb_user_200w&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="string">&#x27;tb_user&#x27;</span> fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h5 id="2-6-mysqlimport-和-source"><a href="#2-6-mysqlimport-和-source" class="headerlink" title="2.6 mysqlimport  和 source"></a><strong>2.6 mysqlimport  和 source</strong></h5><p>mysqlimport是客户端数据导入工具，用来导入mysqldump加-T参数后导出的文本文件。<br><strong>语法</strong>：<br>mysqlimport[options] db name textfile1[textfile2…]<br>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport -uroot -p1234 <span class="built_in">test</span> /tmp/city.txt</span><br></pre></td></tr></table></figure>

<p>如果需要导入sql文件，可以使用mysql中的source指令：</p>
<p>语法：<br>source &#x2F; root&#x2F; xxxx. sql</p>
<p>先选择数据库sc0701,导入表结构：</p>
<p>注意：source时sql命令</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">-</span>files<span class="operator">/</span>c_teacher.sql</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818170330965.png" alt="image-20250818170330965"></p>
<p>再导入数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport -uroot -p1234 sc0701 /var/lib/mysql-files/c_teacher.txt</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20250818170558588.png" alt="image-20250818170558588"></p>
<h3 id="数据库锁"><a href="#数据库锁" class="headerlink" title="数据库锁"></a>数据库锁</h3><h4 id="1、锁概述"><a href="#1、锁概述" class="headerlink" title="1、锁概述"></a>1、锁概述</h4><h5 id="1-1-为什么需要锁"><a href="#1-1-为什么需要锁" class="headerlink" title="1.1 为什么需要锁"></a>1.1 为什么需要锁</h5><ul>
<li>多用户同时操作数据库时，可能出现 <strong>脏读、不可重复读、幻读</strong> 等问题。</li>
<li>示例：<ul>
<li>事务 A 修改数据，事务 B 读取未提交的脏数据（脏读）；</li>
<li>事务 A 更新期间，事务 B 重复读数据却得到不同结果（不可重复读）；</li>
<li>事务 A 插入数据，事务 B 查询时 “看到” 不存在的新数据（幻读）。</li>
</ul>
</li>
</ul>
<h5 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1.1 介绍"></a>1.1 介绍</h5><p>锁是计算机协调多个进程或线程并发访问某一资源的机制。在数据库中，除传统的计算资源（CPU 、RAM 、I&#x2F;O）的争用以外，数据也是  一种供许多用户共享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访 问性能的一个重要因素。从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。</p>
<p><strong>定义：</strong>  数据库锁是 <strong>数据库管理系统（DBMS）用于协调并发事务对共享资源访问的机制</strong>，通过 “锁资源” 实现 <strong>互斥或共享访问</strong>，保证数据一致性。 </p>
<h5 id="1-2-分类"><a href="#1-2-分类" class="headerlink" title="1.2 分类"></a>1.2 分类</h5><p>MySQL中的锁，按照锁的粒度分，分为以下三类：</p>
<ol>
<li><p>全局锁：锁定数据库中的所有表。</p>
</li>
<li><p>表级锁：每次操作锁住整张表。</p>
</li>
<li><p>行级锁：每次操作锁住对应的行数据</p>
</li>
</ol>
<p><strong>维度 1：按锁的粒度（锁定范围）</strong></p>
<table>
<thead>
<tr>
<th>锁类型</th>
<th>锁定范围</th>
<th>并发能力</th>
<th>开销</th>
<th>典型场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>表锁</strong></td>
<td>整个表</td>
<td>低</td>
<td>小</td>
<td>全表更新（如 <code>ALTER TABLE</code>）</td>
</tr>
<tr>
<td><strong>页锁</strong></td>
<td>数据页（磁盘块）</td>
<td>中</td>
<td>中</td>
<td>早期数据库（如 MySQL MyISAM）</td>
</tr>
<tr>
<td><strong>行锁</strong></td>
<td>单行记录（基于索引）</td>
<td>高</td>
<td>大</td>
<td>高频单行更新（如 InnoDB）</td>
</tr>
</tbody></table>
<p><strong>示例</strong>：</p>
<ul>
<li>表锁：<code>LOCK TABLES user WRITE;</code>（禁止其他事务读 &#x2F; 写）；</li>
<li>行锁：InnoDB 中 <code>UPDATE user SET balance=100 WHERE id=1;</code>（仅锁定 id&#x3D;1 的行）。</li>
</ul>
<p><strong>维度 2：按锁的类型（访问权限）</strong></p>
<p>（1）共享锁（Shared Lock，S 锁）</p>
<ul>
<li><strong>特性</strong>：允许多个事务同时加锁，用于 <strong>只读操作</strong>（如 <code>SELECT ... LOCK IN SHARE MODE</code>）；</li>
<li><strong>互斥规则</strong>：S 锁与 <strong>S 锁兼容</strong>（可共享），但与 <strong>排他锁（X 锁）互斥</strong>。</li>
</ul>
<p>（2）排他锁（Exclusive Lock，X 锁）</p>
<ul>
<li><strong>特性</strong>：禁止其他事务加锁，用于 <strong>修改操作</strong>（如 <code>INSERT/UPDATE/DELETE</code> 自动加 X 锁）；</li>
<li><strong>互斥规则</strong>：X 锁与 <strong>所有锁（S&#x2F;X）互斥</strong>（独占资源）。</li>
</ul>
<p>兼容矩阵：</p>
<table>
<thead>
<tr>
<th></th>
<th>S 锁（读）</th>
<th>X 锁（写）</th>
</tr>
</thead>
<tbody><tr>
<td><strong>S 锁</strong></td>
<td>兼容</td>
<td>冲突</td>
</tr>
<tr>
<td><strong>X 锁</strong></td>
<td>冲突</td>
<td>冲突</td>
</tr>
</tbody></table>
<p><strong>维度 3：按锁的模式（辅助管理）</strong></p>
<p>以 <strong>InnoDB</strong> 为例，引入 <strong>意向锁</strong> 快速判断表级锁与行级锁的冲突：</p>
<ul>
<li><strong>意向共享锁（IS 锁）</strong>：事务计划对行加 S 锁，先在表上加 IS 锁；</li>
<li><strong>意向排他锁（IX 锁）</strong>：事务计划对行加 X 锁，先在表上加 IX 锁。</li>
</ul>
<p><strong>作用</strong>：避免全表扫描判断行锁冲突（通过表级意向锁快速决策）。</p>
<p><strong>维度 4：按锁的算法（InnoDB 行锁细节）</strong></p>
<p>InnoDB 的行锁基于 <strong>索引</strong> 实现，细分三类算法（解决幻读问题）：</p>
<ol>
<li><strong>记录锁（Record Lock）</strong>：锁定 <strong>具体行记录</strong>（如 <code>WHERE id=1</code>，锁定 id&#x3D;1 的行）；</li>
<li><strong>间隙锁（Gap Lock）</strong>：锁定 <strong>索引区间</strong>（如 <code>WHERE id BETWEEN 1 AND 5</code>，锁定 (1,5) 的间隙，防止插入新数据）；</li>
<li><strong>临键锁（Next-Key Lock）</strong>：<strong>记录锁 + 间隙锁</strong>（默认模式，如锁定 id&#x3D;5 及之前的间隙，解决幻读）。</li>
</ol>
<h4 id="2、全局锁"><a href="#2、全局锁" class="headerlink" title="2、全局锁"></a>2、全局锁</h4><h5 id="2-1-介绍"><a href="#2-1-介绍" class="headerlink" title="2.1 介绍"></a>2.1 介绍</h5><p>​    全局锁就是对整个数据库实例加锁，加锁后整个数据就处于只读状态，后续的DML的写语句，DDL语句，已经更新操作的事务提交语句都将被阻塞。</p>
<p><img src="/images/image-20250819195848933.png" alt="image-20250819195848933"></p>
<h5 id="2-2-演示"><a href="#2-2-演示" class="headerlink" title="2.2 演示"></a>2.2 演示</h5><p> <img src="/images/image-20250819195922862.png" alt="image-20250819195922862"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush tables <span class="keyword">with</span> read lock;</span><br></pre></td></tr></table></figure>

<p><img src="/images/1755571059767.png" alt="1755571059767"></p>
<p><img src="/images/1755571130848.png" alt="1755571130848"></p>
<p>使用 cmd 登录 mysql 演示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h192.168.242.129 -uroot -p1234</span><br></pre></td></tr></table></figure>

<p><img src="/images/1755329027254.png" alt="1755329027254"></p>
<p><img src="/images/1755329815827.png" alt="1755329815827"></p>
<p><img src="/images/1755329888098.png" alt="1755329888098"></p>
<h5 id="2-3-特点"><a href="#2-3-特点" class="headerlink" title="2.3 特点"></a>2.3 特点</h5><p>数据库中加全局锁，是一个比较重的操作，存在以下问题：<br>1.如果在主库上备份，那么在备份期间都不能执行更新，业务基本上就得停摆。<br>2.如果在从库上备份，那么在备份期间从库不能执行主库同步过来的二进制日志（binlog），会导致<strong>主从延迟</strong>。</p>
<p>在InnoDB引擎中，我们可以在备份时加上参数–single-transaction 参数来完成不加锁的一致性数据备份。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="comment">--single-transaction - uroot -proot itpan &gt; itpan.sql</span></span><br></pre></td></tr></table></figure>



<h5 id="2-4-小结"><a href="#2-4-小结" class="headerlink" title="2.4 小结"></a>2.4 小结</h5><h6 id="1、全局锁的作用"><a href="#1、全局锁的作用" class="headerlink" title="1、全局锁的作用"></a><strong>1、全局锁的作用</strong></h6><p>对整个数据库实例加锁，加锁后整个数据就处于只读状态，后续的DML的写语句，DDL语句，已经更新操作的事务提交语句都将被阻塞。</p>
<p><strong>作用本质</strong><br>通过 <code>FLUSH TABLES WITH READ LOCK</code> 命令冻结 <strong>整个数据库实例</strong>，进入全局只读状态。</p>
<p><strong>阻塞对象</strong><br>✅ 所有 <code>DML</code> 写操作：  </p>
<ul>
<li><code>INSERT</code>&#x2F;<code>UPDATE</code>&#x2F;<code>DELETE</code>  </li>
<li>带写操作的 <code>SELECT ... FOR UPDATE</code><br>✅ 所有 <code>DDL</code> 操作：  </li>
<li><code>CREATE</code>&#x2F;<code>ALTER</code>&#x2F;<code>DROP</code><br>✅ 未提交事务的提交请求：  </li>
<li>显式提交的 <code>COMMIT</code>  </li>
<li>隐式提交的 DDL 语句</li>
</ul>
<p><strong>核心场景</strong>  </p>
<ol>
<li><p><strong>数据备份</strong>  </p>
<ul>
<li>确保备份文件数据与元时间点一致（物理备份如 <code>mysqldump</code>）  </li>
<li>非事务引擎（如 MyISAM）的唯一安全备份方式</li>
</ul>
</li>
<li><p><strong>主从协调</strong>  </p>
<ul>
<li><p>精确获取 binlog 位置点：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FLUSH TABLES <span class="keyword">WITH</span> READ LOCK; <span class="comment">-- 锁库</span></span><br><span class="line"><span class="keyword">SHOW</span> MASTER STATUS;          <span class="comment">-- 记录 File/Position</span></span><br><span class="line">UNLOCK TABLES;               <span class="comment">-- 立即释放</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>高危维护</strong>  </p>
<ul>
<li>系统表修复（如 <code>mysql.user</code>）  </li>
<li>全局级字符集变更</li>
</ul>
</li>
</ol>
<h6 id="2、使用全局锁的弊端是什么？怎么解决"><a href="#2、使用全局锁的弊端是什么？怎么解决" class="headerlink" title="2、使用全局锁的弊端是什么？怎么解决"></a><strong>2、使用全局锁的弊端是什么？怎么解决</strong></h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在数据库上添加全局锁，那么在备份期间都不能执行更新操作，那么业务基本上就得停摆</span><br><span class="line"></span><br><span class="line">解决方式：</span><br><span class="line">使用主从复制， 在从库上添加全局锁，备份从库数据（）</span><br></pre></td></tr></table></figure>



<h4 id="3、表级锁"><a href="#3、表级锁" class="headerlink" title="3、表级锁"></a>3、表级锁</h4><h5 id="3-1-介绍"><a href="#3-1-介绍" class="headerlink" title="3.1 介绍"></a>3.1 介绍</h5><p>​    表级锁，每次操作锁住整张表。锁定粒度大，发生锁冲突的概率最高，并发度最低。应用在MySAM、InnoDB、DB等存储引擎中。</p>
<p>对于表级锁，主要分为以下三类：</p>
<ol>
<li><p>表锁</p>
</li>
<li><p>元数据锁（ meta data lock ，MDL）</p>
</li>
<li><p>意向锁</p>
</li>
</ol>
<h5 id="3-2-表锁"><a href="#3-2-表锁" class="headerlink" title="3.2 表锁"></a>3.2 表锁</h5><p><img src="/images/1755330057032.png" alt="1755330057032"></p>
<p><strong>读锁不会阻塞其他客户端的读，但是会阻塞写。写锁既会阻塞其他客户端的读，又会阻塞其他客户端的写。</strong></p>
<p>演示共享读锁</p>
<p><img src="/images/1755572574182.png" alt="1755572574182"></p>
<p><img src="/images/1755572638812.png" alt="1755572638812"></p>
<p>演示独占写锁</p>
<p><img src="/images/1755572805422.png" alt="1755572805422"></p>
<p><img src="/images/1755572840120.png" alt="1755572840120"></p>
<h5 id="3-3-元数据锁-meta-data-lock-MDL"><a href="#3-3-元数据锁-meta-data-lock-MDL" class="headerlink" title="3.3 元数据锁(meta data lock, MDL)"></a>3.3 元数据锁(meta data lock, MDL)</h5><p>MDL加锁过程是系统自动控制，无需显式使用，在访问一张表的时候会自动加上。</p>
<p>MDL锁<strong>主要作用</strong>是维护表元数据的一致性，在表上有活动事件的时候，不可以对元数据进行写入操作。为了避免DML与DL冲突，保证读写的正确性。</p>
<p>在MySQL5.5中引入了MDL，当对一张表进行<strong>增删改查</strong>的时候，加<strong>MDL读锁</strong>(<strong>共享</strong>)；当对表结构进行变更操作的时候，加<strong>MDL写锁(排他)</strong>。</p>
<p><img src="/images/1755330078069.png" alt="1755330078069"></p>
<p>分类：</p>
<ul>
<li>元数据（共享）读锁</li>
<li>元数据（共享）写锁</li>
<li>元数据排他锁</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">元数据共享读锁 和 元数据共享写锁是兼容的</span><br><span class="line">元数据共享读锁、元数据共享写锁 两者 和 元数据排他锁都是互斥的</span><br></pre></td></tr></table></figure>



<p>演示：</p>
<p><strong>共享读锁</strong>和<strong>共享写锁</strong>兼容</p>
<p><img src="/images/1755574108447.png" alt="1755574108447"></p>
<p><strong>共享写锁</strong>和排他锁也是<strong>互斥</strong>的</p>
<p><img src="/images/1755573595963.png" alt="1755573595963"></p>
<p><strong>共享读锁</strong> 和 <strong>排他锁</strong> <strong>互斥</strong></p>
<p><img src="/images/1755574426555.png" alt="1755574426555"></p>
<p>查看元数据锁</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_type, object_schema, object_name,lock_duration <span class="keyword">from</span> performance_schema.metadata_locks;</span><br></pre></td></tr></table></figure>



<p><strong>元数据锁（MDL）的作用</strong></p>
<p>MySQL 的 <strong>元数据锁</strong> 用于保护 <strong>表结构（元数据）</strong> 不被并发修改，确保以下场景的一致性：</p>
<ul>
<li>当事务查询表数据时，防止其他事务同时执行 <code>ALTER TABLE</code> 修改表结构；</li>
<li>保护列统计信息（用于优化器生成执行计划）不被并发更新。</li>
</ul>
<p><strong>字段解析</strong></p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>object_type</code></td>
<td>锁保护的<strong>对象类型</strong>（如 <code>TABLE</code> 表、<code>SCHEMA</code> 数据库、<code>COLUMN STATISTICS</code> 列统计）</td>
</tr>
<tr>
<td><code>object_schema</code></td>
<td>对象所属的<strong>数据库</strong>（此处均为 <code>performance_schema</code>，MySQL 的性能监控数据库）</td>
</tr>
<tr>
<td><code>object_name</code></td>
<td>具体的<strong>对象名称</strong>（如表名、统计信息关联的表名；<code>SCHEMA</code> 类型无具体对象，故为 <code>NULL</code>）</td>
</tr>
<tr>
<td><code>lock_duration</code></td>
<td>锁的<strong>持续时间</strong>： - <code>TRANSACTION</code>：锁在<strong>事务周期</strong>内保持（事务提交 &#x2F; 回滚后释放）； - <code>STATEMENT</code>：锁在<strong>语句执行周期</strong>内保持（语句结束后释放）。</td>
</tr>
</tbody></table>
<p><img src="/images/1755330615820.png" alt="1755330615820"></p>
<h5 id="3-4-意向锁"><a href="#3-4-意向锁" class="headerlink" title="3.4 意向锁"></a>3.4 意向锁</h5><p>​    为了避免DML在执行时，加的行锁与表锁的冲突，在InnoDB中引入了意向锁，使得表锁不用检查每行数据是否加锁，使用意向锁来减少表锁的检查。</p>
<p><img src="/images/1755330737852.png" alt="1755330737852"></p>
<p>1**.意向共享锁(IS)**：由语句select…<code>lock in share mode</code>添加。<br>2.<strong>意向排他锁(IX)</strong>：由<code>insert</code>、<code>update</code>、<code>delete</code>、select…for update添加。</p>
<p><img src="/images/1755330761657.png" alt="1755330761657"></p>
<p><img src="/images/1755330802354.png" alt="1755330802354"></p>
<p>1.<strong>意向共享锁(IS)</strong>：与表锁共享锁(read)兼容，与表锁排它锁(write)互斥。<br>2.<strong>意向排他锁(IX)</strong>：与表锁共享锁(read)及排它锁(write)都互斥。意向锁之间不会互斥。</p>
<p>可以通过以下 sql，查看意向锁及行锁的加锁情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_schema, object_name, index_name, lock_type, lock_mode, lock_data <span class="keyword">from</span> performance_schema.data_locks;</span><br></pre></td></tr></table></figure>



<p>演示 意向共享锁</p>
<p><img src="/images/1755584314798.png" alt="1755584314798"></p>
<p><img src="/images/1755584411988.png" alt="1755584411988"></p>
<p>演示意向排他锁</p>
<p><img src="/images/1755584969602.png" alt="1755584969602"></p>
<p><strong>意向锁的核心作用：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">为了避免 DML 在执行时，加的行锁与表锁冲突，在 InnoDB 引擎中引入了意向锁</span><br><span class="line">可以使表锁不用检查每行数据是否加锁，使用意向锁来减少表锁的检查</span><br></pre></td></tr></table></figure>



<h4 id="4、行级锁"><a href="#4、行级锁" class="headerlink" title="4、行级锁"></a>4、行级锁</h4><h5 id="4-1-介绍"><a href="#4-1-介绍" class="headerlink" title="4.1 介绍"></a>4.1 介绍</h5><p>行级锁，每次操作锁住对应的行数据。锁定粒度最小，发生锁冲突的概率最低，并发度应用。应用在InnoDB存储引擎中。</p>
<p>InnoDB的数据是基于锁行的，行锁是通过对索引上的索引项加锁来实现的，而不是对记录级的锁。</p>
<p>对于行级锁，主要分为以下三类：<br>1.<strong>行锁(Record Lock)</strong>：锁定索引记录间隙（不含该记录），确保索引记录间隙不被删除，防止其他事务在这个间隙进行 insert，产生幻读。在幻读高级别下支持。<br>2.<strong>间隙锁(Gap Lock)</strong>：锁定间隙和同级锁，同时锁住数据，并锁住数据前面的间隙。在InnoDB高级别下支持。</p>
<p>3.<strong>临键锁(Next-KeyLock)</strong>：行锁和间隙锁组合，同时锁住数据，并锁住数据前面的间隙Gap。在RR隔离级别下支持。</p>
<p><img src="/images/1755331040991.png" alt="1755331040991"></p>
<p>InnoDB实现了以下两种类型的行锁：<br>1.<strong>共享锁(S)</strong>：允许一个事务去读一行，阻止其他事务获得相同数据集的排它锁。<br>2.<strong>排他锁(X)</strong>：允许获取排他锁的事务更新数据，阻止其他事务获得相同数据集的共享锁和排他锁。</p>
<p><img src="/images/1755331052148.png" alt="1755331052148"></p>
<p><img src="/images/1755331061125.png" alt="1755331061125"></p>
<h5 id="4-2-演示"><a href="#4-2-演示" class="headerlink" title="4.2 演示"></a>4.2 演示</h5><p>默认情况下, InnoDB在<strong>REPEATABLE READ</strong>事务隔离级别运行, InnoDB使用next-key锁进行搜索和索引扫描，以<strong>防止幻读</strong>。</p>
<p>1.针对唯一索引进行检索时，对已存在的记录进行等值匹配时，将会自动优化为行锁。</p>
<p>2.InnoDB的行锁是针对于索引加的锁，不通过索引条件检索数据，那么InnoDB将对表中的所有记录加锁，此时就会<strong>升级为表锁</strong>。</p>
<p>可以通过以下 sql，查看意向锁及行锁的加锁情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_schema, object_name, index_name, lock_type, lock_mode, lock_data <span class="keyword">from</span> performance_schema.data_locks;</span><br></pre></td></tr></table></figure>



<p>演示行共享锁</p>
<p><img src="/images/1755586016264.png" alt="1755586016264"></p>
<p><img src="/images/1755586248490.png" alt="1755586248490"></p>
<p>演示 行排他锁</p>
<p><img src="/images/1755586801507.png" alt="1755586801507"></p>
<p><strong>非索引键添加行锁会升级为表锁：</strong></p>
<p><img src="/images/1755587172905.png" alt="1755587172905"></p>
<p><img src="/images/1755587256525.png" alt="1755587256525"></p>
<p><img src="/images/1755587502519.png" alt="1755587502519"></p>
<p><strong>间隙锁&#x2F;临键锁-演示</strong><br>默认情况下, InnoDB在REPEATABLE READ事务隔离级别运行, InnoDB使用next-key锁进行搜索和索引扫描，以<strong>防止幻读</strong>。<br>1.索引上的等值查询（唯一索引），给不存在的记录加锁时，优化为间隙锁。<br>2.索引上的等值查询（普通索引），向右遍历时最后一个值不满足查询需求时，next-keylock退化为间隙锁。<br>3.索引上的范围查询（唯一索引）–会访问到不满足条件的第一个值为止。</p>
<p><img src="/images/1755331210247.png" alt="1755331210247"></p>
<p>​    <strong>注意：间隙锁唯一目的是防止其他事务插入间隙。间隙锁可以共存，一个事务采用的间隙锁不会阻止另一个事务在同一间隙上采用间隙锁。</strong></p>
<p><img src="/images/1755588004998.png" alt="1755588004998"></p>
<p><img src="/images/1755588100876.png" alt="1755588100876"></p>
<h4 id="6、锁分类小结"><a href="#6、锁分类小结" class="headerlink" title="6、锁分类小结"></a>6、锁分类小结</h4><ul>
<li>全局锁：<code>锁住数据库示例，一般用于数据备份</code></li>
<li>表级锁：锁住表的<ul>
<li>表锁<ul>
<li>表共享读锁：<code>都可以读，都不可以写</code></li>
<li>表独占写锁：<code>当前客户端可以写，可以读；其它客户端不能读，不能写</code></li>
</ul>
</li>
<li>元数据锁（自动添加）<ul>
<li>元数据共享读锁：</li>
<li>元数据共享写锁：</li>
<li>元数据排他锁：（alter 语句添加元数据排他锁，和其它两个元数据共享锁互斥）</li>
</ul>
</li>
</ul>
</li>
<li>行级锁<ul>
<li>行锁<ul>
<li>共享锁</li>
<li>排他锁</li>
</ul>
</li>
<li>间隙锁</li>
<li>临键锁</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://ningxiu2978.github.io">NINGXIU</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://ningxiu2978.github.io/2025/09/18/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E6%80%BB)/">https://ningxiu2978.github.io/2025/09/18/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E6%80%BB)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://ningxiu2978.github.io" target="_blank">NINGXIU's 学习博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/09/18/Oracle%E7%AC%94%E8%AE%B0(%E6%80%BB)/" title="Oracle笔记(总)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Oracle笔记(总)</div></div><div class="info-2"><div class="info-item-1">数据库介绍1、数据库介绍1.1 数据库英文：Database 简单的说，数据库就是一个存放数据的仓库，在日常工作中，常常需要把相关的数据放进这样的仓库，并根据管理的需要进行相应处理。 1.2 数据库规范数据库中的数据都有一定规律结构，相同类型的数据放在一起，不同类型的数据之间相互隔离 数据库由统一的规则来读写：由SQL语言专门来读写数据库，一般都是由程序来读写数据库内容 1.3 常用数据库常用的数据库有：DB2、Oracle、Mysql、SQL server、SQLite 1.4 数据库分类根据存储模型可以将数据库划分为【关系型数据库】和【非关系型数据库】 关系型数据库：是建立在关系模型基础上的数据库，简单来说，关系模型指的就是二维表格模型，而一个关系型数据库就是由二维表及其之间的联系所组成的一个数据组织。 标准数据查询语言SQL就是一种基于关系型数据库的语言，这种语言执行对关系型数据库中数据的检索和操作 什么是二维表：有行有列的表格，例如 Excel 关系型数据库（表与表之间有关系：体现为主外键）    分类 产品 特点    小型 access、foxbase 负载量小，用户...</div></div></div></a><a class="pagination-related" href="/2025/09/18/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(%E6%80%BB)/" title="Linux学习笔记(总)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Linux学习笔记(总)</div></div><div class="info-2"><div class="info-item-1">一. Linux命令基础到进阶第一章 命令入门1、Linux的目录结构  /，根目录是最顶级的目录了 Linux只有一个顶级目录：/ 路径描述的层次关系同样适用/来表示 &#x2F;home&#x2F;itpan&#x2F;a.txt，表示根目录下的home目录内有itpan目录，内有a.txt  演示home家目录  12345678su shucd /lscd /homelscd shullls  常用的目录功能：   HOME目录每一个用户在Linux系统中都有自己的专属工作目录，称之为HOME目录。  普通用户的HOME目录，默认在：/home/用户名  root用户的HOME目录，在：/root   FinalShell登陆终端后，默认的工作目录就是用户的HOME目录 2、linux 命令基础格式无论是什么命令，在linux 中，命令有通用的格式 1command  [-选项] [参数]  ## []表示可选   command： 表示命令，例如 ls、cd… -选项： 可选的，命令的一些选项，可以通过选项控制命令的行为细节 参数：可选，命令的参数，多数用于命令指向的目...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/09/18/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9D%A2%E8%AF%95%E9%A2%98/" title="MySQL面试题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-18</div><div class="info-item-2">MySQL面试题</div></div><div class="info-2"><div class="info-item-1">07281.数据库的分类有哪些？（谈谈你知道的数据库？）分为关系型数据库(RDBMS)、非关系型数据库(NoSQL) 关系型数据库(RDBMS)，是建立在关系模型基础上，由多张相互连接的二维表组成的数据库。 关系型数据库数据之间的关系性强，查询同类信息快，存储的数据结构可以很复杂。  常见的关系型数据库：mysql、oracle、db2、sql server  非关系型数据库(NoSQL)：Not-Only SQL ，泛指非关系型数据库，是对关系型数据库的补充。 非关系型数据库数据之间可以没有关系，结构简单更容易扩展，在大量数据的情况下，读写性能优秀  常见的非关系型数据库：Redis、MongoDB  2.sql的分类？（分别是做什么的、关键字？）sql是操作数据库的一种语言 DDL数据定义语言、DML数据操作语言、DQL数据查询语言、DCL数据控制语言 DDL，操作数据库、表、列等，常用语句：CREATE、 ALTER、DROP DML，操作数据库中表里的数据；常用语句：INSERT、 UPDATE、 DELETE DQL，查询数据 常用语句：SELECT DCL，操作访问权...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">NINGXIU</div><div class="author-info-description">天生我材必有用，千金散尽还复来。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/NingXIU2978"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/NingXIU2978" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/georgelester10611@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">这是我的博客,欢迎各位大佬莅临！！！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88DataBase%EF%BC%89%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">数据库（DataBase）：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%88DataBase-Management-System%EF%BC%89%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">数据库管理系统（DataBase Management System）：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%EF%BC%88DataBase-System%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">数据库系统（DataBase System）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">数据库分类：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E7%AE%80%E8%BF%B0%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">SQL简述：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E7%9A%84%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">SQL的优点：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E7%9A%84%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="toc-number">3.2.</span> <span class="toc-text">SQL的分类：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">数据库的数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.1.</span> <span class="toc-text">1、数值类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.</span> <span class="toc-text">2、日期和时间类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.3.</span> <span class="toc-text">3、字符串类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.4.</span> <span class="toc-text">4、二进制类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81JSON-%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.5.</span> <span class="toc-text">5、JSON 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.6.</span> <span class="toc-text">6、空间数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8E%9F%E5%88%99"><span class="toc-number">4.7.</span> <span class="toc-text">7、选择数据类型的原则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text">数据库、数据表的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DDL-%E6%93%8D%E4%BD%9C"><span class="toc-number">5.1.</span> <span class="toc-text">DDL 操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81DDL-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.1.</span> <span class="toc-text">1、DDL 操作数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-1-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">1.1 查询数据库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-2-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">1.2 创建数据库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-3-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">1.3 删除数据库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-4-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.1.4.</span> <span class="toc-text">1.4 使用数据库</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81DDL%E6%93%8D%E4%BD%9C%E8%A1%A8"><span class="toc-number">5.1.2.</span> <span class="toc-text">2、DDL操作表</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BA%E8%A1%A8-create"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">2.1 创建表 create</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-2-%E4%BF%AE%E6%94%B9%E8%A1%A8-alter"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">2.2 修改表 alter</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-3-%E5%88%A0%E9%99%A4%E8%A1%A8%EF%BC%9A"><span class="toc-number">5.1.2.3.</span> <span class="toc-text">2.3 删除表：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DML-%E6%93%8D%E4%BD%9C"><span class="toc-number">5.2.</span> <span class="toc-text">DML 操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%EF%BC%9Ainsert"><span class="toc-number">5.2.1.</span> <span class="toc-text">1、添加数据：insert</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-1-%E7%BB%99%E6%8C%87%E5%AE%9A%E7%9A%84%E5%AD%97%E6%AE%B5%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%AF%AD%E6%B3%95%EF%BC%9A"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">1.1 给指定的字段添加数据，语法：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-2-%E7%BB%99%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%AF%AD%E6%B3%95%EF%BC%9A"><span class="toc-number">5.2.1.2.</span> <span class="toc-text">1.2 给所有字段添加数据，语法：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-3-%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">5.2.1.3.</span> <span class="toc-text">1.3 批量添加数据</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%EF%BC%9Aupdate"><span class="toc-number">5.2.2.</span> <span class="toc-text">2、更新数据：update</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%EF%BC%9Adelete"><span class="toc-number">5.2.3.</span> <span class="toc-text">3、删除数据：delete</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">DQL数据查询语言（基础）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E8%AF%AD%E6%B3%95%EF%BC%88%E7%BC%96%E5%86%99%E9%A1%BA%E5%BA%8F%EF%BC%9A%EF%BC%89%EF%BC%9A"><span class="toc-number">6.1.</span> <span class="toc-text">基础查询语句语法（编写顺序：）：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-1-%E5%8C%B9%E9%85%8D%E6%89%80%E6%9C%89%E8%AE%B0%E5%BD%95%EF%BC%8C%E5%BD%93%E6%95%B0%E6%8D%AE%E9%87%8F%E7%89%B9%E5%88%AB%E5%A4%A7%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BC%9A%E6%A3%80%E7%B4%A2%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%B8%8D%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.0.1.</span> <span class="toc-text">1.1  * 匹配所有记录，当数据量特别大的时候，会检索所有数据，不推荐使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-2%E6%A0%B9%E6%8D%AE%E6%8C%87%E5%AE%9A-%E4%B8%80%E5%88%97%E6%88%96%E8%80%85%E5%A4%9A%E5%88%97-%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.1.0.2.</span> <span class="toc-text">1.2根据指定 一列或者多列 查询,</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81AS-%E8%AE%BE%E7%BD%AE%E5%88%AB%E5%90%8D"><span class="toc-number">6.2.</span> <span class="toc-text">2、AS 设置别名</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#2-2-%E7%BB%99%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E5%8F%96%E5%88%AB%E5%90%8D"><span class="toc-number">6.2.0.1.</span> <span class="toc-text">2.2 给计算结果取别名</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81distinct-%E5%8E%BB%E9%87%8D"><span class="toc-number">6.3.</span> <span class="toc-text">3、distinct 去重</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E8%BF%90%E7%AE%97"><span class="toc-number">6.4.</span> <span class="toc-text">4、运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0"><span class="toc-number">6.5.</span> <span class="toc-text">5、连接函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81where-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.6.</span> <span class="toc-text">6、where 条件查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-%E9%80%BB%E8%BE%91%E6%93%8D%E4%BD%9C%E7%AC%A6-and-or"><span class="toc-number">6.6.1.</span> <span class="toc-text">6.2 逻辑操作符 and or</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-like%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.6.2.</span> <span class="toc-text">6.3 like模糊查询</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">6.7.</span> <span class="toc-text">7、聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-1%E7%BB%9F%E8%AE%A1%E8%AE%B0%E5%BD%95%E6%95%B0-count"><span class="toc-number">6.7.1.</span> <span class="toc-text">7.1统计记录数 count()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-2-%E6%B1%82%E6%9C%80%E5%A4%A7%E5%80%BC%E3%80%81%E6%9C%80%E5%B0%8F%E5%80%BC%E3%80%81%E6%B1%82%E5%92%8C%E3%80%81%E6%B1%82%E5%B9%B3%E5%9D%87%E5%80%BC"><span class="toc-number">6.7.2.</span> <span class="toc-text">7.2 求	最大值、最小值、求和、求平均值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2-group-by"><span class="toc-number">6.8.</span> <span class="toc-text">8、分组查询 group by</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E3%80%90%E9%9D%A2%E8%AF%95%E9%A2%98%E3%80%91-having-%E5%92%8C-where-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.8.1.</span> <span class="toc-text">【面试题】 having 和 where 的区别:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81%E6%8E%92%E5%BA%8F-order-by"><span class="toc-number">6.9.</span> <span class="toc-text">9、排序 order by</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10%E3%80%81limit%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.10.</span> <span class="toc-text">10、limit分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B0%E8%AF%AD%E6%B3%95%EF%BC%9Amysql-8-0-%E8%AF%AD%E6%B3%95"><span class="toc-number">6.10.0.1.</span> <span class="toc-text">新语法：mysql 8.0+ 语法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%9F%A5%E8%AF%A2%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-number">6.11.</span> <span class="toc-text">基础查询小结：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DCL%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80"><span class="toc-number">7.</span> <span class="toc-text">DCL数据控制语言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">7.1.</span> <span class="toc-text">1、用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-number">7.1.1.</span> <span class="toc-text">1.1 创建用户</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">7.1.2.</span> <span class="toc-text">1.2 修改用户密码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-number">7.1.3.</span> <span class="toc-text">1.3 删除用户</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">7.2.</span> <span class="toc-text">2、权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E6%8E%88%E6%9D%83"><span class="toc-number">7.2.1.</span> <span class="toc-text">2.1 授权</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E5%9B%9E%E6%94%B6%E6%9D%83%E9%99%90"><span class="toc-number">7.2.2.</span> <span class="toc-text">2.2 回收权限</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text">常用的函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="toc-number">8.1.</span> <span class="toc-text">分类：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-null-%E5%80%BC%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">8.2.</span> <span class="toc-text">1. null 值处理函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">8.3.</span> <span class="toc-text">2. 聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E5%B8%B8%E7%94%A8%E7%9A%845%E4%B8%AA%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%EF%BC%9Acount-max-min-sum-avg"><span class="toc-number">8.3.1.</span> <span class="toc-text">2.1 常用的5个聚合函数：count,max,min,sum,avg</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-group-concat"><span class="toc-number">8.3.2.</span> <span class="toc-text">2.2 group _concat()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="toc-number">8.4.</span> <span class="toc-text">3、数学函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-PI-%E8%BF%94%E5%9B%9Epi%E5%80%BC"><span class="toc-number">8.4.1.</span> <span class="toc-text">3.1 PI() 返回pi值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E5%90%91%E4%B8%8A%E5%8F%96%E6%95%B4ceil-ceiling"><span class="toc-number">8.4.2.</span> <span class="toc-text">3.2 向上取整	ceil()    ceiling()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-%E5%90%91%E4%B8%8B%E5%8F%96%E6%95%B4floor"><span class="toc-number">8.4.3.</span> <span class="toc-text">3.3 向下取整	floor()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-%E8%BF%94%E5%9B%9E%E6%9C%80%E5%A4%A7%E5%80%BCgreatest"><span class="toc-number">8.4.4.</span> <span class="toc-text">3.4 返回最大值	greatest()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-%E8%BF%94%E5%9B%9E%E6%9C%80%E5%B0%8F%E5%80%BCleast"><span class="toc-number">8.4.5.</span> <span class="toc-text">3.5 返回最小值	least()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-%E5%8F%96%E6%A8%A1%EF%BC%88%E5%8F%96%E4%BD%99%EF%BC%89"><span class="toc-number">8.4.6.</span> <span class="toc-text">3.6 取模（取余）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MOD-x-y-%E8%BF%94%E5%9B%9E-x-y-%E7%9A%84%E4%BD%99%E6%95%B0"><span class="toc-number">8.4.7.</span> <span class="toc-text">MOD(x, y)   返回 x &#x2F; y 的余数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-7-%E5%9B%9B%E8%88%8D%E4%BA%94%E5%85%A5round"><span class="toc-number">8.4.8.</span> <span class="toc-text">3.7 四舍五入	round()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-8-%E9%9A%8F%E6%9C%BA%E6%95%B0rand-%E8%BF%94%E5%9B%9E-0-1-%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">8.4.9.</span> <span class="toc-text">3.8 随机数	rand()  返回 [0,1) 随机数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-9-%E6%88%AA%E6%96%AD%E6%95%B0%E5%AD%97"><span class="toc-number">8.4.10.</span> <span class="toc-text">3.9 截断数字</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">8.5.</span> <span class="toc-text">4、字符串函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-ASCII-%E8%BF%94%E5%9B%9E%E5%AD%97%E7%AC%A6%E7%9A%84-ASCII-%E7%A0%81"><span class="toc-number">8.5.1.</span> <span class="toc-text">4.1 ASCII() 返回字符的 ASCII 码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="toc-number">8.5.2.</span> <span class="toc-text">4.2 字符串拼接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3%E6%8F%92%E5%85%A5%E6%9B%BF%E6%8D%A2"><span class="toc-number">8.5.3.</span> <span class="toc-text">4.3插入替换</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-%E8%BD%AC%E5%B0%8F%E5%86%99%E5%AD%97%E7%AC%A6"><span class="toc-number">8.5.4.</span> <span class="toc-text">4.4 转小写字符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-%E8%BD%AC%E5%A4%A7%E5%86%99%E5%AD%97%E7%AC%A6"><span class="toc-number">8.5.5.</span> <span class="toc-text">4.4 转大写字符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-%E5%8E%BB%E9%A6%96%E5%B0%BE%E7%A9%BA%E6%A0%BCtrim"><span class="toc-number">8.5.6.</span> <span class="toc-text">4.5 去首尾空格	trim()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-7-%E5%8F%8D%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2reverse"><span class="toc-number">8.5.7.</span> <span class="toc-text">4.7 反转字符串	reverse()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-8%E8%BF%94%E5%9B%9E%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B7%A6%E8%BE%B9%E6%8C%87%E5%AE%9A%E4%B8%AA%E6%95%B0%E7%9A%84%E5%AD%97%E7%AC%A6left-str-len"><span class="toc-number">8.5.8.</span> <span class="toc-text">4.8返回字符串左边指定个数的字符	left(str, len)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-9-%E8%BF%94%E5%9B%9E%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E9%95%BF%E5%BA%A6length"><span class="toc-number">8.5.9.</span> <span class="toc-text">4.9 返回字符串的长度	length()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-10-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83strcmp-str1-str2"><span class="toc-number">8.5.10.</span> <span class="toc-text">4.10 字符串比较	strcmp(str1,str2)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-11-%E8%BF%94%E5%9B%9E%E5%AD%97%E7%AC%A6%E5%87%BA%E7%8E%B0%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%8D%E7%BD%AE"><span class="toc-number">8.5.11.</span> <span class="toc-text">4.11 返回字符出现的第一次位置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-12-%E6%88%AA%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">8.5.12.</span> <span class="toc-text">4.12 截取字符串</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-number">8.6.</span> <span class="toc-text">5、日期和时间函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-%E8%BF%94%E5%9B%9E%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4"><span class="toc-number">8.6.1.</span> <span class="toc-text">5.1 返回当前系统时间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%97%B6%E9%97%B4"><span class="toc-number">8.6.2.</span> <span class="toc-text">5.2 格式化时间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97"><span class="toc-number">8.6.3.</span> <span class="toc-text">5.3 日期和时间计算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-4-%E8%8E%B7%E5%8F%96%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E9%83%A8%E5%88%86"><span class="toc-number">8.6.4.</span> <span class="toc-text">5.4 获取日期和时间部分</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-5-%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E6%97%A5%E6%9C%9F%E6%9C%88%E4%BB%BD%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%A4%A9"><span class="toc-number">8.6.5.</span> <span class="toc-text">5.5 获取指定日期月份的最后一天</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E6%B5%81%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-number">8.7.</span> <span class="toc-text">6、流程函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-1-%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97"><span class="toc-number">8.7.1.</span> <span class="toc-text">6.1 三元运算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-null-%E5%80%BC%E5%A4%84%E7%90%86"><span class="toc-number">8.7.2.</span> <span class="toc-text">6.2 null 值处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-%E5%A4%9A%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF"><span class="toc-number">8.7.3.</span> <span class="toc-text">6.3 多条件分支</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4-%E7%AD%89%E5%80%BC%E5%88%A4%E6%96%AD"><span class="toc-number">8.7.4.</span> <span class="toc-text">6.4 等值判断</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%9F%A5%E8%AF%86%E7%82%B9%E5%B0%8F%E7%BB%93"><span class="toc-number">8.8.</span> <span class="toc-text">函数知识点小结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%BA%A6%E6%9D%9F"><span class="toc-number">9.</span> <span class="toc-text">数据库表约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F-PRIMARY-KEY"><span class="toc-number">9.1.</span> <span class="toc-text">1、主键约束(PRIMARY KEY)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%8C%87%E5%AE%9A%E4%B8%BB%E9%94%AE"><span class="toc-number">9.1.1.</span> <span class="toc-text">1.1 创建表的时候，指定主键</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2%E3%80%81%E9%80%9A%E8%BF%87-alter-%E8%AF%AD%E6%B3%95%E6%B7%BB%E5%8A%A0%E4%B8%BB%E9%94%AE"><span class="toc-number">9.1.2.</span> <span class="toc-text">1.2、通过 alter 语法添加主键</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3%E3%80%81%E5%88%A0%E9%99%A4%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">9.1.3.</span> <span class="toc-text">1.3、删除主键约束</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F-NOT-NULL"><span class="toc-number">9.2.</span> <span class="toc-text">2、非空约束(NOT NULL)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E5%BB%BA%E8%A1%A8%E7%9A%84%E6%97%B6%E5%80%99%E5%AE%9A%E4%B9%89%E5%AD%97%E6%AE%B5%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">9.2.1.</span> <span class="toc-text">2.1 建表的时候定义字段非空约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-alter%E8%AF%AD%E6%B3%95%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">9.2.2.</span> <span class="toc-text">2.2 alter语法修改字段非空约束</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E6%A3%80%E6%9F%A5%E7%BA%A6%E6%9D%9F-CHECK"><span class="toc-number">9.3.</span> <span class="toc-text">3、检查约束(CHECK)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E5%BB%BA%E8%A1%A8%E6%97%B6%E6%B7%BB%E5%8A%A0-%E6%A3%80%E6%9F%A5%E5%AD%97%E6%AE%B5-check"><span class="toc-number">9.3.1.</span> <span class="toc-text">3.1 建表时添加 检查字段 check</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E9%80%9A%E8%BF%87alter-%E8%AF%AD%E6%B3%95%E6%B7%BB%E5%8A%A0-%E6%A3%80%E6%9F%A5%E7%BA%A6%E6%9D%9F"><span class="toc-number">9.3.2.</span> <span class="toc-text">3.2 通过alter 语法添加 检查约束</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F%EF%BC%88UNIQUE%EF%BC%89"><span class="toc-number">9.4.</span> <span class="toc-text">4、唯一约束（UNIQUE）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-%E5%BB%BA%E8%A1%A8%E6%97%B6%E6%B7%BB%E5%8A%A0-%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">9.4.1.</span> <span class="toc-text">4.1 建表时添加 唯一约束</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-alter-%E8%AF%AD%E6%B3%95%E6%B7%BB%E5%8A%A0%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">9.4.2.</span> <span class="toc-text">4.2 alter 语法添加唯一约束</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E9%BB%98%E8%AE%A4%E5%80%BC%E7%BA%A6%E6%9D%9F-DEFAULT"><span class="toc-number">9.5.</span> <span class="toc-text">5、默认值约束(DEFAULT)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-%E5%BB%BA%E8%A1%A8%E6%97%B6-%E6%8C%87%E5%AE%9A%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">9.5.1.</span> <span class="toc-text">5.1 建表时 指定默认值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-alter-%E8%AF%AD%E6%B3%95%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">9.5.2.</span> <span class="toc-text">5.2 alter 语法设置默认值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F-FOREIGN-KEY"><span class="toc-number">9.6.</span> <span class="toc-text">6、外键约束(FOREIGN KEY)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">10.</span> <span class="toc-text">1、子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%9A%E8%BF%94%E5%9B%9E%E4%B8%80%E6%9D%A1%E7%BB%93%E6%9E%9C"><span class="toc-number">10.0.1.</span> <span class="toc-text">1.1单行子查询：返回一条结果</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%A4%9A%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="toc-number">10.0.2.</span> <span class="toc-text">1.2 多行子查询，查询返回多条记录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-EXISTS-%E5%92%8C-NOT-EXISTS"><span class="toc-number">10.0.3.</span> <span class="toc-text">1.3  EXISTS 和 NOT EXISTS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">11.</span> <span class="toc-text">2、多表连接查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">11.0.1.</span> <span class="toc-text">2.1 外连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">11.0.2.</span> <span class="toc-text">2.2 内连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">11.0.3.</span> <span class="toc-text">2.3  自连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-%E4%BA%A4%E5%8F%89%E9%93%BE%E6%8E%A5%EF%BC%88%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%EF%BC%89"><span class="toc-number">11.0.4.</span> <span class="toc-text">2.4 交叉链接（笛卡尔积）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">11.0.5.</span> <span class="toc-text">2.5 联合查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#08-%E8%A7%86%E5%9B%BE"><span class="toc-number">12.</span> <span class="toc-text">08-视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%A7%86%E5%9B%BE-view-%EF%BC%9A"><span class="toc-number">12.1.</span> <span class="toc-text">1.视图(view)：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="toc-number">12.2.</span> <span class="toc-text">2.作用：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE%E7%9A%84%E8%AF%AD%E6%B3%95%EF%BC%9A"><span class="toc-number">12.3.</span> <span class="toc-text">3.创建视图的语法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">12.4.</span> <span class="toc-text">1.基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">12.4.1.</span> <span class="toc-text">1.1 创建视图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">12.4.2.</span> <span class="toc-text">1.2 使用视图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%8F%AF%E4%BB%A5%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE%EF%BC%9A%E6%98%AF%E6%8C%87%E9%80%9A%E8%BF%87%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE%E7%9A%84%E5%AD%97%E6%AE%B5%EF%BC%8C%E4%BF%AE%E6%94%B9%E5%9F%BA%E8%A1%A8"><span class="toc-number">12.5.</span> <span class="toc-text">2. 可以更新视图：是指通过修改视图的字段，修改基表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="toc-number">12.6.</span> <span class="toc-text">3. 修改视图</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E8%A6%86%E7%9B%96%E5%8E%9F%E6%9D%A5%E7%9A%84%E8%A7%86%E5%9B%BE"><span class="toc-number">12.6.1.</span> <span class="toc-text">3.1 覆盖原来的视图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-ALTER%E4%BF%AE%E6%94%B9%E5%8E%9F%E6%9D%A5%E7%9A%84%E8%A7%86%E5%9B%BE"><span class="toc-number">12.6.2.</span> <span class="toc-text">3.2 ALTER修改原来的视图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE"><span class="toc-number">12.7.</span> <span class="toc-text">4. 删除视图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#09-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">13.</span> <span class="toc-text">09-存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="toc-number">13.1.</span> <span class="toc-text">存储过程：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9A"><span class="toc-number">13.2.</span> <span class="toc-text">(1)是什么：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-number">13.3.</span> <span class="toc-text">(2)优点：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%AF%AD%E6%B3%95%EF%BC%9A"><span class="toc-number">13.4.</span> <span class="toc-text">(3)语法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">13.5.</span> <span class="toc-text">1、存储过程的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%95%99%E5%B8%88%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">13.5.1.</span> <span class="toc-text">1.1创建一个查询所有教师的存储过程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">13.5.2.</span> <span class="toc-text">1.2 调用存储过程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">13.5.3.</span> <span class="toc-text">1.3 查看存储过程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-%E5%88%A0%E9%99%A4%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">13.5.4.</span> <span class="toc-text">1.4 删除存储过程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-mysql%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">13.6.</span> <span class="toc-text">2. mysql的变量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">13.6.1.</span> <span class="toc-text">2.1 系统变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F"><span class="toc-number">13.6.2.</span> <span class="toc-text">2.2 用户变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="toc-number">13.6.3.</span> <span class="toc-text">2.3 局部变量</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E6%9F%A5%E8%AF%A2%E6%95%99%E5%B8%88%E8%A1%A8%E6%80%BB%E5%B7%A5%E8%B5%84%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">13.6.3.1.</span> <span class="toc-text">声明一个查询教师表总工资的存储过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-IF%E8%AF%AD%E5%8F%A5"><span class="toc-number">13.7.</span> <span class="toc-text">3. IF语句</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E5%88%A4%E6%96%AD-1-%E5%8F%B7%E6%95%99%E5%B8%88%E7%9A%84%E8%96%AA%E8%B5%84%E7%AD%89%E7%BA%A7"><span class="toc-number">13.7.0.1.</span> <span class="toc-text">需求：判断 1 号教师的薪资等级</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%8F%82%E6%95%B0"><span class="toc-number">13.8.</span> <span class="toc-text">4. 参数</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E7%BB%99%E5%AE%9A%E4%BB%BB%E6%84%8F%E4%B8%80%E4%B8%AA%E6%95%99%E5%B8%88%E7%BC%96%E5%8F%B7%EF%BC%8C%E5%88%A4%E6%96%AD%E4%BB%96%E7%9A%84%E8%96%AA%E8%B5%84%E7%AD%89%E7%BA%A7"><span class="toc-number">13.8.0.1.</span> <span class="toc-text">需求：给定任意一个教师编号，判断他的薪资等级</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-CASE-WHEN-%E8%AF%AD%E6%B3%95"><span class="toc-number">13.9.</span> <span class="toc-text">5. CASE WHEN 语法</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E8%BE%93%E5%87%BA%E6%8C%87%E5%AE%9A-tno-%E6%95%99%E5%B8%88%E7%9A%84%E6%95%99%E5%B8%88%E7%9A%84%E9%83%A8%E9%97%A8%E5%90%8D%E7%A7%B0"><span class="toc-number">13.9.0.1.</span> <span class="toc-text">需求：输出指定 tno 教师的教师的部门名称</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E6%B6%A8%E8%96%AA10"><span class="toc-number">13.9.0.2.</span> <span class="toc-text">需求：涨薪10%</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%BE%AA%E7%8E%AF"><span class="toc-number">13.10.</span> <span class="toc-text">6. 循环</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-1-while%E5%BE%AA%E7%8E%AF"><span class="toc-number">13.10.1.</span> <span class="toc-text">6.1 while循环</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E4%BC%A0%E5%85%A5%E4%B8%80%E4%B8%AA%E5%80%BCn%EF%BC%8C%E6%B1%821-n%E4%B9%8B%E9%97%B4%E5%81%B6%E6%95%B0%E5%92%8C"><span class="toc-number">13.10.1.1.</span> <span class="toc-text">需求：传入一个值n，求1~n之间偶数和</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-repeat%E5%BE%AA%E7%8E%AF"><span class="toc-number">13.10.2.</span> <span class="toc-text">6.2 repeat循环</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E4%BC%A0%E5%85%A5%E4%B8%80%E4%B8%AA%E5%80%BCn%EF%BC%8C%E6%B1%821-n%E4%B9%8B%E9%97%B4%E5%A5%87%E6%95%B0%E5%92%8C"><span class="toc-number">13.10.2.1.</span> <span class="toc-text">需求：传入一个值n，求1~n之间奇数和</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-loop%E5%BE%AA%E7%8E%AF"><span class="toc-number">13.10.3.</span> <span class="toc-text">6.3 loop循环</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E8%8E%B7%E5%8F%96-i-%E7%9A%84%E5%80%BC"><span class="toc-number">13.10.3.1.</span> <span class="toc-text">需求：获取 i 的值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-i-%E7%9A%84%E5%80%BC"><span class="toc-number">13.10.3.2.</span> <span class="toc-text">获取 i 的值</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7"><span class="toc-number">14.</span> <span class="toc-text">10-异常捕获</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8%E5%B9%B6%E5%A4%84%E7%90%86"><span class="toc-number">14.1.</span> <span class="toc-text">捕获异常并处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E8%AF%AD%E6%B3%95"><span class="toc-number">14.2.</span> <span class="toc-text">1、语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E8%A7%A3%E6%9E%90%EF%BC%9A"><span class="toc-number">14.3.</span> <span class="toc-text">语法解析：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%9B%E5%87%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%EF%BC%9A-signal"><span class="toc-number">14.4.</span> <span class="toc-text">**抛出自定义异常：**signal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%A3%B0%E6%98%8E%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-number">14.5.</span> <span class="toc-text">2、异常处理声明的位置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E6%B8%B8%E6%A0%87"><span class="toc-number">15.</span> <span class="toc-text">11-游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">16.</span> <span class="toc-text">12-存储函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="toc-number">16.1.</span> <span class="toc-text">1、存储函数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%A0%B8%E5%BF%83%E7%89%B9%E7%82%B9%EF%BC%9A"><span class="toc-number">16.2.</span> <span class="toc-text">2、核心特点：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84"><span class="toc-number">16.3.</span> <span class="toc-text">3、语法结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E7%89%B9%E6%80%A7%E9%80%89%E9%A1%B9%E8%AF%B4%E6%98%8E%EF%BC%9A"><span class="toc-number">16.4.</span> <span class="toc-text">4、特性选项说明：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E7%A1%AE%E5%AE%9A%E6%80%A7%E5%87%BD%E6%95%B0-%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97"><span class="toc-number">16.4.1.</span> <span class="toc-text">1、确定性函数(科学计算)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E6%9F%A5%E8%AF%A2%E5%9E%8B%E5%87%BD%E6%95%B0-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE"><span class="toc-number">16.4.2.</span> <span class="toc-text">2、查询型函数(读取数据库数据)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E5%B8%A6%E6%B8%B8%E6%A0%87%E5%92%8C%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%9A%84%E5%A4%8D%E6%9D%82%E5%87%BD%E6%95%B0"><span class="toc-number">16.4.3.</span> <span class="toc-text">3、带游标和异常处理的复杂函数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%E5%92%8C%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">16.5.</span> <span class="toc-text">存储函数和存储过程的区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">17.</span> <span class="toc-text">13-触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E8%A7%A6%E5%8F%91%E5%99%A8%EF%BC%9A"><span class="toc-number">17.1.</span> <span class="toc-text">1、触发器：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%A0%B8%E5%BF%83%E8%A6%81%E7%B4%A0"><span class="toc-number">17.2.</span> <span class="toc-text">2、核心要素</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84-1"><span class="toc-number">17.3.</span> <span class="toc-text">3、语法结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81new-%E5%92%8C-old-%E5%85%B3%E9%94%AE%E5%AD%97%E8%AF%B4%E6%98%8E"><span class="toc-number">17.4.</span> <span class="toc-text">4、new 和 old 关键字说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81insert-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">17.5.</span> <span class="toc-text">1、insert 触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81update-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">17.6.</span> <span class="toc-text">2、update 触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81delete-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">17.7.</span> <span class="toc-text">3、delete 触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E6%9F%A5%E7%9C%8B%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">17.8.</span> <span class="toc-text">4、查看触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">17.8.1.</span> <span class="toc-text">（1）查看所有触发器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E4%BB%8E%E7%B3%BB%E7%BB%9F%E8%A1%A8%E4%B8%AD%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E8%A1%A8%E5%90%8D%E7%9A%84%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">17.8.2.</span> <span class="toc-text">（2）从系统表中查看指定表名的触发器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">17.9.</span> <span class="toc-text">5、删除触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E4%BC%98%E7%82%B9%EF%BC%88%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%89"><span class="toc-number">17.10.</span> <span class="toc-text">触发器的优点（使用场景）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">18.</span> <span class="toc-text">14-定时任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">18.1.</span> <span class="toc-text">1、定时任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">18.2.</span> <span class="toc-text">2、适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6%E5%99%A8%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">18.3.</span> <span class="toc-text">3、事件调度器的注意事项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E8%AF%AD%E6%B3%95"><span class="toc-number">18.4.</span> <span class="toc-text">4、语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8B%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="toc-number">18.5.</span> <span class="toc-text">1.查看事件调度器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%B8%B4%E6%97%B6%E5%90%AF%E7%94%A8%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6%E5%99%A8%EF%BC%8C%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%E4%BC%9A%E5%A4%B1%E6%95%88"><span class="toc-number">18.6.</span> <span class="toc-text">2、临时启用事件调度器，重启服务器后会失效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E4%B8%80%E6%AC%A1%E6%80%A7%E6%89%A7%E8%A1%8C%E4%BA%8B%E4%BB%B6"><span class="toc-number">18.7.</span> <span class="toc-text">3.创建一次性执行事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%91%A8%E6%9C%9F%E6%80%A7%E6%89%A7%E8%A1%8C%E4%BA%8B%E4%BB%B6"><span class="toc-number">18.8.</span> <span class="toc-text">4.周期性执行事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E7%AE%A1%E7%90%86%E5%AE%9A%E4%B9%89%E7%9A%84%E4%BA%8B%E4%BB%B6"><span class="toc-number">18.9.</span> <span class="toc-text">5.管理定义的事件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E4%BA%8B%E4%BB%B6"><span class="toc-number">18.9.1.</span> <span class="toc-text">查看所有事件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%BA%8B%E4%BB%B6"><span class="toc-number">18.9.2.</span> <span class="toc-text">修改事件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-%E7%A6%81%E7%94%A8%E4%BA%8B%E4%BB%B6"><span class="toc-number">18.9.3.</span> <span class="toc-text">启用 | 禁用事件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%BA%8B%E4%BB%B6"><span class="toc-number">18.9.4.</span> <span class="toc-text">删除事件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%E4%BA%8B%E5%8A%A1"><span class="toc-number">19.</span> <span class="toc-text">15-事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-number">19.1.</span> <span class="toc-text">1、概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%89%B9%E6%80%A7%E5%92%8C%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">19.2.</span> <span class="toc-text">2、事务的特性和隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%8F%A6-%E5%9C%BA%E6%99%AF%EF%BC%9A%E9%93%B6%E8%A1%8C%E8%BD%AC%E8%B4%A6"><span class="toc-number">19.2.1.</span> <span class="toc-text">🏦 场景：银行转账</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%88Atomicity%EF%BC%89"><span class="toc-number">19.2.2.</span> <span class="toc-text">1. 原子性（Atomicity）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%EF%BC%9A"><span class="toc-number">19.2.2.1.</span> <span class="toc-text">举例：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%88Consistency%EF%BC%89"><span class="toc-number">19.2.3.</span> <span class="toc-text">2. 一致性（Consistency）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%EF%BC%9A-1"><span class="toc-number">19.2.3.1.</span> <span class="toc-text">举例：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%9A%94%E7%A6%BB%E6%80%A7%EF%BC%88Isolation%EF%BC%89"><span class="toc-number">19.2.4.</span> <span class="toc-text">3. 隔离性（Isolation）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%EF%BC%9A-2"><span class="toc-number">19.2.4.1.</span> <span class="toc-text">举例：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%8C%81%E4%B9%85%E6%80%A7%EF%BC%88Durability%EF%BC%89"><span class="toc-number">19.2.5.</span> <span class="toc-text">4. 持久性（Durability）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%EF%BC%9A-3"><span class="toc-number">19.2.5.1.</span> <span class="toc-text">举例：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%9C%85-%E6%80%BB%E7%BB%93%EF%BC%88%E7%94%A8%E4%B8%80%E5%8F%A5%E8%AF%9D%E8%AE%B0%E4%BD%8F-ACID%EF%BC%89"><span class="toc-number">19.2.6.</span> <span class="toc-text">✅ 总结（用一句话记住 ACID）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E8%BD%AC%E8%B4%A6%E4%B8%9A%E5%8A%A1"><span class="toc-number">19.3.</span> <span class="toc-text">模拟转账业务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%8E%A7%E5%88%B6%E4%BA%8B%E5%8A%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">19.3.1.</span> <span class="toc-text">手动控制事务流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%B1%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8E%A7%E5%88%B6%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">19.3.2.</span> <span class="toc-text">由数据库控制事务的流程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%AE%8C%E6%88%90%E8%BD%AC%E8%B4%A6%E4%B8%9A%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="toc-number">19.4.</span> <span class="toc-text">使用存储过程完成转账业务操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98"><span class="toc-number">19.5.</span> <span class="toc-text">3、事务的并发问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%89%E5%A4%A7%E8%8C%83%E5%BC%8F"><span class="toc-number">20.</span> <span class="toc-text">16-数据库三大范式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8C%83%E5%BC%8F%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="toc-number">20.1.</span> <span class="toc-text">数据库范式的作用：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E7%AD%94%EF%BC%9A"><span class="toc-number">20.2.</span> <span class="toc-text">简答：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F%EF%BC%9A"><span class="toc-number">20.3.</span> <span class="toc-text">第一范式：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F%EF%BC%9A"><span class="toc-number">20.4.</span> <span class="toc-text">第二范式：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F%EF%BC%9A"><span class="toc-number">20.5.</span> <span class="toc-text">第三范式：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E8%8C%83%E5%BC%8F%E8%A7%A3%E5%86%B3%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98"><span class="toc-number">20.6.</span> <span class="toc-text">三范式解决什么问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">21.</span> <span class="toc-text">17-存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">21.1.</span> <span class="toc-text">mysql体系结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="toc-number">21.2.</span> <span class="toc-text">存储引擎的作用：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">21.3.</span> <span class="toc-text">设置存储引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%89%B9%E7%82%B9"><span class="toc-number">21.4.</span> <span class="toc-text">存储引擎特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81-InnoDB"><span class="toc-number">21.5.</span> <span class="toc-text">1、 InnoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A1%A8%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">21.5.1.</span> <span class="toc-text">查看表文件内容</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">21.5.2.</span> <span class="toc-text">逻辑存储结构</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81MyISAM"><span class="toc-number">21.6.</span> <span class="toc-text">2、MyISAM</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6"><span class="toc-number">21.6.1.</span> <span class="toc-text">查看数据文件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81Memory"><span class="toc-number">21.7.</span> <span class="toc-text">3、Memory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E9%80%89%E6%8B%A9"><span class="toc-number">21.8.</span> <span class="toc-text">4、存储引擎选择</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-1%E7%B4%A2%E5%BC%95"><span class="toc-number">22.</span> <span class="toc-text">18-1索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">22.1.</span> <span class="toc-text">1、索引的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">22.2.</span> <span class="toc-text">2、索引的优缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81mysql%E7%B4%A2%E5%BC%95%E6%98%AF%E5%9C%A8%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%8C%E4%B8%8D%E5%90%8C%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%9C%89%E4%B8%8D%E5%90%8C%E7%9A%84%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84%EF%BC%9A"><span class="toc-number">22.3.</span> <span class="toc-text">3、mysql索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E9%80%89%E6%8B%A9%E4%BD%BF%E7%94%A8B-tree%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84%EF%BC%9F"><span class="toc-number">22.4.</span> <span class="toc-text">4、为什么InnoDB存储引擎选择使用B+tree索引结构？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">22.5.</span> <span class="toc-text">5、索引的分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E6%A0%B9%E6%8D%AE%E7%B4%A2%E5%BC%95%E7%9A%84%E5%AD%98%E5%82%A8%E5%BD%A2%E5%BC%8F%E5%8F%88%E5%8F%AF%E4%BB%A5%E5%88%86%E4%B8%BA%EF%BC%9A"><span class="toc-number">22.6.</span> <span class="toc-text">6、根据索引的存储形式又可以分为：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E9%80%89%E5%8F%96%E7%9A%84%E8%A7%84%E5%88%99%EF%BC%9A"><span class="toc-number">22.7.</span> <span class="toc-text">7、聚集索引选取的规则：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95%E5%92%8C%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95%E8%B0%81%E7%9A%84%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%95%88%E7%8E%87%E9%AB%98%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">22.8.</span> <span class="toc-text">8、聚集索引和二级索引谁的查询的效率高？为什么？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-2-%E7%B4%A2%E5%BC%95"><span class="toc-number">23.</span> <span class="toc-text">18-2 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81sql%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">23.1.</span> <span class="toc-text">1、sql性能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">23.2.</span> <span class="toc-text">2、慢查询日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81profile%E8%AF%A6%E6%83%85"><span class="toc-number">23.3.</span> <span class="toc-text">3、profile详情</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81explain-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">23.4.</span> <span class="toc-text">4、explain 执行计划</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%EF%BC%9Aid"><span class="toc-number">23.4.1.</span> <span class="toc-text">4.1 执行计划：id</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%EF%BC%9Aselect-type"><span class="toc-number">23.4.2.</span> <span class="toc-text">4.2 执行计划：select_type</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%EF%BC%9Atype"><span class="toc-number">23.4.3.</span> <span class="toc-text">4.3 执行计划：type</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8"><span class="toc-number">23.5.</span> <span class="toc-text">5、索引使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-%E9%AA%8C%E8%AF%81%E7%B4%A2%E5%BC%95%E6%95%88%E7%8E%87"><span class="toc-number">23.5.1.</span> <span class="toc-text">5.1 验证索引效率</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99"><span class="toc-number">23.5.2.</span> <span class="toc-text">5.2 最左前缀法则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">23.5.3.</span> <span class="toc-text">5.3 范围查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-4-%E7%B4%A2%E5%BC%95%E5%88%97%E8%BF%90%E7%AE%97"><span class="toc-number">23.5.4.</span> <span class="toc-text">5.4 索引列运算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-5-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8D%E5%8A%A0%E5%BC%95%E5%8F%B7"><span class="toc-number">23.5.5.</span> <span class="toc-text">5.5 字符串不加引号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-6-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">23.5.6.</span> <span class="toc-text">5.6 模糊查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-7-or-%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6"><span class="toc-number">23.5.7.</span> <span class="toc-text">5.7 or 连接条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-8-%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83%E5%BD%B1%E5%93%8D"><span class="toc-number">23.5.8.</span> <span class="toc-text">5.8 数据分布影响</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-9-sql%E6%8F%90%E7%A4%BA"><span class="toc-number">23.5.9.</span> <span class="toc-text">5.9 sql提示</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-10-%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-number">23.5.10.</span> <span class="toc-text">5.10 覆盖索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-11-%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-number">23.5.11.</span> <span class="toc-text">5.11 前缀索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-12-%E5%8D%95%E5%88%97%E7%B4%A2%E5%BC%95%E5%92%8C%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-number">23.5.12.</span> <span class="toc-text">5.12 单列索引和联合索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-13-%E5%B0%8F%E7%BB%93"><span class="toc-number">23.5.13.</span> <span class="toc-text">5.13 小结</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">23.6.</span> <span class="toc-text">6、索引设计原则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-SQL%E4%BC%98%E5%8C%96"><span class="toc-number">24.</span> <span class="toc-text">19-SQL优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%8F%92%E5%85%A5%E4%BC%98%E5%8C%96"><span class="toc-number">24.1.</span> <span class="toc-text">1、插入优化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E6%97%B6%E5%8F%AF%E4%BB%A5%E5%81%9A%E5%93%AA%E4%BA%9B%E4%BC%98%E5%8C%96%EF%BC%9F"><span class="toc-number">24.1.1.</span> <span class="toc-text">插入数据时可以做哪些优化？</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">24.1.1.1.</span> <span class="toc-text">批量插入数据</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">24.1.1.2.</span> <span class="toc-text">事务管理</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96"><span class="toc-number">24.1.1.3.</span> <span class="toc-text">主键优化</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%BC%95%E6%93%8E%E9%80%89%E6%8B%A9"><span class="toc-number">24.1.1.4.</span> <span class="toc-text">引擎选择</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LOAD-DATA-INFILE"><span class="toc-number">24.1.1.5.</span> <span class="toc-text">使用LOAD DATA INFILE</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#JDBC%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E4%BC%98%E5%8C%96"><span class="toc-number">24.1.1.6.</span> <span class="toc-text">JDBC批量插入优化</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#MyBatis%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5"><span class="toc-number">24.1.1.7.</span> <span class="toc-text">MyBatis批量插入</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B0%83%E6%95%B4MySQL%E9%85%8D%E7%BD%AE"><span class="toc-number">24.1.1.8.</span> <span class="toc-text">调整MySQL配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96"><span class="toc-number">24.2.</span> <span class="toc-text">2、主键优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81order-by%E4%BC%98%E5%8C%96"><span class="toc-number">24.3.</span> <span class="toc-text">3、order by优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81group-by-%E4%BC%98%E5%8C%96"><span class="toc-number">24.4.</span> <span class="toc-text">4、group by 优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81limit-%E4%BC%98%E5%8C%96"><span class="toc-number">24.5.</span> <span class="toc-text">5、limit 优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81count-%E4%BC%98%E5%8C%96"><span class="toc-number">24.6.</span> <span class="toc-text">6、count 优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81update-%E4%BC%98%E5%8C%96"><span class="toc-number">24.7.</span> <span class="toc-text">7、update 优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">24.8.</span> <span class="toc-text">总结：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%8F%92%E5%85%A5%E4%BC%98%E5%8C%96%EF%BC%88INSERT-Optimization%EF%BC%89"><span class="toc-number">24.8.1.</span> <span class="toc-text">一、插入优化（INSERT Optimization）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96%EF%BC%88Primary-Key-Optimization%EF%BC%89"><span class="toc-number">24.8.2.</span> <span class="toc-text">二、主键优化（Primary Key Optimization）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%89%E3%80%81ORDER-BY-%E4%BC%98%E5%8C%96"><span class="toc-number">24.8.3.</span> <span class="toc-text">三、ORDER BY 优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%9B%E3%80%81GROUP-BY-%E4%BC%98%E5%8C%96"><span class="toc-number">24.8.4.</span> <span class="toc-text">四、GROUP BY 优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%94%E3%80%81LIMIT-%E4%BC%98%E5%8C%96"><span class="toc-number">24.8.5.</span> <span class="toc-text">五、LIMIT 优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%AD%E3%80%81COUNT-%E4%BC%98%E5%8C%96"><span class="toc-number">24.8.6.</span> <span class="toc-text">六、COUNT 优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%83%E3%80%81UPDATE-%E4%BC%98%E5%8C%96"><span class="toc-number">24.8.7.</span> <span class="toc-text">七、UPDATE 优化</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">24.9.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql-%E7%AE%A1%E7%90%86"><span class="toc-number">25.</span> <span class="toc-text">mysql 管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%88%9D%E5%A7%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">25.1.</span> <span class="toc-text">1、初始数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-information-schema%EF%BC%9A%E5%85%83%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E5%BA%93"><span class="toc-number">25.1.1.</span> <span class="toc-text">1.1 information_schema：元数据信息库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-mysql%EF%BC%9A%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">25.1.2.</span> <span class="toc-text">1.2 mysql：系统数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-performance-schema%EF%BC%9A%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%BA%93"><span class="toc-number">25.1.3.</span> <span class="toc-text">1.3 performance_schema：性能监控库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-sys%EF%BC%9A%E7%AE%80%E5%8C%96%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E7%9A%84%E5%B7%A5%E5%85%B7%E5%BA%93"><span class="toc-number">25.1.4.</span> <span class="toc-text">1.4 sys：简化性能诊断的工具库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-5-%E5%B0%8F%E7%BB%93%EF%BC%9A%E5%8D%8F%E4%BD%9C%E5%85%B3%E7%B3%BB"><span class="toc-number">25.1.5.</span> <span class="toc-text">1.5 小结：协作关系</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">25.2.</span> <span class="toc-text">2、常用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%E8%AF%B4%E6%98%8E%E5%B8%B8%E8%A7%81%E7%9A%84mysql%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%EF%BC%8C%E5%B9%B6%E8%AF%B4%E6%98%8E%E4%BD%9C%E7%94%A8"><span class="toc-number">25.2.1.</span> <span class="toc-text">举例说明常见的mysql管理工具，并说明作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-mysql%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">25.2.2.</span> <span class="toc-text">2.1 mysql客户端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-mysqladmin"><span class="toc-number">25.2.3.</span> <span class="toc-text">2.2 mysqladmin</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-mysqlbinlog"><span class="toc-number">25.2.4.</span> <span class="toc-text">2.3 mysqlbinlog</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-mysqlshow"><span class="toc-number">25.2.5.</span> <span class="toc-text">2.4 mysqlshow</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-mysqldump"><span class="toc-number">25.2.6.</span> <span class="toc-text">2.5 mysqldump</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-mysqlimport-%E5%92%8C-source"><span class="toc-number">25.2.7.</span> <span class="toc-text">2.6 mysqlimport  和 source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81"><span class="toc-number">26.</span> <span class="toc-text">数据库锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E9%94%81%E6%A6%82%E8%BF%B0"><span class="toc-number">26.1.</span> <span class="toc-text">1、锁概述</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E9%94%81"><span class="toc-number">26.1.1.</span> <span class="toc-text">1.1 为什么需要锁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">26.1.2.</span> <span class="toc-text">1.1 介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E5%88%86%E7%B1%BB"><span class="toc-number">26.1.3.</span> <span class="toc-text">1.2 分类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-number">26.2.</span> <span class="toc-text">2、全局锁</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">26.2.1.</span> <span class="toc-text">2.1 介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E6%BC%94%E7%A4%BA"><span class="toc-number">26.2.2.</span> <span class="toc-text">2.2 演示</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E7%89%B9%E7%82%B9"><span class="toc-number">26.2.3.</span> <span class="toc-text">2.3 特点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-%E5%B0%8F%E7%BB%93"><span class="toc-number">26.2.4.</span> <span class="toc-text">2.4 小结</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1%E3%80%81%E5%85%A8%E5%B1%80%E9%94%81%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">26.2.4.1.</span> <span class="toc-text">1、全局锁的作用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8%E5%85%A8%E5%B1%80%E9%94%81%E7%9A%84%E5%BC%8A%E7%AB%AF%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3"><span class="toc-number">26.2.4.2.</span> <span class="toc-text">2、使用全局锁的弊端是什么？怎么解决</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-number">26.3.</span> <span class="toc-text">3、表级锁</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">26.3.1.</span> <span class="toc-text">3.1 介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E8%A1%A8%E9%94%81"><span class="toc-number">26.3.2.</span> <span class="toc-text">3.2 表锁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-%E5%85%83%E6%95%B0%E6%8D%AE%E9%94%81-meta-data-lock-MDL"><span class="toc-number">26.3.3.</span> <span class="toc-text">3.3 元数据锁(meta data lock, MDL)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-%E6%84%8F%E5%90%91%E9%94%81"><span class="toc-number">26.3.4.</span> <span class="toc-text">3.4 意向锁</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-number">26.4.</span> <span class="toc-text">4、行级锁</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">26.4.1.</span> <span class="toc-text">4.1 介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-%E6%BC%94%E7%A4%BA"><span class="toc-number">26.4.2.</span> <span class="toc-text">4.2 演示</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E9%94%81%E5%88%86%E7%B1%BB%E5%B0%8F%E7%BB%93"><span class="toc-number">26.5.</span> <span class="toc-text">6、锁分类小结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/19/Git%E4%BD%9C%E4%B8%9A_0915/" title="Git作业_0915">Git作业_0915</a><time datetime="2025-09-19T07:58:53.222Z" title="发表于 2025-09-19 15:58:53">2025-09-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/19/Web%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98%E3%80%90%E7%94%B5%E5%AD%90%E7%89%88%E3%80%91/" title="Web前端面试宝典">Web前端面试宝典</a><time datetime="2025-09-19T07:52:37.333Z" title="发表于 2025-09-19 15:52:37">2025-09-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/19/GIT%E5%9F%BA%E7%A1%80_/" title="无标题">无标题</a><time datetime="2025-09-19T06:55:30.645Z" title="发表于 2025-09-19 14:55:30">2025-09-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/19/%E5%8D%9A%E5%AE%A2%E6%9E%B6%E6%9E%84/" title="博客架构全景 (One-Page Cheatsheet)">博客架构全景 (One-Page Cheatsheet)</a><time datetime="2025-09-18T16:00:00.000Z" title="发表于 2025-09-19 00:00:00">2025-09-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/18/Linux%E9%9D%A2%E8%AF%95%E9%A2%98/" title="Linux面试题">Linux面试题</a><time datetime="2025-09-18T13:19:49.181Z" title="发表于 2025-09-18 21:19:49">2025-09-18</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By NINGXIU</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章..." type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>